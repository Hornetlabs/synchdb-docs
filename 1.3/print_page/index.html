
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="SynchDB is a PostgreSQL extension for synchronizing data from different database sources..">
      
      
        <meta name="author" content="Hornetlabs Technology Inc.">
      
      
        <link rel="canonical" href="https://docs.synchdb.com/latest/print_page/">
      
      
      
      
        
          <link rel="alternate" href="/latest/" hreflang="en">
        
          <link rel="alternate" href="/latest/es/" hreflang="es">
        
          <link rel="alternate" href="../zh/architecture/nom_native_datatype_handling/" hreflang="zh">
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Print Site - SynchDB 文档</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
    <script>__md_scope=new URL("/latest",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zh" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../zh/" title="SynchDB 文档" class="md-header__button md-logo" aria-label="SynchDB 文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SynchDB 文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/latest/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/latest/es/" hreflang="es" class="md-select__link">
              Español
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../zh/architecture/nom_native_datatype_handling/" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Hornetlabs/synchdb" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../zh/" class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../zh/architecture/architecture/" class="md-tabs__link">
          
  
  
  架构

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../zh/getting-started/installation/" class="md-tabs__link">
          
  
  
  快速入门

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../zh/monitoring/stats_view/" class="md-tabs__link">
          
  
  
  监控

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../zh/tutorial/mysql_cdc_to_postgresql/" class="md-tabs__link">
          
  
  
  教程

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../zh/user-guide/create_a_connector/" class="md-tabs__link">
          
  
  
  用户指南

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../zh/changelog/" class="md-tabs__link">
        
  
  
    
  
  变更日志

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../zh/" title="SynchDB 文档" class="md-nav__button md-logo" aria-label="SynchDB 文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    SynchDB 文档
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Hornetlabs/synchdb" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    主页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    架构
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    架构
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    架构概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/debezium_event_processor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debezium 事件处理器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/debezium_runner_components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debezium Runner组件架构
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/openlog_replicator_event_processor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Openlog Replicator 事件处理器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/batch_change_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    批量处理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/non_native_datatype_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    非原生数据类型处理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/native_datatype_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    原生数据类型处理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/metadata_files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debezium 元数据文件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/ddl_replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DDL复制
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/architecture/fdw_based_snapshot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基於FDW的快照
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    快速入门
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    快速入门
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    安装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/getting-started/remote_database_setups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    源数据库设置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/getting-started/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SynchDB 配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/getting-started/quick_start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    快速入门
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    监控
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    监控
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/monitoring/stats_view/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    统计视图
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/monitoring/state_view/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    状态视图
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/monitoring/attr_view/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    属性视图
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/monitoring/jvm_mem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JVM 内存使用情况
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/monitoring/jmx_monitor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JMX 监视器设置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/monitoring/jmx_exporter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JMX exporter 设置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    教程
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    教程
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/tutorial/mysql_cdc_to_postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MySQL CDC 到 PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/tutorial/sqlserver_cdc_to_postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL Server CDC 到 PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/tutorial/oracle_cdc_to_postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Oracle CDC 到 PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/tutorial/selective_table_sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    选择性表同步
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/tutorial/table_snapshot_resnapshot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    表快照和重新快照
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/tutorial/object_mapping_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    对象映射工作流程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    用户指南
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    用户指南
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/create_a_connector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    创建连接器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/start_stop_connector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    启动/停止连接器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/connector_auto_launcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    连接器自动启动器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/default_datatype_mapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    默认数据类型映射
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/object_mapping_rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    自定义对象映射和转换
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/secured_connection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    安全连接
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/configure_error_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    配置错误处理策略
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/set_offset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    配置复制偏移
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/configure_olr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    为 Oracle 连接器配置 Openlog Replicator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/configure_infinispan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    配置 infinispan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/user-guide/configure_snapshot_engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    配置快照引擎
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../zh/changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    变更日志
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zh" class="md-nav__link">
    <span class="md-ellipsis">
      
        1 主页
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2 架构
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 架构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zh-architecture-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 架构概述
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-debezium_event_processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Debezium 事件处理器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-debezium_runner_components" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Debezium Runner组件架构
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-openlog_replicator_event_processor" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4 Openlog Replicator 事件处理器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-batch_change_handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5 批量处理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-non_native_datatype_handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.6 非原生数据类型处理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-native_datatype_handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.7 原生数据类型处理
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-metadata_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.8 Debezium 元数据文件
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-ddl_replication" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.9 DDL复制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-architecture-fdw_based_snapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.10 基於FDW的快照
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3 快速入门
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 快速入门">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zh-getting-started-installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 安装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-getting-started-remote_database_setups" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 源数据库设置
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-getting-started-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 SynchDB 配置
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-getting-started-quick_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4 快速入门
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4 监控
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 监控">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zh-monitoring-stats_view" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 统计视图
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-monitoring-state_view" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 状态视图
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-monitoring-attr_view" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 属性视图
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-monitoring-jvm_mem" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4 JVM 内存使用情况
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-monitoring-jmx_monitor" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.5 JMX 监视器设置
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-monitoring-jmx_exporter" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.6 JMX exporter 设置
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        5 教程
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 教程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zh-tutorial-mysql_cdc_to_postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 MySQL CDC 到 PostgreSQL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-tutorial-sqlserver_cdc_to_postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 SQL Server CDC 到 PostgreSQL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-tutorial-oracle_cdc_to_postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 Oracle CDC 到 PostgreSQL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-tutorial-selective_table_sync" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4 选择性表同步
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-tutorial-table_snapshot_resnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5 表快照和重新快照
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-tutorial-object_mapping_workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.6 对象映射工作流程
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        6 用户指南
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 用户指南">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-create_a_connector" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 创建连接器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-start_stop_connector" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 启动/停止连接器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-connector_auto_launcher" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 连接器自动启动器
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-default_datatype_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4 默认数据类型映射
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-object_mapping_rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5 自定义对象映射和转换
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-secured_connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6 安全连接
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-configure_error_strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.7 配置错误处理策略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-set_offset" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.8 配置复制偏移
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-configure_olr" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.9 为 Oracle 连接器配置 Openlog Replicator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-configure_infinispan" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.10 配置 infinispan
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zh-user-guide-configure_snapshot_engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.11 配置快照引擎
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zh-changelog" class="md-nav__link">
    <span class="md-ellipsis">
      
        7 变更日志
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="zh" heading-number="1"><h1 id="zh-_1">关于<a class="headerlink" href="#zh-_1" title="Permanent link">&para;</a></h1>
<p align="center">
<img src="../images/synchdblogo.jpg" alt="synchdb" width="400">
</p>

<h2 id="zh-synchdb"><strong>关于 SynchDB</strong><a class="headerlink" href="#zh-synchdb" title="Permanent link">&para;</a></h2>
<p>SynchDB 是一个 PostgreSQL 扩展，支持从异构数据库（例如 MySQL、SQL Server 和 Oracle）直接快速可靠地复制到 PostgreSQL。与传统的数据管道不同，SynchDB 在 PostgreSQL 内部原生处理整个同步和数据转换过程，无需任何中间件或外部编排工具。它主要管理以下端到端任务：</p>
<ul>
<li>建立并维护与外部数据库的连接</li>
<li>从源系统捕获变更事件</li>
<li>将这些事件转换为与 PostgreSQL 兼容的格式</li>
<li>将它们应用于 PostgreSQL</li>
</ul>
<p>SynchDB 的核心集成了 Debezium 嵌入式引擎，这是一个基于 Java 的强大变更数据捕获 (CDC) 库，支持多种数据库连接器。 SynchDB 使用 Java 原生接口 (JNI) 连接 PostgreSQL 基于 C 语言的运行时和 Debezium 的 Java 环境，从而实现两者之间的无缝协作。</p>
<p>这种架构使 PostgreSQL 能够充分利用 Debezium 丰富的连接器生态系统，同时保持扩展的轻量级、灵活性和易于部署。</p>
<p>🔗 了解更多关于 Debezium 的信息，请点击此处 (<a href="https://debezium.io/documentation/reference/stable/index.html">https://debezium.io/documentation/reference/stable/index.html</a>)。</p>
<h2 id="zh-_2"><strong>主要特性</strong><a class="headerlink" href="#zh-_2" title="Permanent link">&para;</a></h2>
<ul>
<li>高效的数据同步</li>
<li>支持从 MySQL、SQL Server 和 Oracle 数据库复制</li>
<li>灵活的数据转换规则，包括表名、列名、数据类型和自定义数据转换表达式</li>
<li>轻松与现有 PostgreSQL 数据库集成</li>
<li>初始快照和变更数据捕获 (CDC) 模式</li>
<li>支持 DDL 和 DML 逻辑复制</li>
<li>全局连接器状态、错误和统计信息配置</li>
</ul>
<h2 id="zh-postgresql"><strong>支持的 PostgreSQL 版本</strong><a class="headerlink" href="#zh-postgresql" title="Permanent link">&para;</a></h2>
<ul>
<li>PostgreSQL：16、17、18</li>
<li>IvorySQL：4、5</li>
</ul>
<h2 id="zh-_3"><strong>支持的源数据库</strong><a class="headerlink" href="#zh-_3" title="Permanent link">&para;</a></h2>
<ul>
<li>MySQL：8.0.x、8.2</li>
<li>SQL Server：2017、2019、2022</li>
<li>Oracle：12c、19c、21c、23ai</li>
<li>Openlog Replicator：1.3.0 ~ 1.8.5</li>
</ul>
<h2 id="zh-_4"><strong>所需的第三方库</strong><a class="headerlink" href="#zh-_4" title="Permanent link">&para;</a></h2>
<ul>
<li>Java Runtime Environment（JRE）17 或更高版本</li>
<li>libprotobuf-c v1.5.2（如果需要 Openlog Replicator 支持）</li>
</ul>
<h2 id="zh-_5"><strong>版本历史</strong><a class="headerlink" href="#zh-_5" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.3">SynchDB v1.3</a></li>
<li><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.2">SynchDB v1.2</a></li>
<li><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.1">SynchDB v1.1</a></li>
<li><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.0">SynchDB v1.0</a></li>
<li><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.0_beta1">SynchDB v1.0 Beta1</a></li>
</ul>
<h2 id="zh-_6"><strong>快速入门</strong><a class="headerlink" href="#zh-_6" title="Permanent link">&para;</a></h2>
<p>开始使用 SynchDB 的最快方法是使用预编译的 Docker 镜像以及源数据库系统（MySQL、SQL Server、Oracle 等）的配套镜像，所有这些镜像均由源存储库中的 <code>ezdeploy.sh</code> 工具驱动。此交互式工具可以启动 SynchDB、一个或多个源数据库，以及可选的 Prometheus + Grafana 用于监控，非常适合进行快速的端到端测试。请参阅 <a href="#zh-getting-started-quick_start">快速入门指南</a>。</p>
<p>其他实用链接：</p>
<ul>
<li><a href="#zh-architecture-architecture">SynchDB 架构决策</a></li>
<li><a href="#zh-getting-started-installation">安装指南</a></li>
<li><a href="#zh-getting-started-remote_database_setups">源数据库设置</a></li>
</ul></section>
                    <section class='print-page md-section' id='section-2' heading-number='2'>
                        <h1>架构<a class='headerlink' href='#section-2' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="zh-architecture-architecture" heading-number="2.1"><h1 id="zh-architecture-architecture-_1">架构概述<a class="headerlink" href="#zh-architecture-architecture-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-architecture-_2"><strong>总体架构图</strong><a class="headerlink" href="#zh-architecture-architecture-_2" title="Permanent link">&para;</a></h2>
<p><img alt="img" src="../zh/architecture/architecture/images/synchdb-arch2.jpg" /></p>
<p>SynchDB 扩展包含两个代码空间（Java 和 C），JNI 位于两者之间作为协调员。</p>
<p><strong>Debezium Runner - Java</strong></p>
<ul>
<li>Debezium Runner 驱动程序</li>
<li>嵌入式 Debezium 引擎</li>
</ul>
<p><strong>SynchDB 扩展 - C</strong></p>
<ul>
<li>SynchDB 启动器</li>
<li>SynchDB Worker</li>
<li>格式转换器</li>
<li>复制代理</li>
<li>表同步代理（待定）</li>
</ul>
<p>这两个代码空间通过 Java 原生接口 (JNI) 互连。JNI 是一个框架，允许 Java 应用程序与用 C 或 C++ 等语言编写的原生代码交互，反之亦然。它使 Java 程序能够调用原生应用程序和库，并被原生应用程序和库调用，从而在 Java 的平台独立性和原生代码的性能优势之间架起了一座桥梁。JNI 通常用于集成特定于平台的功能、优化应用程序中性能关键部分，或访问 Java 中不可用的旧库。它需要谨慎管理资源，因为它涉及在 Java 虚拟机 (JVM) 和本机环境之间切换，这可能会增加复杂性。</p>
<p>因此，SynchDB 需要 JNI 在 Debezium 运行器引擎和 SynchDB PostgreSQL 扩展之间交换资源。JNI 可在 Java 安装（例如 openjdk）中使用。</p>
<h3 id="zh-architecture-architecture-debezium-runner-java"><strong>Debezium Runner - Java</strong><a class="headerlink" href="#zh-architecture-architecture-debezium-runner-java" title="Permanent link">&para;</a></h3>
<p>这是一个 Java 驱动程序，它利用 Debezium 嵌入式引擎以及各种连接到不同数据库源的“连接器”。它是实现从多个数据库供应商进行逻辑复制的关键底层组件。它的主要职责是连接到指定的远程数据库，并定期获取其更改并将其转换为通用的 JSON 结构。然后，此 JSON 结构将传递给“C 语言 SynchDB 扩展”进行处理，并最终将更改应用于 PostgreSQL。</p>
<p><a href="https://docs.synchdb.com/zh/architecture/debezium_runner_components/">Debezium Runner 组件架构</a></p>
<h3 id="zh-architecture-architecture-synchdb-c"><strong>SynchDB 扩展 - C</strong><a class="headerlink" href="#zh-architecture-architecture-synchdb-c" title="Permanent link">&para;</a></h3>
<p>这是初始化 Java 虚拟机 (JVM) 并在其上运行 Debezium Runner 的主要入口点。它会定期从 Debezium Runner 获取一批 JSON 变更事件，处理这些数据并将其应用到 PostgreSQL。它还负责通知 Debezium 已成功完成一批 JSON 变更事件，以便两个组件在复制进度方面保持同步。</p>
<p><a href="https://docs.synchdb.com/zh/architecture/synchdb_components/">SynchDB 扩展组件架构</a></p></section><section class="print-page" id="zh-architecture-debezium_event_processor" heading-number="2.2"><h1 id="zh-architecture-debezium_event_processor-debezium-c">Debezium 事件处理器 - C<a class="headerlink" href="#zh-architecture-debezium_event_processor-debezium-c" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-debezium_event_processor-debezium"><strong>Debezium 事件处理器组件图</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-debezium" title="Permanent link">&para;</a></h2>
<p><img alt="img" src="/images/synchdb-component-diag.jpg" /></p>
<p>Debezium 事件处理器是由 SynchDB 扩展发起和启动的 PostgreSQL 后台工作进程。它负责初始化 Java 虚拟机 (JVM)，运行 Debezium Runner模块，（它是 SynchDB 的 Java 部分），利用嵌入式 Debezium 引擎从异构数据库源获取更改事件。每个 SynchDB 工作进程都由下面列出的组件和模块组成：</p>
<ol>
<li>事件获取器</li>
<li>JVM + DBZ 初始化程序</li>
<li>请求处理器</li>
<li>JSON 解析器</li>
<li>对象映射引擎</li>
<li>统计信息收集器</li>
<li>DDL 转换器</li>
<li>DML 转换器</li>
<li>错误处理程序</li>
<li>SPI 客户端</li>
<li>执行器 API</li>
</ol>
<h3 id="zh-architecture-debezium_event_processor-1"><strong>1) 事件获取器</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-1" title="Permanent link">&para;</a></h3>
<p>事件获取器主要负责从运行在 JVM 中的嵌入式 Debezium Runner 获取一批 JSON 变更事件。此操作通过 Java 接口 (JNI) 库完成，通过定期调用 JAVA 函数返回一个 JAVA <code>String</code> 列表，该列表以 JSON 格式表示每个变更请求。此列表 表示一批 JSON 变更事件。再次调用 JNI 库来迭代此 <code>List</code>，将内容从 JAVA <code>String</code> 转换为 C 字符串，并将其发送到 <code>4) JSON 解析器</code> 进行进一步处理。获取频率可通过 <a href="https://docs.synchdb.com/zh/user-guide/configuration/"><code>synchdb.naptime</code></a> 配置，批次的最大大小可通过 <a href="https://docs.synchdb.com/zh/user-guide/configuration/"><code>synchdb.dbz_batch_size</code></a> 配置。</p>
<p>当批次完成时，即其中的所有更改事件都已处理完毕，它将通过 JNI 调用 <code>markBatchComplete()</code> JAVA 函数以指示此批次已成功完成。这将导致 Debezium Runner 提交并推进偏移量。有关批次管理的更多信息，请参见<a href="https://docs.synchdb.com/zh/architecture/batch_change_handling/">此处</a>。</p>
<h3 id="zh-architecture-debezium_event_processor-2-jvm-debezium-dbz"><strong>2) JVM + Debezium (DBZ) 初始化程序</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-2-jvm-debezium-dbz" title="Permanent link">&para;</a></h3>
<p>JVM + DBZ 初始化程序主要负责实例化新的 JVM 环境并在其中运行 Debezium Runner (<code>dbz-engine-x.x.x.jar</code>)。此 .jar 文件默认安装在 <code>pg_config</code> 返回的 $LIBDIR 中。您也可以通过设置环境变量 <code>DBZ_ENGINE_DIR</code> 为 Debezium Runner .jar 文件指定备用路径。SynchDB 当前使用 <code>JNI_VERSION_10</code> 作为 JNI 版本，兼容 JAVA v10 至 v18。但是，将来我们可能会升级 JNI 版本以获得 JNI 的最新改进和优势。可以通过 <a href="https://docs.synchdb.com/zh/user-guide/configuration/"><code>synchdb.jvm_max_heap_size</code></a> 配置分配给 JVM 的最大heap内存。如果设置为零，JVM 将自动分配理想的heap大小。</p>
<p>请注意，每个 SynchDB 工作进程都会初始化并运行一个 JVM 实例，因此运行的工作进程越多，所需的heap内存就越多。您可以通过调用 <code>synchdb_log_jvm_meminfo('$connector_name')</code> 函数查看 SynchDB 工作进程的 JVM 当前heap和非heap内存使用情况，内存摘要将记录在 PostgreSQL 日志文件中。</p>
<hzh-architecture-debezium_event_processor-3 id="zh-architecture-debezium_event_processor-3"><strong>3) 请求处理器</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-3" title="Permanent link">&para;</a></h3>
<p>请求处理器主要负责检查和处理来自 SynchDB 用户的任何传入状态更改请求。此类状态更改请求的示例包括从“同步”到“暂停”，从“暂停”到“更新偏移”等。以下是 synchdb 的状态图。更多信息可以在 <a href="https://docs.synchdb.com/zh/user-guide/utility_functions/#state-management">此处</a> 找到。</p>
<p><img alt="img" src="/images/synchdb-state-diag.jpg" /></p>
<h3 id="zh-architecture-debezium_event_processor-4-json"><strong>4) JSON 解析器</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-4-json" title="Permanent link">&para;</a></h3>
<p>JSON 解析器负责将传入的 JSON 更改事件解析为 SynchDB 可以使用的 C 结构。SynchDB 依赖 PostgreSQL 的原生 JSONB 解析器来满足所有解析和迭代需求。对于 DML JSON 事件，它首先解析 JSON 更改事件的“架构”部分（在本文档中也称为元数据），以了解 Debezium 如何表示用户数据。这包括每个字段的数据类型表示、值的比例……等等。然后，它解析“有效负载”以获取“之前”和“之后”的值。最后，它解析“源”部分以获取表名、数据库名称和数据来源的连接器类型。</p>
<p>对于 DML JSON 事件，将解析相同的部分，但“有效负载”下预期的属性不同。它解析“有效负载”下的“tableChanges”以了解指定表的列名、类型和其他属性。</p>
<p>根据操作的性质，生成的 C 结构数据随后被发送到 <code>DDL Converter</code>（用于 DDL 请求）或 <code>DML Converter</code>（用于 DML 请求）进行下一阶段的处理。以下是 JSON 事件中 DDL 和 DML“有效负载”的示例：</p>
<p>DML 有效负载：
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;before&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;after&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;g&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;wkb&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AQMAAAABAAAABQAAAAAAAAAAAAAAAAAAAAAAFEAAAAAAAAAAQAAAAAAAABRAAAAAAAAAAEAAAAAAAAAcQAAAAAAAAAAAAAAAAAAAHEAAAAAAAAAAAAAAAAAAABRA&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;srid&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;h&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.6.2.Final&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;connector&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mysql&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;synchdb-connector&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ts_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1743631156000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;snapshot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;last&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;db&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inventory&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;sequence&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ts_us&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1743631156000000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ts_ns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1743631156000000000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;geom&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;server_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;gtid&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mysql-bin.000009&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;pos&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1026620577</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;row&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;thread&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;op&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ts_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1743631156410</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ts_us&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1743631156410423</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ts_ns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1743631156410423395</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;transaction&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>DDL 有效负载：
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.6.2.Final&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;connector&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sqlserver&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;synchdb-connector&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ts_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1728337635149</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;snapshot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;db&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;testDB&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;sequence&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ts_us&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1728337635149000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ts_ns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1728337635149000000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dbo&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;customers&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;change_lsn&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;commit_lsn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;00000195:000010a0:0003&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;event_serial_no&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;ts_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1728337635150</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;databaseName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;testDB&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;schemaName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dbo&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ddl&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tableChanges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CREATE&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;\&quot;testDB\&quot;.\&quot;dbo\&quot;.\&quot;customers\&quot;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;defaultCharsetName&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;primaryKeyColumnNames&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;id&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;jdbcType&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;nativeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;typeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;int identity&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;typeExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;int identity&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;charsetName&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;optional&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;autoIncremented&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;generated&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;defaultValueExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;enumValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;first_name&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;jdbcType&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;nativeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;typeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;varchar&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;typeExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;varchar&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;charsetName&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;optional&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;autoIncremented&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;generated&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;defaultValueExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;enumValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;last_name&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;jdbcType&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;nativeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;typeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;varchar&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;typeExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;varchar&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;charsetName&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;optional&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;autoIncremented&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;generated&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;defaultValueExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;enumValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;jdbcType&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;nativeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;typeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;varchar&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;typeExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;varchar&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;charsetName&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;length&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;optional&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;autoIncremented&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;generated&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;defaultValueExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;enumValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div></p>
<h3 id="zh-architecture-debezium_event_processor-5"><strong>5) 对象映射引擎</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-5" title="Permanent link">&para;</a></h3>
<p>对象映射引擎负责加载和维护每个活动连接器下的对象映射信息。这些映射信息告诉 SynchDB 如何在 DDL 和 DML 处理期间将源对象映射到目标对象。默认情况下，Synchdb 没有对象映射规则，它将使用默认映射规则来处理数据。</p>
<p>对象可以引用：
* 表名。
* 列名。
* 数据类型。
* 转换表达式。</p>
<p>可以使用<code>synchdb_add_objmap()</code> 函数创建映射规则之前将源表名、列名和数据类型映射到不同的目标表名、列名和数据类型，并且可以通过查询<code>synchdb_objmap</code> 表来查看所有规则。有关对象映射的更多信息，请参见<a href="https://docs.synchdb.com/zh/user-guide/object_mapping_rules/">此处</a>。在<code>synchdb_att_view()</code> 视图下可以查看哪些内容映射到哪些内容的摘要。</p>
<p><code>转换表达式</code> 是一个 SQL 表达式，将在数据转换完成后、应用数据之前运行（如果指定）。此表达式可以是 PostgreSQL 中可运行的任何表达式，例如调用另一个 SQL 函数或使用运算符。有关对象映射规则的更多信息，请参见<a href="https://docs.synchdb.com/zh/user-guide/object_mapping_rules/">此处</a>。</p>
<h3 id="zh-architecture-debezium_event_processor-6"><strong>6) 统计收集器</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-6" title="Permanent link">&para;</a></h3>
<p>统计收集器负责收集 SynchDB 自操作开始以来的数据处理统计信息。这包括 DDL 和 DML 的数量、已处理的 CREATE、INSERT、UPDATE、DELETE 操作数量、处理的平均批处理大小以及描述数据在源中首次生成时间、Debezium 处理数据的时间以及在 PostgreSQL 中应用数据的时间的几个时间戳。这些指标可以帮助用户了解 SynchDB 的处理行为，以调整和优化设置以提高处理性能。有关统计数据的更多信息，请参见<a href="https://docs.synchdb.com/zh/user-guide/stats">此处</a>。</p>
<h3 id="zh-architecture-debezium_event_processor-7-ddl"><strong>7) DDL 转换器</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-7-ddl" title="Permanent link">&para;</a></h3>
<p>DDL 转换器负责将“JSON 解析器”生成的 DDL 数据转换为 PostgreSQL 可以理解的格式。对于 DDL，SynchDB 依赖 PostgreSQL SPI 引擎进行处理，因此转换的输出是正常的 SQL 查询字符串。DDL 转换器检查 DDL 数据，并必须与“对象映射引擎”配合使用，以正确转换源和目标之间的表、列名称或数据类型映射。</p>
<p>如果要根据“对象映射引擎”将名为“employee”的远程表映射到目标中的“staff”，则 DDL 转换器负责解析这些名称映射并相应地为 SPI 创建 SQL 查询。</p>
<p>转换器目前可以处理以下 DDL 操作：</p>
<ul>
<li>创建表 CREATE TABLE</li>
<li>删除表 DROP TABLE</li>
<li>更改表更改列 ALTER TABLE ALTER COLUMN</li>
<li>更改表添加列 ALTER TABLE ADD COLUMN</li>
<li>更改表删除列 ALTER TABLE DROP COLUMN</li>
</ul>
<p>对于 CREATE 和 DROP，转换器能够从输入的 DDL 数据中为 SPI 创建相应的查询字符串。对于 ALTER、ADD 和 DROP COLUMN，转换器需要访问 PostgreSQL Catalog以了解现有表属性，并确定是否有要添加、删除或更改的列。Debezium 的 JSON 更改事件始终包含整个表的信息，并且不会明确指出已删除或添加的内容。因此，需要 DDL 转换器组件来找出此信息并生成正确的查询字符串。有关 DDL 复制的更多信息，请参见<a href="https://docs.synchdb.com/zh/user-guide/ddl_replication/">此处</a></p>
<h3 id="zh-architecture-debezium_event_processor-8-dml"><strong>8) DML 转换器</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-8-dml" title="Permanent link">&para;</a></h3>
<p>DML 转换器负责将“JSON 解析器”生成的 DML 数据转换为 PostgreSQL 可以理解的格式。对于 DML，SynchDB 依赖 PostgreSQL 的执行器 API 将数据直接应用于 PostgreSQL，因此转换的输出是 PostgreSQL 执行器可以理解的 TupleTableSlot (TTS) 格式。为了让 PostgreSQL 生成正确的 TTS，DML 转换器依赖于：</p>
<ul>
<li>描述负载数据格式 DBZ 元数据</li>
<li>PostgreSQL 目录 (pg_class 和 pg_type)，用于了解目标表的信息、每列的数据类型和属性。</li>
<li>对象映射规则，用于确定是否需要在处理的数据上运行额外的转换表达式</li>
<li>要处理的数据</li>
</ul>
<p>DML 转换器由几个例程组成，这些例程可以处理特定的输入数据类型并生成特定的输出类型。为特定转换场景选择正确的例程可能是一个挑战，因为某些数据类型可能是用户定义的，或者由 SynchDB 不太了解的其他扩展创建。SynchDB 必须设计为处理 PostgreSQL 中可能存在的本机和非本机数据类型。</p>
<p>例程选择首先查看在 PostgreSQL 中创建的数据类型，该数据类型可分为 2 种类型，每种类型的处理技术略有不同：</p>
<ul>
<li><a href="https://docs.synchdb.com/zh/architecture/native_datatype_handling/">原生数据类型</a>。</li>
<li><a href="https://docs.synchdb.com/zh/architecture/non_native_datatype_handling/">非原生数据类型</a>。</li>
</ul>
<h4 id="zh-architecture-debezium_event_processor-_1"><strong>数据转换</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-_1" title="Permanent link">&para;</a></h4>
<p>在输入数据通过上述逻辑处理后，转换器将检查用户是否已配置“转换表达式”，该表达式应在应用于 PostgreSQL 之前应用于已处理的数据。转换表达式可以是任何可以在 psql 提示符上运行的 PostgreSQL 表达式、命令或 SQL 函数。它使用“%d”作为占位符，在转换期间将替换为已处理的数据。例如，转换表达式“'&gt;&gt;&gt;&gt;&gt;' || '%d' || '&lt;&lt;&lt;&lt;&lt;'”将在已处理的字符串数据前面和后面添加其他字符。</p>
<p>因此，如果非本地数据类型具有 TYPCATEGORY_USER 类别，DML 转换器没有合适的例程来处理此数据并将保持原样，我们可以定义一个转换表达式来调用自定义 SQL 函数，它知道如何正确处理数据并生成合适的输出。例如，表达式“to_my_composite_type('%d')”将使用数据作为输入来调用用户定义的 SQL 函数“to_my_composite_type”。表达式必须具有返回值，因为它将在应用期间输入到 PostgreSQL 中。</p>
<h3 id="zh-architecture-debezium_event_processor-9"><strong>9) 错误处理程序</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-9" title="Permanent link">&para;</a></h3>
<p>错误处理程序主要负责处理数据同步各个阶段可能出现的任何错误。格式转换器支持多种错误处理策略，可通过 “synchdb.error_handling_strategy” 参数进行配置。详情请参阅<a href="https://docs.synchdb.com/zh/user-guide/configure_error_strategies/">此处</a>。</p>
<h3 id="zh-architecture-debezium_event_processor-10-spi-client"><strong>10) SPI Client</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-10-spi-client" title="Permanent link">&para;</a></h3>
<p>SPI Client 组件存在于 Replication Agent 下，它充当 PostgreSQL 核心和 SynchDB 之间的桥梁。它负责建立与 SPI 服务器的连接、启动事务、获取快照并执行由 <code>DDL Converter</code> 创建的给定 SQL 查询并销毁连接。对于要处理的每个查询，都会创建和销毁 SPI 连接，这似乎效率不高。由于 SPI 仅在 DDL 期间使用，而这通常不太频繁，因此在性能方面应该没问题。</p>
<h3 id="zh-architecture-debezium_event_processor-11-api"><strong>11) 执行器 API</strong><a class="headerlink" href="#zh-architecture-debezium_event_processor-11-api" title="Permanent link">&para;</a></h3>
<p>也驻留在复制代理中。此组件负责初始化执行器上下文、打开表、获取适当的锁、从 DML 转换器的输出创建 TupleTableSlot (TTS)、调用执行器 API 执行 INSERT、UPDATE、DELETE 操作并进行资源清理。这通常是一种比 SPI 更快的数据操作方法，因为它不需要像 SPI 那样解析输入查询字符串。</p></section><section class="print-page" id="zh-architecture-debezium_runner_components" heading-number="2.3"><h1 id="zh-architecture-debezium_runner_components-debezium-runner-java">Debezium Runner 组件架构 - Java<a class="headerlink" href="#zh-architecture-debezium_runner_components-debezium-runner-java" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-debezium_runner_components-debezium-runner"><strong>Debezium Runner 组件图</strong><a class="headerlink" href="#zh-architecture-debezium_runner_components-debezium-runner" title="Permanent link">&para;</a></h2>
<p><img alt="img" src="/images/synchdb-dbzrunner-component2.jpg" /></p>
<p>Debezium Runner 位于部署的 Java 端。它是嵌入式 Debezium 引擎 (Java) 和 SynchDB Worker (C) 之间的主要中介。它提供了一些 Java 方法，SynchDB Worker 可以通过 JNI 库进行交互。这些交互包括初始化 Debezium 引擎、启动或停止引擎、获取一批变更事件以及将一批标记为完成。这些操作对于确保复制一致性至关重要。主要组件包括：</p>
<ol>
<li>参数类</li>
<li>控制器</li>
<li>发射器</li>
<li>批次管理器</li>
</ol>
<h3 id="zh-architecture-debezium_runner_components-1"><strong>1) 参数类</strong><a class="headerlink" href="#zh-architecture-debezium_runner_components-1" title="Permanent link">&para;</a></h3>
<p>参数类表示一个 JAVA 类，其中包含一系列公开的参数和方法，允许 SynchDB Worker 设置/获取参数值。这些参数会影响 Debezium Runner 和嵌入式 Debezium 的性能。这些参数也已暴露给 PostgreSQL GUC，以便 SynchDB Worker 可以调用相应的方法来设置参数值。这是目前将配置从基于 C 语言的 SynchDB Worker 传递到基于 JAVA 语言的 Debezium Runner 的唯一方法。</p>
<h3 id="zh-architecture-debezium_runner_components-2"><strong>2) 控制器</strong><a class="headerlink" href="#zh-architecture-debezium_runner_components-2" title="Permanent link">&para;</a></h3>
<p>控制器允许 SynchDB 启动或停止嵌入式 Debezium 引擎。这通过 SynchDB Worker 可以调用的几个 JAVA 方法来实现，这些方法可以控制 Debezium 引擎。</p>
<hzh-architecture-debezium_runner_components-3 id="zh-architecture-debezium_runner_components-3"><strong>3) 发射器</strong><a class="headerlink" href="#zh-architecture-debezium_runner_components-3" title="Permanent link">&para;</a></h3>
<p>发射器表示一个 JAVA 方法，该方法由 SynchDB Worker 中的“事件获取器”组件定期调用。它主要负责从“4) 批次管理器”弹出一个批次，将其转换为 JSON 事件字符串列表，并通过 JNI 返回给“事件获取器”。如果批次管理器没有可用的批次，它将返回 NULL，并且“事件获取器”端不会进行任何处理。</p>
<h3 id="zh-architecture-debezium_runner_components-4"><strong>4) 批次管理器</strong><a class="headerlink" href="#zh-architecture-debezium_runner_components-4" title="Permanent link">&para;</a></h3>
<p>批次管理器主要负责接收来自嵌入式 Debezium 引擎的新批次，并将其存储在其内部队列中。该队列比组件图中嵌入式 Debezium 引擎内部的批次队列小得多，并且有所不同。当批次管理器的内部队列已满时，节流控制将激活，暂时停止 Debezium 端的事件生成，直到该小批次队列有可用空间。只有当“发射器”收到来自“事件获取器”的获取请求并从批次管理器弹出批次时，才会从队列中移除该批次。</p>
<p>批次管理器还会为每个弹出的批次分配一个批次 ID，并将其发送到发射器，最终发送到 SynchDB 工作器进行处理。此唯一 ID 与其关联的“提交器”对象一起存储在其内部哈希表中。这些信息对于跟踪非常重要。当 SynchDB 工作进程完成一个批次时，它会在批次管理器中调用“标记批次完成”方法，并包含相同的批次 ID，这有助于批次管理器查找相应的“提交者”对象。提交者对象随后会通知嵌入式 Debezium 引擎该批次已完成，强制其提交并将其内部偏移量向前移动。这确保了在引擎重启后不会再次处理同一个批次（不会重复）。</p></section><section class="print-page" id="zh-architecture-openlog_replicator_event_processor" heading-number="2.4"><h1 id="zh-architecture-openlog_replicator_event_processor-openlog-replicator">Openlog Replicator 事件处理器<a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-openlog-replicator" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-openlog_replicator_event_processor-debezium"><strong>Debezium 事件处理器组件图</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-debezium" title="Permanent link">&para;</a></h2>
<p><img alt="img" src="/images/olr-processor.jpg" /></p>
<p>Openlog Replicator 事件处理器是一个由 SynchDB 扩展启动的 PostgreSQL 后台工作器。它负责连接到 Openlog Replicator、启动复制并获取 JSON 格式的变更事件。该模块的内部组件如下：</p>
<ol>
<li>OLR 客户端</li>
<li>Oracle 解析器</li>
<li>JSON 解析器</li>
<li>对象映射引擎</li>
<li>统计信息收集器</li>
<li>DDL 转换器</li>
<li>DML 转换器</li>
<li>错误处理程序</li>
<li>SPI 客户端</li>
<li>执行器 API</li>
</ol>
<h3 id="zh-architecture-openlog_replicator_event_processor-1-olr"><strong>1) OLR 客户端</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-1-olr" title="Permanent link">&para;</a></h3>
<p>OLR 客户端与 OpenLog Replicator (OLR) 服务器建立 TCP/IP 会话，通过协议握手协商复制流（例如，协议版本和起始偏移量/SCN），然后持续接收以 JSON 格式发送的变更事件。线级帧（握手、确认、心跳）使用 libprotobuf-c 进行编码/解码，并使用直接来自官方 OpenLog Replicator <a href="https://github.com/bersler/OpenLogReplicator">仓库</a> 的 .proto 定义，以确保严格的协议兼容性。解码后，事件被规范化为 JSON，并交由 <code>3) JSON 解析器</code> 进行下游处理。</p>
<h3 id="zh-architecture-openlog_replicator_event_processor-2-oracle"><strong>2) Oracle 解析器</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-2-oracle" title="Permanent link">&para;</a></h3>
<p>Oracle 解析器负责解析 Oracle 查询（仅限 DDL）并生成 PostgreSQL 原始解析树，以便 SynchDB 能够理解其预期操作。SynchDB 的 Oracle 解析器基于 <a href="https://github.com/IvorySQL/IvorySQL">IvorySQL 4</a> 的 PostgreSQL Oracle 解析器，但根据 SynchDB 的需求进行了修改。修改后的 Oracle 解析器的源代码位于 <code>src/backend/olr/oracle_parser</code> 中，它并不支持所有 Oracle 语法。但它足以支持我们想要支持的所有 DDL 命令（见下文）。</p>
<h3 id="zh-architecture-openlog_replicator_event_processor-3-json"><strong>3) JSON 解析器</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-3-json" title="Permanent link">&para;</a></h3>
<p>JSON 解析器负责将传入的 JSON 更改事件解析为 SynchDB 可以使用的 C 语言结构。 SynchDB 依赖于 PostgreSQL 原生的 JSONB 实用程序来满足所有解析和迭代需求。每个 DML 事件都包含 <code>scn</code> 和 <code>commit scn</code> 值，并根据数据类型说明每个列值的表示方式，以及执行前后值。</p>
<p>如果将 DDL 事件与 Debezium 解除关联，Openlog Replicator 的 DDL 事件将包含原始的 Oracle DDL 查询，而不是分解后的结构。这意味着需要一个 <code>2) Oracle 解析器</code> 来进一步解析此 DDL 查询，以了解其预期操作。</p>
<p><strong>DML 负载：</strong>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;scn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3531590</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tm&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1752686342000000000</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;c_scn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3531691</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;c_idx&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;xid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x0007.01a.000004a1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;db&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FREE&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;op&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DBZUSER&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ORDERS&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;obj&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">73406</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ORDER_NUMBER&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ORDER_DATE&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PURCHASER&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;QUANTITY&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PRODUCT_ID&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;scale&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;num&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;rid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AAAR6+AAFAAAACGAAA&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;after&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;ORDER_NUMBER&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10013</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;ORDER_DATE&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1704067200000000000</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;PURCHASER&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1003</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;QUANTITY&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;PRODUCT_ID&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">107</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>DDL 负载：</strong>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;scn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2930816</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tm&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1753384727000000000</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;c_scn&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2930820</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;c_idx&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;xid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x0008.011.000004c7&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;db&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FREE&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;op&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ddl&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DBZUSER&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TEST_TABLE&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;obj&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">74234</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;sql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CREATE TABLE test_table (\n    id NUMBER PRIMARY KEY,\n    binary_double_col BINARY_DOUBLE,\n    binary_float_col BINARY_FLOAT,\n    float_col FLOAT(10),\n    number_col NUMBER(10,2),\n    long_col LONG,\n    date_col DATE,\n    interval_ds_col INTERVAL DAY TO SECOND,\n    interval_ym_col INTERVAL YEAR TO MONTH,\n    timestamp_col TIMESTAMP,\n    timestamp_tz_col TIMESTAMP WITH TIME ZONE,\n    timestamp_ltz_col TIMESTAMP WITH LOCAL TIME ZONE,\n    char_col CHAR(10),\n    nchar_col NCHAR(10),\n    nvarchar2_col NVARCHAR2(50),\n    varchar_col VARCHAR(50),\n    varchar2_col VARCHAR2(50),\n    raw_col RAW(100),\n    bfile_col BFILE,\n    blob_col BLOB,\n    clob_col CLOB,\n    nclob_col NCLOB,\n    rowid_col ROWID,\n    urowid_col UROWID\n)&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="zh-architecture-openlog_replicator_event_processor-4"><strong>4) 对象映射引擎</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-4" title="Permanent link">&para;</a></h3>
<p>对象映射引擎负责加载和维护每个活动连接器下的对象映射信息。这些映射信息告诉 SynchDB 在 DDL 和 DML 处理过程中如何将源对象映射到目标对象。默认情况下，Synchdb 没有对象映射规则，它将使用默认映射规则来处理数据。</p>
<p>一个对象可以引用：
* 表名。
* 列名。
* 数据类型。
* 转换表达式。</p>
<p>在创建映射规则之前，可以使用 <code>synchdb_add_objmap()</code> 函数将源表名、列名和数据类型映射到不同的目标表名、列名和数据类型，所有规则都可以通过查询 <code>synchdb_objmap</code> 表来查看。更多关于对象映射的信息请参见<a href="https://docs.synchdb.com/user-guide/object_mapping_rules/">此处</a>。在 <code>synchdb_att_view()</code> 视图下可以查看映射内容的摘要。</p>
<p>“转换表达式”是一个 SQL 表达式，它将在数据转换完成后、数据应用之前运行（如果指定）。此表达式可以是任何可在 PostgreSQL 中运行的表达式，例如调用其他 SQL 函数或使用运算符。更多关于对象映射规则的信息，请参见<a href="https://docs.synchdb.com/user-guide/object_mapping_rules/">此处</a>。</p>
<h3 id="zh-architecture-openlog_replicator_event_processor-5"><strong>5) 统计收集器</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-5" title="Permanent link">&para;</a></h3>
<p>统计收集器负责收集 SynchDB 自操作开始以来数据处理的统计信息。这包括 DDL 和 DML 的数量、已处理的 CREATE、INSERT、UPDATE 和 DELETE 操作的数量、处理的平均批次大小以及多个时间戳，这些时间戳分别描述了数据在源中首次生成的时间、Debezium 处理数据的时间以及数据在 PostgreSQL 中应用的时间。这些指标可以帮助用户了解 SynchDB 的处理行为，从而调整和优化设置，从而提高处理性能。更多关于统计数据的信息，请访问<a href="https://docs.synchdb.com/user-guide/stats">此处</a>。</p>
<h3 id="zh-architecture-openlog_replicator_event_processor-6-ddl"><strong>6) DDL 转换器</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-6-ddl" title="Permanent link">&para;</a></h3>
<p>DDL 转换器负责将“JSON 解析器”生成的 DDL 数据转换为 PostgreSQL 可以理解的格式。对于 DDL，SynchDB 依赖于 PostgreSQL SPI 引擎进行处理，因此转换的输出是普通的 SQL 查询字符串。DDL 转换器会检查 DDL 数据，并与“对象映射引擎”协作，以正确转换源和目标之间的表、列名或数据类型映射。</p>
<p>如果根据“对象映射引擎”，名为“employee”的远程表要在目标中映射为“staff”，则 DDL 转换器负责解析这些名称映射，并相应地为 SPI 创建 SQL 查询。</p>
<p>该转换器目前可以处理以下 Oracle DDL 操作：</p>
<ul>
<li>创建表</li>
<li>删除表</li>
<li>修改表</li>
<li>修改表添加列</li>
<li>修改表删除列</li>
<li>修改表添加约束</li>
<li>修改表删除约束</li>
</ul>
<h4 id="zh-architecture-openlog_replicator_event_processor-_1">限制<a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-_1" title="Permanent link">&para;</a></h4>
<p>Openlog Replicator 连接器不支持以下在 DDL 命令中声明的 Oracle 特性：</p>
<ul>
<li>虚拟列</li>
<li>带空格的引用表名或列名</li>
<li>索引组织表 (IOT)</li>
<li><code>CREATE TABLE AS</code> 子句</li>
<li><code>CREATE TYPE</code> 子句</li>
<li><code>CREATE TABLE OF</code> 子句</li>
<li><code>ALTER TABLE MODIFY name DEFAULT</code></li>
<li><code>ALTER TABLE MODIFY name NOT NULL</code></li>
<li><code>ALTER TABLE MODIFY name NULL</code></li>
<li><code>ALTER TABLE MODIFY name SET UNUSED</code></li>
<li><code>ALTER TABLE MODIFY name DROP UNUSED COLUMNS</code></li>
<li><code>ALTER TABLE RENAME</code></li>
</ul>
<p>Openlog Replicator 连接器接受但忽略以下约束子句：</p>
<ul>
<li>ENABLE VALIDATE</li>
<li>ENABLE NOVALIDATE</li>
<li>DISABLE VALIDATE</li>
<li>DISABLE NOVALIDATE</li>
</ul>
<p>以下内容将被视为 DEFAULT NULL：</p>
<ul>
<li>DEFAULT ON NULL 'expr'</li>
<li>DEFAULT 'expr'</li>
</ul>
<p>以下语句只能接受一组列定义，而不能接受多组。</p>
<ul>
<li><code>ALTER TABLE MODIFY ADD ...</code></li>
<li><code>ALTER TABLE MODIFY (ADD ...)</code></li>
<li><code>ALTER TABLE MODIFY DROP ...</code> </li>
<li><code>ALTER TABLE MODIFY (DROP ...)</code> </li>
</ul>
<p>&lt;<strong>注意</strong>&gt; 更多限制可能会在我们发现后在此处更新。</p>
<h3 id="zh-architecture-openlog_replicator_event_processor-7-dml"><strong>7) DML 转换器</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-7-dml" title="Permanent link">&para;</a></h3>
<p>DML 转换器负责将“JSON 解析器”生成的 DML 数据转换为 PostgreSQL 可以理解的格式。对于 DML，SynchDB 依赖 PostgreSQL 的执行器 API 将数据直接应用于 PostgreSQL，因此转换的输出为 PostgreSQL 执行器可以理解的 TupleTableSlot (TTS) 格式。为了生成适用于 PostgreSQL 的正确 TTS，DML 转换器依赖于：</p>
<ul>
<li>描述有效载荷数据如何表示的模式元数据</li>
<li>PostgreSQL 目录（pg_class 和 pg_type），用于了解表的信息、每列的数据类型和属性。</li>
<li>对象映射规则，用于确定是否需要对已处理的数据运行额外的转换表达式</li>
<li>需要处理的有效载荷数据本身</li>
</ul>
<p>DML 转换器包含多个例程，这些例程可以处理特定的输入数据类型并生成特定的输出类型。为特定的转换场景选择合适的例程可能是一个挑战，因为某些数据类型可能是用户定义的，或者由 SynchDB 不太了解的其他扩展创建。SynchDB 必须设计为能够处理 PostgreSQL 中可能存在的原生和非原生数据类型。</p>
<p>例程选择首先要查看 PostgreSQL 中创建的数据类型，该数据类型可分为两种类型，每种类型的处理技术略有不同：</p>
<ul>
<li><a href="https://docs.synchdb.com/architecture/native_datatype_handling/">原生数据类型</a>。</li>
<li><a href="https://docs.synchdb.com/architecture/non_native_datatype_handling/">非原生数据类型</a>。</li>
</ul>
<h4 id="zh-architecture-openlog_replicator_event_processor-_2"><strong>数据转换</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-_2" title="Permanent link">&para;</a></h4>
<p>输入数据按上述逻辑处理后，转换器将检查用户是否配置了“转换表达式”，该表达式应在应用于 PostgreSQL 之前应用于已处理的数据。转换表达式可以是任何可在 psql 提示符下运行的 PostgreSQL 表达式、命令或 SQL 函数。它使用“%d”作为占位符，在转换过程中将替换为已处理的数据。例如，转换表达式“'&gt;&gt;&gt;&gt;&gt;' || '%d' || '&lt;&lt;&lt;&lt;&lt;'”将在已处理的字符串数据前添加和后添加其他字符。</p>
<p>因此，如果非原生数据类型的类别为 TYPCATEGORY_USER，而 DML 转换器没有合适的例程来处理此类数据，因此会将其保留原样。我们可以定义一个转换表达式来调用自定义 SQL 函数，以便转换器知道如何正确处理数据并生成合适的输出。例如，表达式“to_my_composite_type('%d')”将调用用户定义的 SQL 函数“to_my_composite_type”，并以数据作为输入。该表达式必须有返回值，因为它将在应用期间被输入到 PostgreSQL 中。</p>
<h3 id="zh-architecture-openlog_replicator_event_processor-8"><strong>8) 错误处理程序</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-8" title="Permanent link">&para;</a></h3>
<p>错误处理程序主要负责处理数据同步各个阶段可能出现的任何错误。格式转换器支持多种错误处理策略，可通过“synchdb.error_handling_strategy”参数进行配置。详细信息请参见<a href="https://docs.synchdb.com/user-guide/configure_error_strategies/">此处</a>。</p>
<h3 id="zh-architecture-openlog_replicator_event_processor-9-spi"><strong>9) SPI 客户端</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-9-spi" title="Permanent link">&para;</a></h3>
<p>SPI 客户端组件位于复制代理 (Replication Agent) 下，充当 PostgreSQL 核心和 SynchDB 之间的桥梁。它负责与 SPI 服务器建立连接、启动事务、获取快照、执行由“DDL 转换器”创建的 SQL 查询并销毁连接。对于每个要处理的查询，都会创建和销毁 SPI 连接，这看起来效率不高。由于 SPI 仅在 DDL 操作期间使用，而 DDL 通常不太频繁，因此性能方面应该不错。</p>
<h3 id="zh-architecture-openlog_replicator_event_processor-10-api"><strong>10) 执行器 API</strong><a class="headerlink" href="#zh-architecture-openlog_replicator_event_processor-10-api" title="Permanent link">&para;</a></h3>
<p>也驻留在复制代理中。此组件负责初始化执行器上下文、打开表、获取适当的锁、从 DML 转换器的输出创建 TupleTableSlot (TTS)、调用执行器 API 执行 INSERT、UPDATE、DELETE 操作以及进行资源清理。通常，这是一种比 SPI 更快的数据操作方法，因为它不需要像 SPI 那样解析输入查询字符串。</p></section><section class="print-page" id="zh-architecture-batch_change_handling" heading-number="2.5"><h1 id="zh-architecture-batch_change_handling-_1">批量变更处理<a class="headerlink" href="#zh-architecture-batch_change_handling-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-batch_change_handling-_2"><strong>概述</strong><a class="headerlink" href="#zh-architecture-batch_change_handling-_2" title="Permanent link">&para;</a></h2>
<p>SynchDB 以 <code>synchdb.naptime</code> 毫秒（默认 100）的周期从 Debezium 运行引擎定期获取一批变更请求。这批变更请求随后由 SynchDB 处理。如果批次中的所有变更请求都已成功处理（解析、转换并应用到 PostgreSQL），SynchDB 将通知 Debezium 运行引擎该批次已完成。这向 Debezium 运行器发出信号，提交直到最后一条成功完成的变更记录的偏移量。通过这种机制，SynchDB 能够跟踪每条变更记录，并指示 Debezium 运行器不要获取之前已处理的旧变更，或不要发送重复的变更记录。</p>
<h2 id="zh-architecture-batch_change_handling-_3"><strong>批量处理</strong><a class="headerlink" href="#zh-architecture-batch_change_handling-_3" title="Permanent link">&para;</a></h2>
<p>SynchDB 在一个事务内处理一批变更（也叫一个 batch）。这意味着一批内的变更事件要么全部处理，要么全部不处理。当所有更改都成功处理后，SynchDB 会向 Debezium 运行器引擎发送一条消息，将批处理标记为已处理完成。此操作会导致偏移量（offset）被提交并最终刷新到磁盘。偏移量表示复制期间的逻辑位置，类似于 PostgreSQL 中的 LSN（日志序列号）。</p>
<p><img alt="img" src="/images/synchdb-batch-new.jpg" /></p>
<p>如果一批更改在 PostgreSQL 上部分成功，则会导致事务回滚，并且 SynchDB 不会通知 Debezium 运行器批处理已完成。当连接器重新启动时，同一批将再次恢复处理。</p></section><section class="print-page" id="zh-architecture-non_native_datatype_handling" heading-number="2.6"><h1 id="zh-architecture-non_native_datatype_handling-none-native-data-type-handling">None-native Data Type Handling<a class="headerlink" href="#zh-architecture-non_native_datatype_handling-none-native-data-type-handling" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-non_native_datatype_handling-handling-non-native-data-types"><strong>Handling Non-Native Data Types</strong><a class="headerlink" href="#zh-architecture-non_native_datatype_handling-handling-non-native-data-types" title="Permanent link">&para;</a></h2>
<p>It is possible that a table contains a column data type that is custom created by the user or created by another installed extension. In this case, it cannot be processed using tradition native data type handling becasue the type is most likely not supported natively. Instead, the DML Converter accesses the catalog, obtains the OID of the non-native data type, and looks up its "category" as defined in PostgreSQL. Below is a list of category supported by PostgreSQL as of version 17:</p>
<div class="highlight"><pre><span></span><code>#define  TYPCATEGORY_INVALID    &#39;\0&#39;
#define  TYPCATEGORY_ARRAY      &#39;A&#39;
#define  TYPCATEGORY_BOOLEAN    &#39;B&#39;
#define  TYPCATEGORY_COMPOSITE  &#39;C&#39;
#define  TYPCATEGORY_DATETIME   &#39;D&#39;
#define  TYPCATEGORY_ENUM       &#39;E&#39;
#define  TYPCATEGORY_GEOMETRIC  &#39;G&#39;
#define  TYPCATEGORY_NETWORK    &#39;I&#39;
#define  TYPCATEGORY_NUMERIC    &#39;N&#39;
#define  TYPCATEGORY_PSEUDOTYPE &#39;P&#39;
#define  TYPCATEGORY_RANGE      &#39;R&#39;
#define  TYPCATEGORY_STRING     &#39;S&#39;
#define  TYPCATEGORY_TIMESPAN   &#39;T&#39;
#define  TYPCATEGORY_USER       &#39;U&#39;
#define  TYPCATEGORY_BITSTRING  &#39;V&#39;
#define  TYPCATEGORY_UNKNOWN    &#39;X&#39;
</code></pre></div>
<p>The category tells DML Converter about the nature of the data type (numeric? string? datetime? ...etc) to help the converter select the right routine to process. For most cases, using type category paired with the DBZ metadata that describes how the input data payload is formatted is sufficient to select the right routine to process the data. However, in some cases, it may not be sufficient. For example, custom DATE, TIME, TIMESTAMP date types could all be categorized under <code>TYPCATEGORY_DATETIME</code>, so the converter does not know if it is working with a DATE, TIME or TIMESTAMP as each would produce different time formats. Currently, the covnerter looks for certain keywords from the data type name to identify. In the future, we may expose this part to let the user tell the converter exactly which routine to use should there be an ambiguity. Another example would be <code>TYPCATEGORY_USER</code> and <code>TYPCATEGORY_GEOMETRIC</code> which does not clearly indicate the data format. For these categories, the converter currently does not perform any further processing as it simply leaves the data payload as is. PostgreSQL may or may not reject such unprocessed data. This is why the transform feature next is important to give the DML converter a final chance to correct its data payload.</p></section><section class="print-page" id="zh-architecture-native_datatype_handling" heading-number="2.7"><h1 id="zh-architecture-native_datatype_handling-_1">处理原生数据类型<a class="headerlink" href="#zh-architecture-native_datatype_handling-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-native_datatype_handling-_2"><strong>处理原生数据类型</strong><a class="headerlink" href="#zh-architecture-native_datatype_handling-_2" title="Permanent link">&para;</a></h2>
<p>下图显示了受支持的本机数据类型列表以及 SynchDB 如何根据其性质（或类别）将它们分组在一起。例如，数字组包含所有本质上是数字的整数或浮点数据类型。如果数据包含非数字字符，它们将给出错误。同样，不同的数据类型组需要特定的数据格式才能应用。</p>
<p><img alt="img" src="/images/synchdb-native-types5.jpg" /></p>
<p>现在 DML 转换器知道如何在 PostgreSQL 端为这些受支持的本机数据类型生成数据，然后它会查看 DBZ 元数据以了解源数据的表示方式。这是必要的，因为 Debezium 引擎可能会对数据进行编码以打包更多需要在处理数据之前解码的信息，或者使用结构来表示复杂的数据类型，如几何图形。如果不知道 Debezium 如何表示数据，数据处理可能会产生不理想的结果，导致 PostgreSQL 在应用期间出错。以下是 Debezium 可以表示有效负载数据的格式类型列表：</p>
<p><img alt="img" src="/images/synchdb-dbztype.jpg" /></p>
<p>有了这两条信息，DML 转换器就知道输入是什么样子，输出应该是什么样子。它将从其函数矩阵中选择最佳处理程序来处理数据。例如，如果目标类型为“FLOAT4”，源数据类型格式为“DBZTYPE_BYTES”，则将选择函数“handle_base64_to_numeric()”来处理数据。所选函数负责解码二进制输入并将其计算为数字。</p></section><section class="print-page" id="zh-architecture-metadata_files" heading-number="2.8"><h1 id="zh-architecture-metadata_files-_1">元数据文件<a class="headerlink" href="#zh-architecture-metadata_files-_1" title="Permanent link">&para;</a></h1>
<p>在操作过程中，Debezium 运行引擎在 $PGDATA/pg_synchdb 下生成元数据文件。目前生成并持久化了两种类型的元数据文件：
* 偏移量文件：包含在启动时恢复复制操作的偏移量
* 架构历史文件：包含为复制构建所有表的架构信息。这在初始数据快照同步期间创建，并可在操作期间更新。</p>
<p>这些元数据文件名由以下部分组成：</p>
<ul>
<li>
<p>(连接器类型)<em>(连接器名称)</em>(目标数据库)_offsets.dat</p>
</li>
<li>
<p>(连接器类型)<em>(连接器名称)</em>(目标数据库)_schemahistory.dat</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>ls $PGDATA/pg_synchdb
mysql_mysqlconn_postgres_offsets.dat        sqlserver_sqlserverconn_postgres_offsets.dat
mysql_mysqlconn_postgres_schemahistory.dat  sqlserver_sqlserverconn_postgres_schemahistory.dat
</code></pre></div>
<p>这些二进制文件的内容可以使用 hexdump 命令查看：
<div class="highlight"><pre><span></span><code>hexdump -C $PGDATA/pg_synchdb/mysql_mysqlconn_postgres_offsets.dat
hexdump -C $PGDATA/pg_synchdb/mysql_mysqlconn_postgres_schemahistory.dat
</code></pre></div></p>
<h2 id="zh-architecture-metadata_files-_2"><strong>重置连接器</strong><a class="headerlink" href="#zh-architecture-metadata_files-_2" title="Permanent link">&para;</a></h2>
<p>连接器可以重置（重新复制和重新同步）所有指定表，只需：</p>
<ul>
<li>停止连接器</li>
<li>删除偏移量和架构历史文件</li>
<li>启动连接器</li>
</ul></section><section class="print-page" id="zh-architecture-ddl_replication" heading-number="2.9"><h1 id="zh-architecture-ddl_replication-ddl">DDL 复制<a class="headerlink" href="#zh-architecture-ddl_replication-ddl" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-ddl_replication-_1"><strong>概述</strong><a class="headerlink" href="#zh-architecture-ddl_replication-_1" title="Permanent link">&para;</a></h2>
<p>SynchDB 为数据定义语言（DDL）操作提供全面支持，实现不同数据库系统之间的实时架构同步。</p>
<h2 id="zh-architecture-ddl_replication-ddl_1"><strong>支持的 DDL 命令</strong><a class="headerlink" href="#zh-architecture-ddl_replication-ddl_1" title="Permanent link">&para;</a></h2>
<p>SynchDB 支持以下 DDL 操作：</p>
<p>✅ CREATE [table]<br />
✅ ALTER [table] ADD COLUMN<br />
✅ ALTER [table] DROP COLUMN<br />
✅ ALTER [table] ALTER COLUMN<br />
✅ DROP [table]  </p>
<p>对于基于 Openlog Replicator 的连接器，支持以下 Oracle DDL 语法：</p>
<p>✅ CREATE [table]
✅ DROP [table]
✅ ALTER [table] MODIFY
✅ ALTER [table] ADD COLUMN
✅ ALTER [table] DROP COLUMN
✅ ALTER [table] ADD CONSTRAINT
✅ ALTER [table] DROP CONSTRAINT</p>
<h2 id="zh-architecture-ddl_replication-_2"><strong>详细命令支持</strong><a class="headerlink" href="#zh-architecture-ddl_replication-_2" title="Permanent link">&para;</a></h2>
<h3 id="zh-architecture-ddl_replication-create-table"><strong>CREATE TABLE</strong><a class="headerlink" href="#zh-architecture-ddl_replication-create-table" title="Permanent link">&para;</a></h3>
<p>SynchDB 在 CREATE TABLE 事件期间捕获以下属性：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>表名</td>
<td>完全限定名称（FQN）格式</td>
</tr>
<tr>
<td>列名</td>
<td>单独的列标识符</td>
</tr>
<tr>
<td>数据类型</td>
<td>列数据类型规范</td>
</tr>
<tr>
<td>数据长度</td>
<td>长度/精度规范（如适用）</td>
</tr>
<tr>
<td>无符号标志</td>
<td>数值类型的无符号约束</td>
</tr>
<tr>
<td>可空性</td>
<td>NULL/NOT NULL 约束</td>
</tr>
<tr>
<td>默认值</td>
<td>默认值表达式</td>
</tr>
<tr>
<td>主键</td>
<td>主键列定义</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意</strong>：当前不支持其他 CREATE TABLE 属性</p>
</blockquote>
<h3 id="zh-architecture-ddl_replication-drop-table"><strong>DROP TABLE</strong><a class="headerlink" href="#zh-architecture-ddl_replication-drop-table" title="Permanent link">&para;</a></h3>
<p>捕获的属性：
- 要删除的表名（FQN 格式）</p>
<h3 id="zh-architecture-ddl_replication-alter-table-add-column"><strong>ALTER TABLE ADD COLUMN</strong><a class="headerlink" href="#zh-architecture-ddl_replication-alter-table-add-column" title="Permanent link">&para;</a></h3>
<p>捕获以下属性：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>列名</td>
<td>新添加列的名称</td>
</tr>
<tr>
<td>数据类型</td>
<td>新列的数据类型</td>
</tr>
<tr>
<td>数据长度</td>
<td>长度规范（如适用）</td>
</tr>
<tr>
<td>无符号标志</td>
<td>无符号约束</td>
</tr>
<tr>
<td>可空性</td>
<td>NULL/NOT NULL 规范</td>
</tr>
<tr>
<td>默认值</td>
<td>默认值表达式</td>
</tr>
<tr>
<td>主键</td>
<td>更新的主键定义</td>
</tr>
</tbody>
</table>
<p>目前不支持在 ALTER TABLE ADD COLUMN 期间可以指定的其他属性。</p>
<h3 id="zh-architecture-ddl_replication-alter-table-drop-column"><strong>ALTER TABLE DROP COLUMN</strong><a class="headerlink" href="#zh-architecture-ddl_replication-alter-table-drop-column" title="Permanent link">&para;</a></h3>
<p>捕获：
- 要删除的列名列表</p>
<h3 id="zh-architecture-ddl_replication-alter-table-alter-column"><strong>ALTER TABLE ALTER COLUMN</strong><a class="headerlink" href="#zh-architecture-ddl_replication-alter-table-alter-column" title="Permanent link">&para;</a></h3>
<p>支持的修改：</p>
<table>
<thead>
<tr>
<th>修改</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据类型</td>
<td>更改列数据类型</td>
</tr>
<tr>
<td>类型长度</td>
<td>修改类型长度/精度</td>
</tr>
<tr>
<td>默认值</td>
<td>更改/删除默认值</td>
</tr>
<tr>
<td>NOT NULL</td>
<td>修改/删除 NOT NULL 约束</td>
</tr>
</tbody>
</table>
<p>目前不支持在 ALTER TABLE ALTER COLUMN 期间可以指定的其他属性。</p>
<p>请注意，SynchDB 仅支持对现有列进行基本的数据类型更改。例如，<code>INT</code> → <code>BIGINT</code> 或 <code>VARCHAR</code> → <code>TEXT</code>。目前不支持复杂的数据类型更改，如 <code>TEXT</code> → <code>INT</code> 或 <code>INT</code> → <code>TIMESTAMP</code>。这是因为 PostgreSQL 要求用户额外提供类型转换函数来执行复杂数据类型更改的类型转换。SynchDB 目前不知道对特定类型转换使用什么类型转换函数。将来，我们可能允许用户通过规则文件提供自己的转换函数用于特定类型转换，但目前尚不支持。</p>
<h2 id="zh-architecture-ddl_replication-_3"><strong>数据库特定行为</strong><a class="headerlink" href="#zh-architecture-ddl_replication-_3" title="Permanent link">&para;</a></h2>
<h3 id="zh-architecture-ddl_replication-mysql-ddl"><strong>MySQL DDL 更改事件</strong><a class="headerlink" href="#zh-architecture-ddl_replication-mysql-ddl" title="Permanent link">&para;</a></h3>
<p>由于 MySQL 在 binlog 和 Oracle 在 logminer 中同时记录 DDL 和 DML 操作，SynchDB 能够在它们发生时复制 DDL 和 DML。在 MySQL 和 Oracle 端不需要特殊操作来启用 DDL 复制。</p>
<h3 id="zh-architecture-ddl_replication-sqlserver-ddl"><strong>SQLServer DDL 更改事件</strong><a class="headerlink" href="#zh-architecture-ddl_replication-sqlserver-ddl" title="Permanent link">&para;</a></h3>
<p>SQLServer 在流模式下不原生支持 DDL 复制。表架构是在连接器首次启动时的初始快照构建阶段由 SynchDB 构建的。在此阶段之后，SynchDB 将尝试检测任何架构更改，但需要明确将其添加到 SQL Server 的 CDC 表列表中。</p>
<h4 id="zh-architecture-ddl_replication-sqlserver-create-table"><strong>在 SQLServer 上触发 CREATE TABLE 事件</strong><a class="headerlink" href="#zh-architecture-ddl_replication-sqlserver-create-table" title="Permanent link">&para;</a></h4>
<p>要在 SQL Server 上创建新表并添加到其 CDC 表列表中：
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">altertest</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="nb">TEXT</span>
<span class="w">    </span><span class="p">);</span>
<span class="k">GO</span>

<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;altertest&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">role_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">capture_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo_altertest_1&#39;</span>
<span class="k">GO</span>
</code></pre></div></p>
<p>该命令将表 <code>dbo.altertest</code> 添加到 CDC 表列表中，并将导致 SynchDB 接收 CREATE TABLE DDL 更改事件。</p>
<h4 id="zh-architecture-ddl_replication-alter-table"><strong>触发 ALTER TABLE 事件</strong><a class="headerlink" href="#zh-architecture-ddl_replication-alter-table" title="Permanent link">&para;</a></h4>
<p>如果更改了现有表（添加、删除或更改列），需要明确更新到 SQLServer 的 CDC 表列表中，以便 SynchDB 能够接收 ALTER TABLE 事件。</p>
<p>例如：</p>
<p>在 SQLServer 中更改表：
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">altertest</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="k">MAX</span><span class="p">),</span>
<span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">e</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">f</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">PK_altertest</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">d</span><span class="p">,</span>
<span class="w">    </span><span class="n">f</span>
<span class="w">    </span><span class="p">);</span>
<span class="k">GO</span>
</code></pre></div></p>
<p>禁用旧的捕获实例：
<div class="highlight"><pre><span></span><code><span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_disable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;altertest&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">capture_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo_altertest_1&#39;</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></p>
<p>启用为新的捕获实例：
<div class="highlight"><pre><span></span><code><span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;altertest&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">role_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="o">@</span><span class="n">capture_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo_altertest_2&#39;</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div></p>
<p>添加新记录：
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">altertest</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="k">GO</span>
</code></pre></div></p>
<p>上述示例应允许 SynchDB 接收 ALTER TABLE ADD COLUMN 和 INSERT 事件。无需重启 SQL Server 或 SynchDB 即可捕获此类事件。这同样适用于 ALTER TABLE DROP COLUMN 和 ALTER TABLE ALTER COLUMN 事件。</p></section><section class="print-page" id="zh-architecture-fdw_based_snapshot" heading-number="2.10"><h1 id="zh-architecture-fdw_based_snapshot-fdw">基於 FDW 的快照<a class="headerlink" href="#zh-architecture-fdw_based_snapshot-fdw" title="Permanent link">&para;</a></h1>
<h2 id="zh-architecture-fdw_based_snapshot-_1"><strong>概述</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-_1" title="Permanent link">&para;</a></h2>
<p>所有連接器都支援基於 Debezium 的初始快照，該快照可將遠端表格模式移轉到 PostgreSQL，無論是否包含初始資料（取決於所使用的快照模式）。這種方法在大多數情況下都有效，但當需要遷移大量資料表時，可能會出現效能問題，並且會透過 JNI 呼叫引入額外的開銷。如果來源資料庫（例如 Oracle）支援 "FLASHBACK" 查詢，則可以使用外部資料包裝器 (FDW) 實作相同的初始快照。 "FLASHBACK"查詢可以確保快照遷移到某個 "偏移"（Oracle 中的 SCN），從而確保到某個時間點的讀取一致性，然後從該時間點開始 CDC 串流傳輸。</p>
<p>目前，我們僅支援使用 oracle_fdw 作為原生 Openlog Replicator (OLR) 連接器的 Debezium 快照的替代方案。未來，如果可行的話，我們可能會添加對其他連接器的支援。若要使用基於 FDW 的快照，只需將 GUC 參數 <code>synchdb.olr_snapshot_engin</code> 設定為 "fdw" 。請參閱<a href="https://docs.synchdb.com/zh/user-guide/configure_snapshot_engine/">此處</a> 以取得建置和安裝 oracle_fdw 的快速指南。</p>
<h2 id="zh-architecture-fdw_based_snapshot-fdw_1"><strong>基於 FDW 的快照如何運作</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-fdw_1" title="Permanent link">&para;</a></h2>
<p>基於 FDW 的快照大約包含 10 個步驟：</p>
<h3 id="zh-architecture-fdw_based_snapshot-1"><strong>1. 準備</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-1" title="Permanent link">&para;</a></h3>
<p>此步驟檢查 <code>oracle_fdw</code> 是否已安裝且可用，並根據 <code>synchdb_add_conninfo</code> 建立的連接器資訊建立 <code>server</code> 和 <code>user</code> 對應。</p>
<h3 id="zh-architecture-fdw_based_snapshot-2-oracle"><strong>2. 建立 Oracle 物件視圖</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-2-oracle" title="Permanent link">&para;</a></h3>
<p>此步驟在 PostgreSQL 中，在單獨的模式（例如 <code>ora_obj</code>）中建立多個外部表。這些外部表（查詢時）透過 oracle_fdw 連接到 Oracle，並取得 Oracle 上大多數（如果不是全部）可用的物件。這些對象包括：</p>
<ul>
<li>表</li>
<li>列</li>
<li>鍵</li>
<li>索引</li>
<li>函數</li>
<li>序列</li>
<li>視圖</li>
<li>觸發器</li>
<li>等等</li>
</ul>
<p>SynchDB 無需考慮每個物件即可完成初始快照；它僅考慮 "表"、 "列" 和 "鍵" 物件來建立 PostgreSQL 中的表。</p>
<h3 id="zh-architecture-fdw_based_snapshot-3-scn"><strong>3. 建立外部表以取得目前 SCN</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-3-scn" title="Permanent link">&para;</a></h3>
<p>此外部表（查詢時）將連接到 Oracle 並取得目前 SCN 值。此值將作為初始快照的 "截止" 點。此點之後的新變更將不包含在快照中。</p>
<h3 id="zh-architecture-fdw_based_snapshot-4"><strong>4.建立所需外部表格清單</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-4" title="Permanent link">&para;</a></h3>
<p>此步驟的目標是建立一個新的暫存模式（例如 ora_stage），並基於下列條件為快照建立所需的外部表：</p>
<ul>
<li>步驟 2 中建立的 Oracle 物件視圖</li>
<li>SynchDB 在 <code>synchdb_conninfo</code> 中的 <code>data-&gt;'snapshottable'</code> 參數 -&gt; 這是 SynchDB 執行快照所需的資料表的篩選器。如果設定為 <code>null</code>，則所有表都將被視為快照。</li>
<li>額外的資料類型映射，如 <code>synchdb_objmap</code> 中所述</li>
<li>步驟 3 中獲得的截止 SCN</li>
</ul>
<p>此步驟結束時，暫存模式將包含具有 <code>AS OF SCN xxx</code> 屬性的外部表，其資料類型根據 SynchDB 的資料類型對應規則進行對應。這些外部表將僅傳回 SCN 集之前的數據，並且仍然需要 oracle_fdw 連接到 Oracle。</p>
<h3 id="zh-architecture-fdw_based_snapshot-5"><strong>5.物化模式</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-5" title="Permanent link">&para;</a></h3>
<p>此步驟的目標是僅物化步驟 4 中建立的表模式（將外部表轉換為真正的 PostgreSQL 表），並將其放入新的目標模式（例如 dst_stage）。因此，在此步驟結束時，目標模式將包含與暫存模式中結構相同的真實表。</p>
<h3 id="zh-architecture-fdw_based_snapshot-6"><strong>6. 遷移主鍵</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-6" title="Permanent link">&para;</a></h3>
<p>基於步驟 2 中建立的 Oracle 物件視圖，對步驟 5 中建立的物化表執行 <code>ALTER TABLE ADD PRIMARY KEY</code> 命令，以根據需要新增主鍵。</p>
<h3 id="zh-architecture-fdw_based_snapshot-7"><strong>7. 應用列名映射</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-7" title="Permanent link">&para;</a></h3>
<p>基於 <code>synchdb_objmap</code> 中所述的列名映射，對步驟 5 中建立的物化表執行 <code>ALTER TABLE RENAME COLUMN</code> 命令，以根據需要更改列名。</p>
<h3 id="zh-architecture-fdw_based_snapshot-8"><strong>8.使用轉換遷移資料</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-8" title="Permanent link">&para;</a></h3>
<p>此步驟的目標是將表格資料​​從暫存區遷移到目標模式，並執行 <code>synchdb_objmap</code> 中描述的任何值轉換，大致如下：</p>
<ul>
<li>遠端查詢</li>
<li>数据轉換</li>
<li>本地插入</li>
</ul>
<h3 id="zh-architecture-fdw_based_snapshot-9"><strong>9. 應用表名映射</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-9" title="Permanent link">&para;</a></h3>
<p>資料遷移完成後，SynchDB 將套用 <code>synchdb_objmap</code> 中所描述的表名映射。之所以最後執行此操作，是因為表名映射可能會將表移動到我們不希望在物化過程中發生的其他模式。</p>
<h3 id="zh-architecture-fdw_based_snapshot-10"><strong>10. 完成初始快照</strong><a class="headerlink" href="#zh-architecture-fdw_based_snapshot-10" title="Permanent link">&para;</a></h3>
<p>此時初始快照即視為完成。此步驟將執行下列清理操作：</p>
<ul>
<li>刪除步驟 1 中建立的伺服器和使用者映射</li>
<li>刪除步驟 2 中建立的 Oracle 物件視圖</li>
<li>刪除步驟 4 中建立的暫存模式</li>
<li>刪除步驟 3 中建立的外部表以傳回目前 SCN</li>
</ul>
<p>步驟 5 中建立的目標模式中的表格是初始快照的最終結果。</p></section></section>
                    <section class='print-page md-section' id='section-3' heading-number='3'>
                        <h1>快速入门<a class='headerlink' href='#section-3' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="zh-getting-started-installation" heading-number="3.1"><h1 id="zh-getting-started-installation-_1">安装<a class="headerlink" href="#zh-getting-started-installation-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-getting-started-installation-_2"><strong>从软件包安装</strong><a class="headerlink" href="#zh-getting-started-installation-_2" title="Permanent link">&para;</a></h2>
<p>访问我们的<a href="https://github.com/Hornetlabs/synchdb/releases">发布页面</a> 下载 synchdb 软件包。</p>
<h3 id="zh-getting-started-installation-deb"><strong>.deb 包</strong><a class="headerlink" href="#zh-getting-started-installation-deb" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>从官方 apt 存储库安装 PostgreSQL（版本 16 为例）：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>postgresql-common
sudo<span class="w"> </span>/usr/share/postgresql-common/pgdg/apt.postgresql.org.sh
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>postgresql-16
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>安装 Java 运行时环境：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>openjdk-17-jre-headless
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>更新共享库路径：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">JAVA_PATH</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>java<span class="k">)</span>
<span class="nv">JRE_HOME_PATH</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">JAVA_PATH</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s:/bin/java::&#39;</span><span class="k">)</span>
<span class="nv">JRE_LIB_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">JRE_HOME_PATH</span><span class="si">}</span>/lib
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$JRE_LIB_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/ld.so.conf.d/java.conf
sudo<span class="w"> </span>ldconfig
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>安装 SynchDB：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>dpkg<span class="w"> </span>-i<span class="w"> </span>synchdb-1.1-1.ub22.pg16_x86_64.deb
</code></pre></div></td></tr></table></div></p>
</li>
<li>SynchDB 应该已准备就绪。请参阅 <a href="https://docs.synchdb.com/zh/user-guide/quick_start/">快速入门</a> 页面开始使用</li>
</ol>
<h3 id="zh-getting-started-installation-rpm"><strong>.rpm 软件包</strong><a class="headerlink" href="#zh-getting-started-installation-rpm" title="Permanent link">&para;</a></h3>
<ol>
<li>从官方 rpm 仓库安装 PostgreSQL（版本 16 为例）：
其他 PostgreSQL 版本的官方 rpm 下载说明，请参考此处 (<a href="https://www.postgresql.org/download/linux/redhat/">https://www.postgresql.org/download/linux/redhat/</a>)
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm
sudo<span class="w"> </span>dnf<span class="w"> </span>-qy<span class="w"> </span>module<span class="w"> </span>disable<span class="w"> </span>postgresql
sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>postgresql16-server<span class="w"> </span>postgresql16-contrib
</code></pre></div></td></tr></table></div></li>
<li>
<p>安装 Java 运行环境：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>java-17-openjdk
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>更新共享库路径：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">JAVA_PATH</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>java<span class="k">)</span>
<span class="nv">JRE_HOME_PATH</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">JAVA_PATH</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s:/bin/java::&#39;</span><span class="k">)</span>
<span class="nv">JRE_LIB_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">JRE_HOME_PATH</span><span class="si">}</span>/lib
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$JRE_LIB_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/ld.so.conf.d/java.conf
sudo<span class="w"> </span>ldconfig
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>安装 SynchDB：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>synchdb-1.1-1.el9.pg16.x86_64.rpm
</code></pre></div></td></tr></table></div></p>
</li>
<li>SynchDB 应该已准备就绪。请参阅 <a href="https://docs.synchdb.com/zh/user-guide/quick_start/">快速入门</a> 页面开始使用</li>
</ol>
<h2 id="zh-getting-started-installation-_3"><strong>从预编译的二进制文件安装</strong><a class="headerlink" href="#zh-getting-started-installation-_3" title="Permanent link">&para;</a></h2>
<p>访问我们的<a href="https://github.com/Hornetlabs/synchdb/releases">发布页面</a> 下载预编译二进制文件。我们目前支持基于 Debian 的 Linux 系统（如 Ubuntu）系统上的预编译二进制文件。其他平台将在不久的将来得到支持。SynchDB 预编译二进制文件需要先安装 PostgreSQL。它所需的 PostgreSQL 版本在包名称中描述。例如，<code>synchdb-1.1-1.ub22.pg16_x86_64.tar.gz</code> 是在 Ubuntu 22.04 上针对 PostgreSQL 16 编译的二进制文件。</p>
<h3 id="zh-getting-started-installation-_4"><strong>预编译二进制文件</strong><a class="headerlink" href="#zh-getting-started-installation-_4" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>解压预编译二进制文件的 tar.gz 包：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tar<span class="w"> </span>xzvf<span class="w"> </span>synchdb-1.1-1.ub22.pg16_x86_64.tar.gz<span class="w"> </span>-C<span class="w"> </span>/tmp
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>找出当前 PostgreSQL 的 lib 和 share 目录
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">LIBDIR</span><span class="o">=</span><span class="k">$(</span>pg_config<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-w<span class="w"> </span>LIBDIR<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="w"> </span><span class="s1">&#39; = &#39;</span><span class="w"> </span><span class="s1">&#39;/LIBDIR/ {print $2}&#39;</span><span class="k">)</span>
<span class="nv">SHAREDIR</span><span class="o">=</span><span class="k">$(</span>pg_config<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-w<span class="w"> </span>SHAREDIR<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="w"> </span><span class="s1">&#39; = &#39;</span><span class="w"> </span><span class="s1">&#39;/SHAREDIR/ {print $2}&#39;</span><span class="k">)</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>将预编译的二进制文件复制到相应目录：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>cp<span class="w"> </span>/tmp/synchdb-1.1-1.ub22.pg16_x86_64/usr/lib/postgresql/16/lib/*<span class="w"> </span><span class="nv">$LIBDIR</span>
cp<span class="w"> </span>/tmp/synchdb-1.1-1.ub22.pg16_x86_64/usr/share/postgresql/16/extension/*<span class="w"> </span><span class="nv">$SHAREDIR</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>安装 Java Runtime Environment：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>openjdk-17-jre-headless
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>更新共享库路径：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">JAVA_PATH</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>java<span class="k">)</span>
<span class="nv">JRE_HOME_PATH</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">JAVA_PATH</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s:/bin/java::&#39;</span><span class="k">)</span>
<span class="nv">JRE_LIB_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">JRE_HOME_PATH</span><span class="si">}</span>/lib
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$JRE_LIB_PATH</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/ld.so.conf.d/java.conf
sudo<span class="w"> </span>ldconfig
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>SynchDB 应该已准备就绪。请参阅 <a href="https://docs.synchdb.com/zh/user-guide/quick_start/">快速入门</a> 页面开始使用</p>
</li>
</ol>
<h2 id="zh-getting-started-installation-_5"><strong>源代码编译及安装</strong><a class="headerlink" href="#zh-getting-started-installation-_5" title="Permanent link">&para;</a></h2>
<p>此选项要求您从源代码构建和安装 PostgreSQL 和 SynchDB。</p>
<h3 id="zh-getting-started-installation-_6"><strong>系统要求</strong><a class="headerlink" href="#zh-getting-started-installation-_6" title="Permanent link">&para;</a></h3>
<p>构建和运行SynchDB需要以下软件。列出的版本是开发过程中测试过的版本。较旧的版本可能仍然可用。</p>
<ul>
<li>Java Development Kit 22. 下载地址：<a href="https://www.oracle.com/ca-en/java/technologies/downloads/">点击这里</a></li>
<li>Apache Maven 3.9.8. 下载地址：<a href="https://maven.apache.org/download.cgi">点击这里</a></li>
<li>PostgreSQL 源代码. Git克隆地址：<a href="https://github.com/postgres/postgres">点击这里</a>. PostgreSQL编译要求请参考此<a href="https://wiki.postgresql.org/wiki/Compile_and_Install_from_source_code">wiki</a></li>
<li>Docker compose 2.28.1 (用于测试). 参考<a href="https://docs.docker.com/compose/install/linux/">安装指南</a></li>
<li>基于Unix的操作系统，如Ubuntu 22.04或MacOS</li>
</ul>
<p><strong>Openlog Replicator 连接器支持的额外要求（如果在构建过程中启用）</strong></p>
<ul>
<li>libprotobuf-c v1.5.2。请参阅<a href="https://github.com/protobuf-c/protobuf-c.git">此处</a> 从源代码构建。</li>
</ul>
<p><strong>如果您想使用基於 FDW 的快照，則需要以下內容：</strong></p>
<ul>
<li>OCI v23.9.0。更多資訊請參閱<a href="https://docs.synchdb.com/user-guide/configure_snapshot_engine/">此處</a>。</li>
<li>oracle_fdw v2.8.0。如何從原始碼建置？請參閱<a href="https://github.com/laurenz/oracle_fdw">此處</a>。</li>
</ul>
<h3 id="zh-getting-started-installation-synchdb-mysqlsql-server-oracle"><strong>預設 SynchDB 建置 - 支援 MySQL、SQL Server 和 Oracle 連接器</strong><a class="headerlink" href="#zh-getting-started-installation-synchdb-mysqlsql-server-oracle" title="Permanent link">&para;</a></h3>
<p>如果您已安裝 PostgreSQL，則可以使用 PGXS 建置並安裝預設 SynchDB。請注意，您的 PostgreSQL 安裝必須包含 SynchDB 所需的 pgcrypto 插件。</p>
<div class="highlight"><pre><span></span><code><span class="nv">USE_PGXS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>make<span class="w"> </span><span class="nv">PG_CONFIG</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>pg_config<span class="k">)</span>
<span class="nv">USE_PGXS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>make<span class="w"> </span>build_dbz<span class="w"> </span><span class="nv">PG_CONFIG</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>pg_config<span class="k">)</span>

sudo<span class="w"> </span><span class="nv">USE_PGXS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>make<span class="w"> </span><span class="nv">PG_CONFIG</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>pg_config<span class="k">)</span><span class="w"> </span>install
sudo<span class="w"> </span><span class="nv">USE_PGXS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>make<span class="w"> </span>install_dbz<span class="w"> </span><span class="nv">PG_CONFIG</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>pg_config<span class="k">)</span>
</code></pre></div>
<h3 id="zh-getting-started-installation-openlog-replicator-synchdb"><strong>建構支援 Openlog Replicator 連接器的 SynchDB</strong><a class="headerlink" href="#zh-getting-started-installation-openlog-replicator-synchdb" title="Permanent link">&para;</a></h3>
<p>要建置支援 Openlog Replicator 連接器的 SynchDB，還需要建置一個額外的 SynchDB Oracle 解析器元件。此元件基於 IvorySQL 的 Oracle 解析器，並針對 SynchDB 進行了修改，需要 PostgreSQL 後端原始程式碼才能成功建置。以下是具體步驟：</p>
<h4 id="zh-getting-started-installation-163"><strong>准备源代码（以16.3为例）</strong><a class="headerlink" href="#zh-getting-started-installation-163" title="Permanent link">&para;</a></h4>
<p>複製 PostgreSQL 原始碼並切換到 16.3 版本標籤</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/postgres/postgres.git
<span class="nb">cd</span><span class="w"> </span>postgres
git<span class="w"> </span>checkout<span class="w"> </span>REL_16_3
</code></pre></div></td></tr></table></div>
<p>從擴充資料夾內克隆 SynchDB 原始碼</p>
<p>注意：目前使用分支 <em>(synchdb-devel)[<a href="https://github.com/Hornetlabs/synchdb/tree/synchdb-devel">https://github.com/Hornetlabs/synchdb/tree/synchdb-devel</a>]</em> 進行開發。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>contrib/
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Hornetlabs/synchdb.git
</code></pre></div></td></tr></table></div>
<h4 id="zh-getting-started-installation-postgresql"><strong>编译和安装PostgreSQL</strong><a class="headerlink" href="#zh-getting-started-installation-postgresql" title="Permanent link">&para;</a></h4>
<p>您可以按照<a href="https://www.postgresql.org/docs/current/install-make.html">此處</a>中所述的標準建置和安裝流程完成此操作。</p>
<p><strong>警告</strong>：SynchDB 依賴 pgcrypto 來加密和解密敏感的存取資訊。請確保 PostgreSQL 已建置並啟用 SSL 支援。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/home/<span class="nv">$USER</span>/postgres
./configure<span class="w"> </span>--with-ssl<span class="o">=</span>openssl<span class="w"> </span>--enable-cassert
make
sudo<span class="w"> </span>make<span class="w"> </span>install
</code></pre></div></td></tr></table></div>
<p>建置所需的 pgcrypto 擴展</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/home/<span class="nv">$USER</span>/postgres/contrib/pgcrypto
make
sudo<span class="w"> </span>make<span class="w"> </span>install
</code></pre></div></td></tr></table></div>
<h4 id="zh-getting-started-installation-synchdb-openlog-replicator">建置 SynchDB 並新增 Openlog Replicator 連接器支持<a class="headerlink" href="#zh-getting-started-installation-synchdb-openlog-replicator" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># 建置並安裝 debezium runner</span>
<span class="nb">cd</span><span class="w"> </span>/home/<span class="nv">$USER</span>/postgres/contrib/synchdb
make<span class="w"> </span>build_dbz
sudo<span class="w"> </span>make<span class="w"> </span>install_dbz

<span class="c1"># 建置並安裝 Oracle 解析器</span>
make<span class="w"> </span>oracle_parser
sudo<span class="w"> </span>make<span class="w"> </span>install_oracle_parser

<span class="c1"># 建置並安裝 synchdb</span>
make<span class="w"> </span><span class="nv">WITH_OLR</span><span class="o">=</span><span class="m">1</span>
sudo<span class="w"> </span>make<span class="w"> </span><span class="nv">WITH_OLR</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>install
</code></pre></div></td></tr></table></div>
<h3 id="zh-getting-started-installation-linker-javaubuntu">配置 Linker 以访问 Java（Ubuntu）<a class="headerlink" href="#zh-getting-started-installation-linker-javaubuntu" title="Permanent link">&para;</a></h3>
<p>最后，我们还需要告诉系统的 Linker 新添加的 Java 库 (libjvm.so) 在系统中的位置。</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># 动态设置 JDK 路径</span>
<span class="nv">JAVA_PATH</span><span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>java<span class="k">)</span>
<span class="nv">JDK_HOME_PATH</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">JAVA_PATH</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s:/bin/java::&#39;</span><span class="k">)</span>
<span class="nv">JDK_LIB_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">JDK_HOME_PATH</span><span class="si">}</span>/lib

<span class="nb">echo</span><span class="w"> </span><span class="nv">$JDK_LIB_PATH</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$JDK_LIB_PATH</span>/server

sudo<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$JDK_LIB_PATH</span><span class="s2">&quot;</span><span class="w"> </span>｜<span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/ld.so.conf.d/x86_64-linux-gnu.conf
sudo<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$JDK_LIB_PATH</span><span class="s2">/server&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/ld.so.conf.d/x86_64-linux-gnu.conf
</code></pre></div>
注意，对于搭载 M1/M2 芯片的 Mac，链接器文件位于 /etc/ld.so.conf.d/aarch64-linux-gnu.conf</p>
<p>运行 ldconfig 重新加载：
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>ldconfig
</code></pre></div></p>
<p>确保 synchdo.so 扩展可以链接到系统上的 libjvm Java 库：
<div class="highlight"><pre><span></span><code>ldd<span class="w"> </span>synchdb.so
linux-vdso.so.1<span class="w"> </span><span class="o">(</span>0x00007ffeae35a000<span class="o">)</span>
libjvm.so<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/usr/lib/jdk-22.0.1/lib/server/libjvm.so<span class="w"> </span><span class="o">(</span>0x00007fc1276c1000<span class="o">)</span>
libc.so.6<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/libc.so.6<span class="w"> </span><span class="o">(</span>0x00007fc127498000<span class="o">)</span>
libdl.so.2<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/libdl.so.2<span class="w"> </span><span class="o">(</span>0x00007fc127493000<span class="o">)</span>
libpthread.so.0<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/libpthread.so.0<span class="w"> </span><span class="o">(</span>0x00007fc12748e000<span class="o">)</span>
librt.so.1<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/librt.so.1<span class="w"> </span><span class="o">(</span>0x00007fc127489000<span class="o">)</span>
libm.so.6<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/libm.so.6<span class="w"> </span><span class="o">(</span>0x00007fc1273a0000<span class="o">)</span>
/lib64/ld-linux-x86-64.so.2<span class="w"> </span><span class="o">(</span>0x00007fc128b81000<span class="o">)</span>
</code></pre></div></p>
<p>如果 SynchDB 构建时支持 openlog replicator，请确保它可以链接到你系统上的 libprotobuf-c 库：
<div class="highlight"><pre><span></span><code>ldd<span class="w"> </span>synchdb.so
linux-vdso.so.1<span class="w"> </span><span class="o">(</span>0x00007ffde6ba5000<span class="o">)</span>
libjvm.so<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/home/ubuntu/java/jdk-22.0.1/lib/server/libjvm.so<span class="w"> </span><span class="o">(</span>0x00007f3c8e191000<span class="o">)</span>
libprotobuf-c.so.1<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/usr/local/lib/libprotobuf-c.so.1<span class="w"> </span><span class="o">(</span>0x00007f3c8e186000<span class="o">)</span>
libc.so.6<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/libc.so.6<span class="w"> </span><span class="o">(</span>0x00007f3c8df5d000<span class="o">)</span>
libdl.so.2<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/libdl.so.2<span class="w"> </span><span class="o">(</span>0x00007f3c8df58000<span class="o">)</span>
libpthread.so.0<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/libpthread.so.0<span class="w"> </span><span class="o">(</span>0x00007f3c8df53000<span class="o">)</span>
librt.so.1<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/librt.so.1<span class="w"> </span><span class="o">(</span>0x00007f3c8df4c000<span class="o">)</span>
libm.so.6<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>/lib/x86_64-linux-gnu/libm.so.6<span class="w"> </span><span class="o">(</span>0x00007f3c8de65000<span class="o">)</span>
/lib64/ld-linux-x86-64.so.2<span class="w"> </span><span class="o">(</span>0x00007f3c8f69e000<span class="o">)</span>
</code></pre></div></p></section><section class="print-page" id="zh-getting-started-remote_database_setups" heading-number="3.2"><h1 id="zh-getting-started-remote_database_setups-_1">源数据库设置<a class="headerlink" href="#zh-getting-started-remote_database_setups-_1" title="Permanent link">&para;</a></h1>
<p>在 Synchdb 可以与外部异构数据库交互并启动复制之前，需要根据下列流程进行配置</p>
<h2 id="zh-getting-started-remote_database_setups-synchdb-mysql"><strong>为 SynchDB 设置 MySQL</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-synchdb-mysql" title="Permanent link">&para;</a></h2>
<h3 id="zh-getting-started-remote_database_setups-_2"><strong>创建用户</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-_2" title="Permanent link">&para;</a></h3>
<p>创建用户
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</code></pre></div></p>
<p>授予所需权限
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">RELOAD</span><span class="p">,</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">DATABASES</span><span class="p">,</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">SLAVE</span><span class="p">,</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">CLIENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</code></pre></div></p>
<p>确定用户的权限
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="zh-getting-started-remote_database_setups-binlog"><strong>启用 binlog</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-binlog" title="Permanent link">&para;</a></h3>
<p>检查 binlog 是否启用
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="n">x</span>
<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">variable_value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">&quot;BINARY LOGGING STATUS (log-bin) ::&quot;</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">global_variables</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;log_bin&#39;</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="n">x</span>
<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">variable_value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">&quot;BINARY LOGGING STATUS (log-bin) ::&quot;</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">global_variables</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;log_bin&#39;</span><span class="p">;</span>
</code></pre></div></p>
<p>如果 binlog 处于“OFF”状态，则将以下属性添加到配置文件中
<div class="highlight"><pre><span></span><code>server-id                   = 223344
log_bin                     = mysql-bin
binlog_format               = ROW
binlog_row_image            = FULL
binlog_expire_logs_seconds  = 864000
</code></pre></div></p>
<p>再次检查binlog状态
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="n">x</span>
<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">variable_value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">&quot;BINARY LOGGING STATUS (log-bin) ::&quot;</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">global_variables</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;log_bin&#39;</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="n">x</span>
<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">variable_value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">&quot;BINARY LOGGING STATUS (log-bin) ::&quot;</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">global_variables</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">variable_name</span><span class="o">=</span><span class="s1">&#39;log_bin&#39;</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="zh-getting-started-remote_database_setups-gtid"><strong>启用 GTID（可选）</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-gtid" title="Permanent link">&para;</a></h3>
<p>全局事务标识符 (GTID) 唯一地标识集群内服务器上发生的事务。虽然 SynchDB 连接器不强制需要，但使用 GTID 可以简化复制，并使您能够更轻松地确认主服务器和副本服务器是否一致。</p>
<p>启用 <code>gtid_mode</code>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">gtid_mode</span><span class="o">=</span><span class="k">ON</span>
</code></pre></div></p>
<p>启用 <code>enforce_gtid_consistency</code>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">enforce_gtid_consistency</span><span class="o">=</span><span class="k">ON</span>
</code></pre></div></p>
<p>确认更改
<div class="highlight"><pre><span></span><code>mysql&gt; show global variables like &#39;%GTID%&#39;;
+--------------------------+-------+
| Variable_name            | Value |
+--------------------------+-------+
| enforce_gtid_consistency | ON    |
| gtid_mode                | ON    |
+--------------------------+-------+
</code></pre></div></p>
<h3 id="zh-getting-started-remote_database_setups-_3"><strong>配置会话超时</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-_3" title="Permanent link">&para;</a></h3>
<p>当为大型数据库制处理 initial snapshot时，您建立的连接可能会在读取表时超时。您可以通过在 MySQL 配置文件中配置<code>interactive_timeout</code>和<code>wait_timeout</code>来防止此行为。</p>
<p>配置 <code>interactive_timeout:</code>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">interactive_timeout</span><span class="o">=&lt;</span><span class="n">duration</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seconds</span><span class="o">&gt;</span>
</code></pre></div></p>
<p>配置 <code>wait_timeout</code>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">wait_timeout</span><span class="o">=&lt;</span><span class="n">duration</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seconds</span><span class="o">&gt;</span>
</code></pre></div></p>
<h3 id="zh-getting-started-remote_database_setups-_4"><strong>启用查询日志事件</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-_4" title="Permanent link">&para;</a></h3>
<p>您可能希望查看每个二进制日志事件的原始 SQL 语句。在 MySQL 配置文件中启用<code>binlog_rows_query_log_events</code>选项允许您执行此操作。目前 SynchDB 不会以任何方式处理或解析原始 SQL 语句，即使它们包含在 binlog 内。这些仅供参考/调试</p>
<p>启用 <code>binlog_rows_query_log_events</code>
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">binlog_rows_query_log_events</span><span class="o">=</span><span class="k">ON</span>
</code></pre></div></p>
<h3 id="zh-getting-started-remote_database_setups-binlog_1"><strong>验证 Binlog 行值选项</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-binlog_1" title="Permanent link">&para;</a></h3>
<p>验证数据库中 <code>binlog_row_value_options</code> 变量的设置。要使连接器能够使用 UPDATE 事件，必须将此变量设置为除 <code>PARTIAL_JSON</code> 以外的值。</p>
<p>check current variable value
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">variable_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;binlog_row_value_options&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------------------------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">binlog_row_value_options</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------------+-------+</span>
</code></pre></div></p>
<p>如果变量的值为“PARTIAL_JSON”，请运行以下命令取消设置它
<div class="highlight"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="o">@@</span><span class="k">global</span><span class="p">.</span><span class="n">binlog_row_value_options</span><span class="o">=</span><span class="ss">&quot;&quot;</span><span class="w"> </span><span class="p">;</span>
</code></pre></div></p>
<h2 id="zh-getting-started-remote_database_setups-synchdb-sqlserver"><strong>为 SynchDB 设置 SQLServer</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-synchdb-sqlserver" title="Permanent link">&para;</a></h2>
<h3 id="zh-getting-started-remote_database_setups-sqlserver-cdc"><strong>在 SQLServer 数据库上启用 CDC</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-sqlserver-cdc" title="Permanent link">&para;</a></h3>
<p>在为表启用 CDC 之前，必须先为 SQL Server 数据库启用它。SQLServer 管理员通过运行系统存储过程来启用 CDC。可以使用 SQL Server Management Studio 或 Transact-SQL 来运行系统存储过程。</p>
<div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="n">MyDB</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_db</span>
<span class="k">GO</span>
</code></pre></div>
<h3 id="zh-getting-started-remote_database_setups-sqlserver-cdc_1"><strong>在 SQLServer 表上启用 CDC</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-sqlserver-cdc_1" title="Permanent link">&para;</a></h3>
<p>SQLServer 管理员必须在您希望 SynchDB 捕获的源表上启用变更数据捕获。数据库必须已启用 CDC。要在表上启用 CDC，SQLServer 管理员需要为表运行存储过程“sys.sp_cdc_enable_table”。必须为要捕获的每个表启用 SQL Server CDC。</p>
<p>为 SynchDB 启用 3 个表<code>customer</code>、<code>district</code> 和 <code>history</code> 以进行捕获：</p>
<div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="n">MyDB</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;customer&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">role_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;district&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">role_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;history&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">role_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div>
<h3 id="zh-getting-started-remote_database_setups-cdc"><strong>验证用户对 CDC 表的权限</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-cdc" title="Permanent link">&para;</a></h3>
<p>SQLServer 管理员可以运行系统存储过程来查询数据库或表以检索其 CDC 配置信息。</p>
<p>以下查询返回数据库中启用 CDC 的每个表的配置信息，其中包含调用者有权访问的更改数据。如果结果为空，请验证用户是否有权访问捕获实例和 CDC 表。</p>
<div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="n">MyDB</span><span class="p">;</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_help_change_data_capture</span>
<span class="k">GO</span>
</code></pre></div>
<h3 id="zh-getting-started-remote_database_setups-cdc_1"><strong>当启用 CDC 时表架构发生更改</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-cdc_1" title="Permanent link">&para;</a></h3>
<p>如果某个表已添加到 CDC 捕获列表并已被 SynchDB 捕获，则需要将 SQLServer 上此表发生的任何架构更改重新添加回 CDC 捕获列表，以向 SynchDB 生成正确的 DDL ALTER TABLE 事件。有关更多信息，请参阅 <a href="https://docs.synchdb.com/zh/architecture/ddl_replication/">DDL 复制</a> 页面。</p>
<h2 id="zh-getting-started-remote_database_setups-synchdb-oracle"><strong>为 SynchDB 设置 Oracle</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-synchdb-oracle" title="Permanent link">&para;</a></h2>
<p>以下示例基于容器数据库 <code>FREE</code> 和可插拔数据库 <code>FREEPDB1</code>:</p>
<h3 id="zh-getting-started-remote_database_setups-sys"><strong>为 Sys 用户设置密码</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-sys" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">sqlplus</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sysdba</span>
<span class="w">    </span><span class="k">Alter</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">sys</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">oracle</span><span class="p">;</span>
<span class="n">Exit</span>
</code></pre></div>
<h3 id="zh-getting-started-remote_database_setups-_5"><strong>配置日志挖掘器</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">sqlplus</span><span class="w"> </span><span class="o">/</span><span class="n">nolog</span>

<span class="w">    </span><span class="k">CONNECT</span><span class="w"> </span><span class="n">sys</span><span class="o">/</span><span class="n">oracle</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sysdba</span><span class="p">;</span>
<span class="w">    </span><span class="k">alter</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">db_recovery_file_dest_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="k">G</span><span class="p">;</span>
<span class="w">    </span><span class="k">alter</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">db_recovery_file_dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/opt/oracle/oradata/recovery_area&#39;</span><span class="w"> </span><span class="k">scope</span><span class="o">=</span><span class="n">spfile</span><span class="p">;</span>
<span class="w">    </span><span class="n">shutdown</span><span class="w"> </span><span class="k">immediate</span><span class="p">;</span>
<span class="w">    </span><span class="n">startup</span><span class="w"> </span><span class="n">mount</span><span class="p">;</span>
<span class="w">    </span><span class="k">alter</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">archivelog</span><span class="p">;</span>
<span class="w">    </span><span class="k">alter</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="k">open</span><span class="p">;</span>
<span class="w">    </span><span class="n">archive</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">list</span><span class="p">;</span>
<span class="n">exit</span>
</code></pre></div>
<h3 id="zh-getting-started-remote_database_setups-logminer"><strong>创建 logminer 用户</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-logminer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">sqlplus</span><span class="w"> </span><span class="n">sys</span><span class="o">/</span><span class="n">oracle</span><span class="o">@//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">1521</span><span class="o">/</span><span class="k">FREE</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sysdba</span>

<span class="w">    </span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">SUPPLEMENTAL</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="k">DATA</span><span class="p">;</span>
<span class="w">    </span><span class="k">ALTER</span><span class="w"> </span><span class="n">PROFILE</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="n">FAILED_LOGIN_ATTEMPTS</span><span class="w"> </span><span class="n">UNLIMITED</span><span class="p">;</span>
<span class="w">    </span><span class="n">exit</span><span class="p">;</span>

<span class="n">sqlplus</span><span class="w"> </span><span class="n">sys</span><span class="o">/</span><span class="n">oracle</span><span class="o">@//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">1521</span><span class="o">/</span><span class="k">FREE</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sysdba</span>

<span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="n">TABLESPACE</span><span class="w"> </span><span class="n">LOGMINER_TBS</span><span class="w"> </span><span class="n">DATAFILE</span><span class="w"> </span><span class="s1">&#39;/opt/oracle/oradata/FREE/logminer_tbs.dbf&#39;</span><span class="w"> </span><span class="k">SIZE</span><span class="w"> </span><span class="mi">25</span><span class="n">M</span><span class="w"> </span><span class="n">REUSE</span><span class="w"> </span><span class="n">AUTOEXTEND</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">MAXSIZE</span><span class="w"> </span><span class="n">UNLIMITED</span><span class="p">;</span>
<span class="w">    </span><span class="n">exit</span><span class="p">;</span>

<span class="n">sqlplus</span><span class="w"> </span><span class="n">sys</span><span class="o">/</span><span class="n">oracle</span><span class="o">@//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">1521</span><span class="o">/</span><span class="n">FREEPDB1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sysdba</span>

<span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="n">TABLESPACE</span><span class="w"> </span><span class="n">LOGMINER_TBS</span><span class="w"> </span><span class="n">DATAFILE</span><span class="w"> </span><span class="s1">&#39;/opt/oracle/oradata/FREE/FREEPDB1/logminer_tbs.dbf&#39;</span><span class="w"> </span><span class="k">SIZE</span><span class="w"> </span><span class="mi">25</span><span class="n">M</span><span class="w"> </span><span class="n">REUSE</span><span class="w"> </span><span class="n">AUTOEXTEND</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">MAXSIZE</span><span class="w"> </span><span class="n">UNLIMITED</span><span class="p">;</span>
<span class="w">    </span><span class="n">exit</span><span class="p">;</span>

<span class="n">sqlplus</span><span class="w"> </span><span class="n">sys</span><span class="o">/</span><span class="n">oracle</span><span class="o">@//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">1521</span><span class="o">/</span><span class="k">FREE</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sysdba</span>

<span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dbz</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">TABLESPACE</span><span class="w"> </span><span class="n">LOGMINER_TBS</span><span class="w"> </span><span class="n">QUOTA</span><span class="w"> </span><span class="n">UNLIMITED</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">LOGMINER_TBS</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>

<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">SESSION</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">CONTAINER</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$DATABASE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ANY</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ANY</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="n">SELECT_CATALOG_ROLE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="n">EXECUTE_CATALOG_ROLE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ANY</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="n">LOGMINING</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>

<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ANY</span><span class="w"> </span><span class="k">DICTIONARY</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>

<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">LOCK</span><span class="w"> </span><span class="k">ANY</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>

<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">DBMS_LOGMNR</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">DBMS_LOGMNR_D</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>

<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$LOG</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$LOG_HISTORY</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>

<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$LOGMNR_LOGS</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$LOGMNR_CONTENTS</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$LOGMNR_PARAMETERS</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$LOGFILE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$ARCHIVED_LOG</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$ARCHIVE_DEST_STATUS</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$TRANSACTION</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$MYSTAT</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">V_$STATNAME</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">c</span><span class="o">##</span><span class="n">dbzuser</span><span class="w"> </span><span class="n">CONTAINER</span><span class="o">=</span><span class="k">ALL</span><span class="p">;</span><span class="w"> </span>

<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">DBMS_WORKLOAD_REPOSITORY</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">C</span><span class="o">##</span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">DBA_HIST_SNAPSHOT</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">C</span><span class="o">##</span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="w">    </span><span class="k">GRANT</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">DBMS_WORKLOAD_REPOSITORY</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">PUBLIC</span><span class="p">;</span>


<span class="w">    </span><span class="n">Exit</span>
</code></pre></div>
<h3 id="zh-getting-started-remote_database_setups-_6"><strong>为指定捕获表启用补充日志数据</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-_6" title="Permanent link">&para;</a></h3>
<p>需要在每个被捕获的表运行此配置，以便正确处理 UPDATE 和 DELETE 操作。</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">SUPPLEMENTAL</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="p">(</span><span class="k">ALL</span><span class="p">)</span><span class="w"> </span><span class="n">COLUMNS</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">SUPPLEMENTAL</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="p">(</span><span class="k">ALL</span><span class="p">)</span><span class="w"> </span><span class="n">COLUMNS</span><span class="p">;</span>
<span class="p">...</span><span class="w"> </span><span class="n">etc</span>
</code></pre></div>
<h2 id="zh-getting-started-remote_database_setups-openlog-replicator-oracle"><strong>Openlog Replicator 支持的其他 Oracle 设置</strong><a class="headerlink" href="#zh-getting-started-remote_database_setups-openlog-replicator-oracle" title="Permanent link">&para;</a></h2>
<p>Openlog Replicator 需要额外权限才能流式传输 Oracle 更改：</p>
<div class="highlight"><pre><span></span><code><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">CCOL$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">CDEF$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">COL$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">DEFERRED_STG$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">ECOL$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">LOB$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">LOBCOMPPART$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">LOBFRAG$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">OBJ$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">TAB$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">TABCOMPART$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">TABPART$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">TABSUBPART$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">TS$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="k">USER</span><span class="err">$</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">XDB</span><span class="p">.</span><span class="n">XDB$TTSET</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="n">FLASHBACK</span><span class="w"> </span><span class="k">ANY</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">V_$ARCHIVED_LOG</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">V_$DATABASE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">V_$DATABASE_INCARNATION</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">V_$LOG</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">V_$LOGFILE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">V_$PARAMETER</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">V_$STANDBY_LOG</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SYS</span><span class="p">.</span><span class="n">V_$TRANSPORTABLE_PLATFORM</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">DBZUSER</span><span class="p">;</span>
<span class="k">DECLARE</span>
<span class="w">    </span><span class="k">CURSOR</span><span class="w"> </span><span class="n">C1</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">TOKSUF</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">XDB</span><span class="p">.</span><span class="n">XDB$TTSET</span><span class="p">;</span>
<span class="w">    </span><span class="n">CMD</span><span class="w"> </span><span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
<span class="k">BEGIN</span>
<span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="k">C</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">C1</span><span class="w"> </span><span class="n">LOOP</span>
<span class="w">        </span><span class="n">CMD</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;GRANT SELECT, FLASHBACK ON XDB.X$NM&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">C</span><span class="p">.</span><span class="n">TOKSUF</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; TO DBZUSER&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">IMMEDIATE</span><span class="w"> </span><span class="n">CMD</span><span class="p">;</span>
<span class="w">        </span><span class="n">CMD</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;GRANT SELECT, FLASHBACK ON XDB.X$QN&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">C</span><span class="p">.</span><span class="n">TOKSUF</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; TO DBZUSER&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">IMMEDIATE</span><span class="w"> </span><span class="n">CMD</span><span class="p">;</span>
<span class="w">        </span><span class="n">CMD</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;GRANT SELECT, FLASHBACK ON XDB.X$PT&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">C</span><span class="p">.</span><span class="n">TOKSUF</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; TO DBZUSER&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">IMMEDIATE</span><span class="w"> </span><span class="n">CMD</span><span class="p">;</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="n">LOOP</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
</code></pre></div></section><section class="print-page" id="zh-getting-started-configuration" heading-number="3.3"><h1 id="zh-getting-started-configuration-_1">配置说明<a class="headerlink" href="#zh-getting-started-configuration-_1" title="Permanent link">&para;</a></h1>
<p>SynchDB 在 postgresql.conf 中支持以下 GUC 变量。这些是适用于 SynchDB 管理的所有Debezium连接器的通用参数：</p>
<table>
<thead>
<tr>
<th>GUC 变量</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>synchdb.naptime</td>
<td>integer</td>
<td>100</td>
<td>从 Debezium runner 引擎轮询数据的时间间隔（毫秒）</td>
</tr>
<tr>
<td>synchdb.dml_use_spi</td>
<td>boolean</td>
<td>false</td>
<td>是否使用 SPI 处理 DML 操作</td>
</tr>
<tr>
<td>synchdb.synchdb_auto_launcher</td>
<td>boolean</td>
<td>true</td>
<td>是否自动启动活跃的 SynchDB 连接器工作进程。此选项仅在 SynchDB 被包含在 <code>shared_preload_library</code> GUC 选项中时生效</td>
</tr>
<tr>
<td>synchdb.dbz_batch_size</td>
<td>integer</td>
<td>2048</td>
<td>Debezium 嵌入式引擎生成的 SynchDB 可处理的最大变更事件数。此批次变更由 SynchDB 在单个事务中处理</td>
</tr>
<tr>
<td>synchdb.dbz_queue_size</td>
<td>integer</td>
<td>8192</td>
<td>Debezium 嵌入式引擎的变更事件队列的最大大小（以变更事件数衡量）。应将其设置为 <code>synchdb.dbz_batch_size</code> 的至少两倍</td>
</tr>
<tr>
<td>synchdb.dbz_connect_timeout_ms</td>
<td>integer</td>
<td>30000</td>
<td>Debezium 嵌入式引擎与远程数据库建立初始连接的超时值（以毫秒为单位）</td>
</tr>
<tr>
<td>synchdb.dbz_query_timeout_ms</td>
<td>integer</td>
<td>600000</td>
<td>Debezium 嵌入式引擎在远程数据库上执行查询的超时值（以毫秒为单位）</td>
</tr>
<tr>
<td>synchdb.dbz_skipped_oeprations</td>
<td>string</td>
<td>“t”</td>
<td>Debezium 在处理更改事件时应跳过的操作的逗号分隔列表。 “c” 表示插入，“u” 表示更新，“d” 表示删除，“t” 表示截断</td>
</tr>
<tr>
<td>synchdb.jvm_max_heap_size</td>
<td>integer</td>
<td>1024</td>
<td>启动连接器时分配给 Java 虚拟机 (JVM) 的最大heap内存大小（以 MB 为单位）。</td>
</tr>
<tr>
<td>synchdb.dbz_snapshot_thread_num</td>
<td>integer</td>
<td>2</td>
<td>Debezium 嵌入式连接器在初始快照期间应产生的线程数。请注意，根据 Debezium，多线程快照是一项“孵化功能”</td>
</tr>
<tr>
<td>synchdb.dbz_snapshot_fetch_size</td>
<td>integer</td>
<td>0</td>
<td>Debezium 嵌入式连接器在初始快照期间应一次获取的行数。将其设置为 0 以让引擎自动选择</td>
</tr>
<tr>
<td>synchdb.<br>dbz_snapshot_min_row_<br>to_stream_results</td>
<td>integer</td>
<td>0</td>
<td>在初始快照期间，Debezium 嵌入式引擎切换到流模式之前远程表应包含的最小行数。将其设置为 0 以始终切换到流模式</td>
</tr>
<tr>
<td>synchdb.<br>dbz_incremental_<br>snapshot_chunk_size</td>
<td>integer</td>
<td>2048</td>
<td>在增量快照期间，Debezium 嵌入式引擎为 SynchDB 生成的更改事件的最大数量</td>
</tr>
<tr>
<td>synchdb.<br>dbz_incremental_<br>snapshot_watermarking_strategy</td>
<td>字符串</td>
<td>“insert-insert</td>
<td>Debezium 嵌入式引擎用于解决增量快照期间潜在冲突的水印策略。可能的值是“insert-insert”和“insert-delete”</td>
</tr>
<tr>
<td>synchdb.dbz_offset_flush_interval_ms</td>
<td>integer</td>
<td>60000</td>
<td>Debezium 嵌入式引擎将偏移数据刷新到磁盘的间隔（以毫秒为单位）</td>
</tr>
<tr>
<td>synchdb.<br>dbz_capture_only_selected_table_ddl</td>
<td>boolean</td>
<td>true</td>
<td>Debezium 嵌入式引擎是否应在初始快照期间捕获所有表（false）或选定表（true）的模式</td>
</tr>
<tr>
<td>synchdb.max_connector_workers</td>
<td>integer</td>
<td>30</td>
<td>最大的连接器后台进程数量</td>
</tr>
<tr>
<td>synchdb.error_handling_strategy</td>
<td>enum</td>
<td>"exit"</td>
<td>配置连接器工作器的错误处理策略。可能的值有“exit”表示出错时退出，“skip”表示出错时继续，“retry”表示出错时重试</td>
</tr>
<tr>
<td>synchdb.dbz_log_level</td>
<td>enum</td>
<td>"warn"</td>
<td>Debezium Runner 的日志级别设置。可能的值有“debug”，“info”，“warn”，“error”，“all”，“fatal”，“off”，“trace”</td>
</tr>
<tr>
<td>synchdb.log_change_on_error</td>
<td>boolean</td>
<td>true</td>
<td>连接器是否应在发生错误时记录原始 JSON 更改事件</td>
</tr>
<tr>
<td>synchdb.jvm_max_direct_buffer_size</td>
<td>integer</td>
<td>1024</td>
<td>分配用于保存 JSON 更改事件的最大直接缓冲区大小（以 MB 为单位）</td>
</tr>
<tr>
<td>synchdb.dbz_logminer_stream_mode</td>
<td>enum</td>
<td>"uncommitted"</td>
<td>基於 Debezium 的 Oracle 連接器的流模式。預設值為uncommitted，這表示透過 Debezium 從 Oracle 串流傳輸的所有變更均未提交。這表明 Debezium 必須執行一些工作來確保事務和所有相關變更的完整性。設定為 "committed" 會將這項工作轉移到 Oralce 端</td>
</tr>
<tr>
<td>synchdb.olr_connect_timeout_ms</td>
<td>integer</td>
<td>5000</td>
<td>（僅影響 OLR 連接器）連接到 OpenLog 複製器服務時的連線逾時時間（以毫秒為單位）</td>
</tr>
<tr>
<td>synchdb.olr_read_timeout_m</td>
<td>integer</td>
<td>5000</td>
<td>（僅影響 OLR 連接器）從套接字讀取時的讀取逾時時間（以毫秒為單位）</td>
</tr>
<tr>
<td>synchdb.olr_snapshot_engine</td>
<td>enum</td>
<td>"debezium"</td>
<td>（僅影響 OLR 連接器）指定底層引擎完成初始快照程序。可以是“debezium”或“fdw”。如果選擇“fdw”，則需要確保在</td>
</tr>
<tr>
<td>synchdb.cdc_start_delay_ms</td>
<td>integer</td>
<td>0</td>
<td>初始快照完成後、CDC 流開始前等待的延遲時間。</td>
</tr>
</tbody>
</table>
<h2 id="zh-getting-started-configuration-_2"><strong>技术说明</strong><a class="headerlink" href="#zh-getting-started-configuration-_2" title="Permanent link">&para;</a></h2>
<ul>
<li>GUC（Grand Unified Configuration）是 PostgreSQL 中的全局配置参数</li>
<li>这些值需要在 <code>postgresql.conf</code> 文件中设置</li>
<li>修改配置后需要重启服务器才能生效</li>
<li><code>shared_preload_library</code> 是一个关键的系统配置，它决定了启动时加载哪些库，synchdb 必须放在这里才能启用 <a href="https://docs.synchdb.com/zh/user-guide/connector_auto_launcher/">连接器自动启动器</a></li>
</ul>
<h2 id="zh-getting-started-configuration-_3"><strong>配置示例</strong><a class="headerlink" href="#zh-getting-started-configuration-_3" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code># postgresql.conf 配置示例
synchdb.naptime = 1000                                                  # 将等待时间增加到1秒
synchdb.dml_use_spi = true                                              # 启用 SPI 处理 DML 操作
synchdb.synchdb_auto_launcher = true                                    # 启用自动连接器启动synchdb.dbz_batch_size=4096 # 每个批次最多可以有 4096 个更改事件
synchdb.dbz_queue_size=8192                                             # Debezium 将使用 8192 个更改事件队列大小
synchdb.jvm_max_heap_size=2048                                          # 分配给连接器的 2GB 堆内存
synchdb.dbz_snapshot_fetch_size=0                                       # 让 Debezium 确定在初始快照期间要获取的最佳行数
synchdb.dbz_min_row_to_stream_results=0                                 # 始终在初始快照期间流式传输结果
synchdb.dbz_snapshot_thread_num=1                                       # Debezium 初始快照期间的单个线程
synchdb.dbz_incremental_snapshot_chunk_size=4096                        # 增量快照以 4096 个批次生成更改事件max
synchdb.dbz_incremental_snapshot_watermarking_strategy=&#39;insert_insert&#39;  # 使用 insert_insert 水印策略
synchdb.dbz_offset_flush_interval_ms=60000                              # 如果需要，每分钟将偏移数据刷新到磁盘
synchdb.dbz_capture_only_selected_table_ddl=false                       # Debezium 将仅捕获选定表的模式，而不是所有表
synchdb.max_connector_workers=false                                     # 最多允许 10 个连接器
synchdb.error_handling_strategy=&#39;retry&#39;                                 # 连接器应在发生错误时重试
synchdb.dbz_log_leve=&#39;error&#39;                                            # Debezium Runner 应仅记录错误消息
synchdb.log_change_on_error=true                                        # 发生错误时记录 JSON 更改事件
</code></pre></div>
<h2 id="zh-getting-started-configuration-_4"><strong>使用建议</strong><a class="headerlink" href="#zh-getting-started-configuration-_4" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>synchdb.naptime</strong></p>
<ul>
<li>较低的值：更新频率更高，但系统负载更大</li>
<li>较高的值：系统负载较低，但更新频率降低</li>
<li>根据数据延迟要求进行调整</li>
</ul>
</li>
<li>
<p><strong>synchdb.dml_use_spi</strong></p>
<ul>
<li>需要特定 SPI 集成时启用</li>
<li>标准 DML 操作保持 <code>false</code></li>
</ul>
</li>
<li>
<p><strong>synchdb.synchdb_auto_launcher</strong></p>
<ul>
<li>建议保持 <code>true</code> 以实现connecot自动启用管理</li>
<li>仅在需要手动控制连接器时改为 <code>false</code></li>
</ul>
</li>
<li>
<p><strong>synchdb.dbz_batch_size</strong></p>
<ul>
<li>值越低：JVM 内存使用量越低，处理变更事件的速度越慢</li>
<li>值越高：JVM 内存使用量越高，处理变更事件的速度越快</li>
<li>根据资源需求进行调整</li>
</ul>
</li>
<li>
<p><strong>synchdb.dbz_queue_size</strong></p>
<ul>
<li>值越低：用于保存变更事件的 Debezium 队列越小</li>
<li>值越高：用于保存变更事件的 Debezium 队列越大</li>
<li>需要设置为 <code>synchdb.dbz_batch_size</code> 的至少两倍</li>
</ul>
</li>
<li>
<p><strong>synchdb.jvm_max_heap_size</strong></p>
<ul>
<li>值越低：分配给 JVM 的堆内存越小</li>
<li>值越高：分配给 JVM 的堆内存越大</li>
<li>根据系统资源和工作负载需求进行调整</li>
<li>处理大量表时需求会增加</li>
</ul>
</li>
<li>
<p><strong>synchdb.dbz_snapshot_fetch_size</strong></p>
<ul>
<li>值越低：快照期间从表中获取的行越少</li>
<li>值越高：获取的行越多快照期间要从表中获取的行数</li>
<li>建议将其保留为 0，以便让 Debezium 找出最佳值</li>
</ul>
</li>
<li>
<p><strong>synchdb.dbz_min_row_to_stream_results</strong></p>
<ul>
<li>较低的值：JVM 内存需求较少，更改事件处理较慢</li>
<li>较高的值：JVM 内存需求较多，更改事件处理较快</li>
<li>建议将其保留为 0，以便让 Debezium 始终使用流模式以减少内存使用量</li>
</ul>
</li>
<li>
<p><strong>synchdb.dbz_snapshot_thread_num</strong></p>
<ul>
<li>较低的值：将数据导出到 SynchDB 进行处理的速度较慢</li>
<li>较高的值：将数据导出到 SyncDB 进行处理的速度较快</li>
<li>建议将其设置为相同的 CPU 核心数</li>
</ul>
</li>
<li>
<p><strong>synchdb.dbz_incremental_snapshot_chunk_size</strong></p>
<ul>
<li>较低的值：增量快照期间，在较低的 JVM 内存使用量下，更改事件处理较慢</li>
<li>较高的值：增量快照期间，在较高的 JVM 内存使用量下，更改事件处理较快</li>
<li>建议将其设置为与 <code>synchdb.dbz_batch_size</code> 相同，并根据资源需求进行调整</li>
</ul>
</li>
<li>
<p><strong>synchdb.dbz_offset_flush_interval_ms</strong></p>
<ul>
<li>较低的值：更频繁地更新偏移文件，更多的 IO，故障恢复后重新处理的旧批次较少</li>
<li>较高的值：更不频繁地更新偏移文件，更少的 IO，故障恢复后重新处理的旧批次较多</li>
<li>建议将其设置为 60000，这是 Debezium 的建议</li>
</ul>
</li>
<li>
<p><strong>synchdb.max_connector_workers</strong></p>
<ul>
<li>较低的值：一次可以运行的连接器工作器越少，共享内存需求越少</li>
<li>较高的值：一次可以运行的连接器工作器越多，共享内存需求越多</li>
</ul>
</li>
</ol>
<h2 id="zh-getting-started-configuration-_5"><strong>性能考虑</strong><a class="headerlink" href="#zh-getting-started-configuration-_5" title="Permanent link">&para;</a></h2>
<ul>
<li>根据系统负载和延迟要求调整 <code>synchdb.naptime</code></li>
<li>调高 <code>synchdb.dbz_batch_size</code> 和 <code>synchdb.dbz_queue_size</code> 以增加处理吞吐量</li>
<li>根据工作负载调整 <code>synchdb.jvm_max_heap_size</code></li>
<li>表数量较少（10k 或更少）+ 每个表的数据量适中或较大：512MB ~ 1024MB 就足够了</li>
<li>表数量较多（100k 或更多）+ 每个表的数据量适中：考虑增加到 2048MB 或以上</li>
<li>将 <code>synchdb.dbz_snapshot_fetch_size</code> 设置为 0，让 Debezium 选择最佳提取值</li>
<li>将 <code>synchdb.dbz_snapshot_thread_num</code> 设置为与 CPU 核心数匹配</li>
<li>将 <code>synchdb.dbz_min_row_to_stream_results</code> 设置为 0，以始终使用流模式来减少内存使用量</li>
</ul>
<h2 id="zh-getting-started-configuration-_6"><strong>常见使用场景</strong><a class="headerlink" href="#zh-getting-started-configuration-_6" title="Permanent link">&para;</a></h2>
<h3 id="zh-getting-started-configuration-_7"><strong>高吞吐量系统</strong><a class="headerlink" href="#zh-getting-started-configuration-_7" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>synchdb.naptime = 10            # 更快的轮询以实现实时更新
synchdb.dml_use_spi = false     # 标准 DML 以获得更好的性能
synchdb.dbz_batch_size = 16384
synchdb.dbz_queue_size = 32768
synchdb.jvm_max_heap_size = 2048
synchdb.dbz_snapshot_thread_num = 4
synchdb.dbz_snapshot_fetch_size = 0
synchdb.dbz_min_row_to_stream_results = 0
</code></pre></div>
<h3 id="zh-getting-started-configuration-_8"><strong>资源受限系统</strong><a class="headerlink" href="#zh-getting-started-configuration-_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>synchdb.naptime = 1000          # 降低轮询频率
synchdb.dml_use_spi = false     # 最小化额外开销
synchdb.dbz_batch_size = 1024
synchdb.dbz_queue_size = 2048
synchdb.jvm_max_heap_size = 512
synchdb.dbz_snapshot_thread_num = 1
synchdb.dbz_snapshot_fetch_size = 0
synchdb.dbz_min_row_to_stream_results = 0
</code></pre></div>
<h3 id="zh-getting-started-configuration-_9"><strong>开发/测试环境</strong><a class="headerlink" href="#zh-getting-started-configuration-_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>synchdb.naptime = 500           # 默认轮询间隔
synchdb.dml_use_spi = true      # 启用高级功能进行测试
synchdb.dbz_batch_size = 2048
synchdb.dbz_queue_size = 4096
synchdb.jvm_max_heap_size = 1024
synchdb.dbz_snapshot_thread_num = 2
synchdb.dbz_snapshot_fetch_size = 0
synchdb.dbz_min_row_to_stream_results = 0
</code></pre></div>
<h2 id="zh-getting-started-configuration-_10"><strong>故障排除</strong><a class="headerlink" href="#zh-getting-started-configuration-_10" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>CPU 使用率高</strong></p>
<ul>
<li>增加 <code>synchdb.naptime</code> 值</li>
<li>检查 DML 操作模式</li>
<li>减少 <code>synchdb.dbz_batch_size</code> 和 <code>synchdb.dbz_queue_size</code></li>
<li>增加 <code>synchdb.dbz_snapshot_thread_num</code></li>
</ul>
</li>
<li>
<p><strong>数据延迟问题</strong></p>
<ul>
<li>减少 <code>synchdb.naptime</code> 值</li>
<li>增加 <code>synchdb.dbz_batch_size</code> 和 <code>synchdb.dbz_queue_size</code></li>
<li>检查网络连接</li>
<li>增加 <code>shared_buffers</code></li>
<li>将工作负载拆分到多个连接器，而不仅仅是一个</li>
<li>使用 <code>no_data</code> 模式启动连接器以仅获取模式并开始 CDC，而不是 <code>initial</code> 模式（在 CDC 开始之前捕获模式和初始数据）。</li>
</ul>
</li>
<li>
<p><strong>启动问题</strong></p>
<ul>
<li>验证 <code>shared_preload_library</code> 配置</li>
<li>检查 <code>synchdb_get_state()</code> 的错误消息</li>
<li>检查连接器工作状态</li>
</ul>
</li>
<li>
<p><strong>内存不足问题</strong></p>
<ul>
<li>增加 <code>synchdb.jvm_max_heap_size</code></li>
<li>增加 <code>shared_buffers</code></li>
</ul>
</li>
</ol>
<h2 id="zh-getting-started-configuration-_11"><strong>最佳实践</strong><a class="headerlink" href="#zh-getting-started-configuration-_11" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>初始设置</strong></p>
<ul>
<li>从默认值开始</li>
<li>监控系统性能</li>
<li>根据需求逐步调整</li>
</ul>
</li>
<li>
<p><strong>生产环境</strong></p>
<ul>
<li>记录所有配置更改</li>
<li>在测试环境中先测试更改</li>
<li>保持正常工作配置的备份</li>
</ul>
</li>
<li>
<p><strong>监控</strong></p>
<ul>
<li>跟踪系统资源使用情况</li>
<li>监控数据同步延迟</li>
<li>记录配置更改</li>
</ul>
</li>
</ol>
<h2 id="zh-getting-started-configuration-_12"><strong>补充说明</strong><a class="headerlink" href="#zh-getting-started-configuration-_12" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>性能优化</strong></p>
<ul>
<li>在高负载情况下适当增加 <code>naptime</code></li>
<li>需要实时性时可以降低 <code>naptime</code>，但要注意系统负载</li>
<li>建议根据实际业务场景进行压力测试</li>
</ul>
</li>
<li>
<p><strong>安全考虑</strong></p>
<ul>
<li>定期检查配置文件权限</li>
<li>记录配置更改日志</li>
<li>保持配置文件的备份</li>
</ul>
</li>
<li>
<p><strong>维护建议</strong></p>
<ul>
<li>定期检查系统日志</li>
<li>监控连接器状态</li>
<li>制定配置变更流程</li>
</ul>
</li>
</ol></section><section class="print-page" id="zh-getting-started-quick_start" heading-number="3.4"><h1 id="zh-getting-started-quick_start-_1">快速入门指南<a class="headerlink" href="#zh-getting-started-quick_start-_1" title="Permanent link">&para;</a></h1>
<p>尝试 SynchDB 的最快方法是使用 SynchDB 及其配套源（MySQL、SQL Server、Oracle 等）的预构建 Docker 镜像。使用仓库的 <code>ezdeploy.sh</code>（仅限 Linux）命令，它会通过简单的交互式提示引导您启动所选源以及可选的 Prometheus/Grafana，以便您在几分钟内验证捕获和复制操作。</p>
<h2 id="zh-getting-started-quick_start-ezdeploysh"><strong>ezdeploy.sh</strong><a class="headerlink" href="#zh-getting-started-quick_start-ezdeploysh" title="Permanent link">&para;</a></h2>
<p>此工具可从 SynchDB 源码仓库 <a href="https://github.com/Hornetlabs/synchdb">此处</a> 下载。它需要 <code>docker</code> 和 <code>docker-compose</code>（或 <code>docker compose</code>），并且必须在 Linux 上运行。运行时会打印部署选项列表：</p>
<div class="highlight"><pre><span></span><code>./ezdeploy.sh
----------------------------------
-----&gt;<span class="w"> </span>Welcome<span class="w"> </span>to<span class="w"> </span>ezdeploy!<span class="w"> </span>&lt;-----
----------------------------------

please<span class="w"> </span><span class="k">select</span><span class="w"> </span>a<span class="w"> </span>quick<span class="w"> </span>deploy<span class="w"> </span>option:
<span class="w">         </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>synchdb<span class="w"> </span>only
<span class="w">         </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>synchdb<span class="w"> </span>+<span class="w"> </span>mysql
<span class="w">         </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>synchdb<span class="w"> </span>+<span class="w"> </span>sqlserver
<span class="w">         </span><span class="m">4</span><span class="o">)</span><span class="w"> </span>synchdb<span class="w"> </span>+<span class="w"> </span>oracle23ai
<span class="w">         </span><span class="m">5</span><span class="o">)</span><span class="w"> </span>synchdb<span class="w"> </span>+<span class="w"> </span>oracle19c
<span class="w">         </span><span class="m">6</span><span class="o">)</span><span class="w"> </span>synchdb<span class="w"> </span>+<span class="w"> </span>olr<span class="o">(</span>oracle19c<span class="o">)</span>
<span class="w">         </span><span class="m">7</span><span class="o">)</span><span class="w"> </span>synchdb<span class="w"> </span>+<span class="w"> </span>all<span class="w"> </span><span class="nb">source</span><span class="w"> </span>databases
<span class="w">         </span><span class="m">8</span><span class="o">)</span><span class="w"> </span>custom<span class="w"> </span>deployment
<span class="w">         </span><span class="m">9</span><span class="o">)</span><span class="w"> </span>deploy<span class="w"> </span>monitoring
<span class="w">        </span><span class="m">10</span><span class="o">)</span><span class="w"> </span>teardown<span class="w"> </span>deployment
enter<span class="w"> </span>your<span class="w"> </span>selection:
</code></pre></div>
<ul>
<li>仅对于 synchdb 部署，请使用选项 <code>1)</code>。</li>
<li>对于 synchdb + 1 个源数据库，请使用选项 <code>2)</code> 至 <code>6)</code>。</li>
<li>对于 synchdb + 所有源数据库，请使用选项 <code>7)</code>。</li>
<li>对于 synchdb + 自定义源数据库，请使用选项 <code>8)</code>。</li>
<li>对于 prometheus 和 grafana 监控部署，请使用选项 <code>9)</code>。</li>
<li>要拆除所有部署，请使用选项 <code>10)</code>。</li>
</ul>
<h2 id="zh-getting-started-quick_start-_2"><strong>测试源数据库访问详情</strong><a class="headerlink" href="#zh-getting-started-quick_start-_2" title="Permanent link">&para;</a></h2>
<p><strong>MySQL:</strong></p>
<ul>
<li>数据库：inventory</li>
<li>模式：N/A</li>
<li>用户：mysqluser</li>
<li>密码：mysqlpwd</li>
</ul>
<p><strong>Sqlserver:</strong></p>
<ul>
<li>数据库：testDB</li>
<li>模式：dbo</li>
<li>用户：sa</li>
<li>密码：Password!</li>
</ul>
<p><strong>Oracle23ai:</strong></p>
<ul>
<li>数据库：FREE</li>
<li>模式：c##dbzuser</li>
<li>用户：c##dbzuser</li>
<li>密码：dbz</li>
</ul>
<p><strong>Oracle19c:</strong></p>
<ul>
<li>数据库：FREE</li>
<li>模式：DBZUSER</li>
<li>用户：DBZUSER</li>
<li>密码：dbz</li>
</ul>
<p><strong>Openlog Replicator (OLR)：</strong></p>
<ul>
<li>服务名称：ORACLE</li>
</ul>
<h2 id="zh-getting-started-quick_start-psql-synchdb"><strong>使用 psql 访问 Synchdb</strong><a class="headerlink" href="#zh-getting-started-quick_start-psql-synchdb" title="Permanent link">&para;</a></h2>
<p>部署完成后，可以通过以下方式访问 synchdb：</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>synchdb<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;p​​sql -d postgres&quot;</span>
</code></pre></div>
<p>连接后，创建 <code>synchdb</code> 扩展：</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="n">synchdb</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">;</span>
</code></pre></div>
<h2 id="zh-getting-started-quick_start-_3"><strong>创建连接器</strong><a class="headerlink" href="#zh-getting-started-quick_start-_3" title="Permanent link">&para;</a></h2>
<p>以下是为每种受支持的源数据库类型创建基本连接器的一些示例。</p>
<p><strong>MySQL:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">3306</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;mysqluser&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;mysqlpwd&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Sqlserver:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;sqlserver&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                            </span><span class="mi">1433</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;sa&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;Password!&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;testDB&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;sqlserver&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Oracle23ai:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;oracle&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">1521</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;c##dbzuser&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;dbz&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;FREE&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;oracle&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Oracle19c:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span><span class="s1">&#39;ora19cconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;ora19c&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">1521</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;DBZUSER&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;dbz&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;FREE&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;oracle&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>OLR(Oracle19c):</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;ora19c&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">1521</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;DBZUSER&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;dbz&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;FREE&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;olr&#39;</span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_olr_conninfo</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span>
<span class="w">                                </span><span class="s1">&#39;OpenLogReplicator&#39;</span><span class="p">,</span>
<span class="w">                                </span><span class="mi">7070</span><span class="p">,</span>
<span class="w">                                </span><span class="s1">&#39;ORACLE&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>查看已创建的连接器：</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">synchdb_conninfo</span><span class="p">;</span>
</code></pre></div>
<p>有关创建连接器的更多详细信息，请参阅<a href="https://docs.synchdb.com/zh/user-guide/create_a_connector/">此处</a></p>
<h2 id="zh-getting-started-quick_start-_4"><strong>创建对象映射</strong><a class="headerlink" href="#zh-getting-started-quick_start-_4" title="Permanent link">&para;</a></h2>
<p>默认情况下，源数据库名称将映射到目标数据库中的架构名称。可以使用对象映射来更改此架构名称。让我们从基于 Oracle 的连接器中更改“orders”表的目标架构，其余部分保留默认值。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="s1">&#39;table&#39;</span><span class="p">,</span><span class="s1">&#39;free.c##dbzuser.orders&#39;</span><span class="p">,</span><span class="s1">&#39;oracle23ai.orders&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;ora19cconn&#39;</span><span class="p">,</span><span class="s1">&#39;table&#39;</span><span class="p">,</span><span class="s1">&#39;free.dbzuser.orders&#39;</span><span class="p">,</span><span class="s1">&#39;oracle19c.orders&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span><span class="s1">&#39;table&#39;</span><span class="p">,</span><span class="s1">&#39;free.dbzuser.orders&#39;</span><span class="p">,</span><span class="s1">&#39;olr.orders&#39;</span><span class="p">);</span>
</code></pre></div>
<p>有关创建对象映射的更多详细信息，请参见[此处]（<a href="https://docs.synchdb.com/zh/user-guide/object_mapping_rules/">https://docs.synchdb.com/zh/user-guide/object_mapping_rules/</a>）</p>
<h2 id="zh-getting-started-quick_start-jmx-"><strong>创建 JMX 导出器 - 可选</strong><a class="headerlink" href="#zh-getting-started-quick_start-jmx-" title="Permanent link">&para;</a></h2>
<p>以下是一些启用 JMX 导出器进行监控的示例（如果已通过 <code>ezdeploy.sh</code> 预先部署了 Prometheus + Grafana）：</p>
<p><strong>MySQL:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_exporter_conninfo</span><span class="p">(</span>
<span class="w">                            </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;/home/ubuntu/jmx_prometheus_javaagent-1.3.0.jar&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">9404</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;/home/ubuntu/jmxexport.conf&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Sqlserver:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_exporter_conninfo</span><span class="p">(</span>
<span class="w">                            </span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;/home/ubuntu/jmx_prometheus_javaagent-1.3.0.jar&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">9405</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;/home/ubuntu/jmxexport.conf&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Oracle23ai:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_exporter_conninfo</span><span class="p">(</span>
<span class="w">                            </span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;/home/ubuntu/jmx_prometheus_javaagent-1.3.0.jar&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">9406</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;/home/ubuntu/jmxexport.conf&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Oracle19c:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_exporter_conninfo</span><span class="p">(</span>
<span class="w">                            </span><span class="s1">&#39;ora19cconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;/home/ubuntu/jmx_prometheus_javaagent-1.3.0.jar&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">9407</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;/home/ubuntu/jmxexport.conf&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>关于创建 JMX Exporter 的更多详细信息，请参见<a href="https://docs.synchdb.com/zh/monitoring/jmx_exporter/">此处</a></p>
<h2 id="zh-getting-started-quick_start-_5"><strong>启动连接器</strong><a class="headerlink" href="#zh-getting-started-quick_start-_5" title="Permanent link">&para;</a></h2>
<p><strong>MySQL:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Sqlserver:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Oracle23ai:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Oracle19c:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;ora19cconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>OLR(Oracle19c):</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>有关连接器启动的更多详细信息，请参见[此处]（<a href="https://docs.synchdb.com/zh/user-guide/start_stop_connector/">https://docs.synchdb.com/zh/user-guide/start_stop_connector/</a>）</p>
<h2 id="zh-getting-started-quick_start-_6"><strong>检查连接器运行状态</strong><a class="headerlink" href="#zh-getting-started-quick_start-_6" title="Permanent link">&para;</a></h2>
<p>使用“synchdb_state_view()”检查所有连接器的运行状态。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>
</code></pre></div>
<p>以下是输出示例：
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>
<span class="w">     </span><span class="n">name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">       </span><span class="n">stage</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span><span class="w">                                           </span><span class="n">last_dbz_offset</span>
<span class="c1">---------------+----------------+--------+------------------+---------+----------+------------------------------------------------------------------------------------------------------</span>
<span class="w"> </span><span class="n">sqlserverconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sqlserver</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">579820</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;commit_lsn&quot;</span><span class="p">:</span><span class="ss">&quot;0000006a:00006608:0003&quot;</span><span class="p">,</span><span class="ss">&quot;snapshot&quot;</span><span class="p">:</span><span class="k">true</span><span class="p">,</span><span class="ss">&quot;snapshot_completed&quot;</span><span class="p">:</span><span class="k">false</span><span class="err">}</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">579845</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;ts_sec&quot;</span><span class="p">:</span><span class="mi">1741301103</span><span class="p">,</span><span class="ss">&quot;file&quot;</span><span class="p">:</span><span class="ss">&quot;mysql-bin.000009&quot;</span><span class="p">,</span><span class="ss">&quot;pos&quot;</span><span class="p">:</span><span class="mi">574318212</span><span class="p">,</span><span class="ss">&quot;row&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="ss">&quot;server_id&quot;</span><span class="p">:</span><span class="mi">223344</span><span class="p">,</span><span class="ss">&quot;event&quot;</span><span class="p">:</span><span class="mi">2</span><span class="err">}</span>
<span class="w"> </span><span class="n">oracleconn</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">oracle</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">580053</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">flushed</span><span class="w"> </span><span class="n">yet</span>
<span class="w"> </span><span class="n">ora19cconn</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">oracle</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">593421</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">flushed</span><span class="w"> </span><span class="n">yet</span>
<span class="w"> </span><span class="n">olrconn</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">oracle</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">601235</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">flushed</span><span class="w"> </span><span class="n">yet</span>
<span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div></p>
<p>有关运行状态的更多信息，请参见<a href="https://docs.synchdb.com/zh/monitoring/state_view/">此处</a>，以及运行统计信息，请参见<a href="https://docs.synchdb.com/zh/monitoring/stats_view/">此处</a>。</p>
<h2 id="zh-getting-started-quick_start-_7">检查初始快照中的表和数据<a class="headerlink" href="#zh-getting-started-quick_start-_7" title="Permanent link">&para;</a></h2>
<p>默认情况下，连接器将执行“初始”快照，以捕获表模式和初始数据，然后转换并将它们应用到不同“模式”下的 PostgreSQL。您应该看到类似以下内容：</p>
<p><strong>MySQL:</strong>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="o">*</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="o">*</span>
<span class="w">               </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w">  </span><span class="k">Schema</span><span class="w">   </span><span class="o">|</span><span class="w">       </span><span class="n">Name</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">-----------+------------------+-------+--------</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<p><strong>Sqlserver:</strong>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">testdb</span><span class="p">.</span><span class="o">*</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">testdb</span><span class="p">.</span><span class="o">*</span>
<span class="w">             </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w"> </span><span class="k">Schema</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="n">Name</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">--------+------------------+-------+--------</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<p><strong>Oracle23ai</strong>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">oracle23ai</span><span class="p">.</span><span class="o">*</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">oracle23ai</span><span class="p">.</span><span class="o">*</span>
<span class="w">          </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w">   </span><span class="k">Schema</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="n">Name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">------------+--------+-------+--------</span>
<span class="w"> </span><span class="n">oracle23ai</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div>
<p><strong>Oracle19c</strong>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">oracle19c</span><span class="p">.</span><span class="o">*</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">oracle19c</span><span class="p">.</span><span class="o">*</span>
<span class="w">          </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w">  </span><span class="k">Schema</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="n">Name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">-----------+--------+-------+--------</span>
<span class="w"> </span><span class="n">oracle19c</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div>
<p><strong>OLR</strong>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">olr</span><span class="p">.</span><span class="o">*</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="n">dt</span><span class="w"> </span><span class="n">olr</span><span class="p">.</span><span class="o">*</span>
<span class="w">        </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w"> </span><span class="k">Schema</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">Name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">--------+--------+-------+--------</span>
<span class="w"> </span><span class="n">olr</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div>
<h2 id="zh-getting-started-quick_start-insert-cdc">模拟 INSERT 事件并观察变更数据捕获 (CDC)<a class="headerlink" href="#zh-getting-started-quick_start-insert-cdc" title="Permanent link">&para;</a></h2>
<p>我们可以使用 <code>docker exec</code> 为每种连接器类型模拟一次 INSERT 操作，并观察变更数据捕获 (CDC)。</p>
<p><strong>MySQL:</strong>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>mysql<span class="w"> </span>mysql<span class="w"> </span>-D<span class="w"> </span>inventory<span class="w"> </span>-umysqluser<span class="w"> </span>-pmysqlpwd<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;INSERT INTO orders(order_date, purchaser, quantity, product_id) VALUES (&#39;2025-12-12&#39;, 1002, 10000, 102)&quot;</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">orders</span><span class="p">;</span>
<span class="w"> </span><span class="n">order_number</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">purchaser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span>
<span class="c1">--------------+------------+-----------+----------+------------</span>
<span class="w">        </span><span class="mi">10001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">16</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1001</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">102</span>
<span class="w">        </span><span class="mi">10002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">105</span>
<span class="w">        </span><span class="mi">10003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">19</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">106</span>
<span class="w">        </span><span class="mi">10004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10000</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">102</span>
<span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<p><strong>Sqlserver:</strong>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>sqlserver<span class="w"> </span>/opt/mssql-tools18/bin/sqlcmd<span class="w"> </span>-U<span class="w"> </span>sa<span class="w"> </span>-P<span class="w"> </span><span class="s1">&#39;Password!&#39;</span><span class="w"> </span>-d<span class="w"> </span>testDB<span class="w"> </span>-C<span class="w"> </span>-Q<span class="w"> </span><span class="s2">&quot;INSERT INTO orders(order_date, purchaser, quantity, product_id) VALUES (&#39;2025-12-12&#39;, 1002, 10000, 102)&quot;</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">testdb</span><span class="p">.</span><span class="n">orders</span><span class="p">;</span>
<span class="w"> </span><span class="n">order_number</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">purchaser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span>
<span class="c1">--------------+------------+-----------+----------+------------</span>
<span class="w">        </span><span class="mi">10001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">16</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1001</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">102</span>
<span class="w">        </span><span class="mi">10002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">105</span>
<span class="w">        </span><span class="mi">10003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">19</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">106</span>
<span class="w">        </span><span class="mi">10004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2016</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10000</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">102</span>
<span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<p><strong>Oracle23ai:</strong>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;INSERT INTO orders(order_number, order_date, purchaser, quantity, product_id) VALUES (10005, TO_DATE(&#39;2025-12-12&#39;, &#39;YYYY-MM-DD&#39;), 1002, 10000, 102);\n&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>oracle<span class="w"> </span>sqlplus<span class="w"> </span>c##dbzuser/dbz@//localhost:1521/FREE
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">oracle23ai</span><span class="p">.</span><span class="n">orders</span><span class="p">;</span>
<span class="w"> </span><span class="n">order_number</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">order_date</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">purchaser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span>
<span class="c1">--------------+---------------------+-----------+----------+------------</span>
<span class="w">        </span><span class="mi">10001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10000</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">102</span>
<span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<p><strong>Oracle19c:</strong>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;INSERT INTO orders(order_number, order_date, purchaser, quantity, product_id) VALUES (10005, TO_DATE(&#39;2025-12-12&#39;, &#39;YYYY-MM-DD&#39;), 1002, 10000, 102);\n&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>ora19c<span class="w"> </span>sqlplus<span class="w"> </span>DBZUSER/dbz@//localhost:1521/FREE
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">oracle19c</span><span class="p">.</span><span class="n">orders</span><span class="p">;</span>
<span class="w"> </span><span class="n">order_number</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">order_date</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">purchaser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span>
<span class="c1">--------------+---------------------+-----------+----------+------------</span>
<span class="w">        </span><span class="mi">10001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10000</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">102</span>
<span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<p><strong>OLR:</strong>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>-ne<span class="w"> </span><span class="s2">&quot;INSERT INTO orders(order_number, order_date, purchaser, quantity, product_id) VALUES (10005, TO_DATE(&#39;2025-12-12&#39;, &#39;YYYY-MM-DD&#39;), 1002, 10000, 102);\n&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>ora19c<span class="w"> </span>sqlplus<span class="w"> </span>DBZUSER/dbz@//localhost:1521/FREE
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">olr</span><span class="p">.</span><span class="n">orders</span><span class="p">;</span>
<span class="w"> </span><span class="n">order_number</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">order_date</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">purchaser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span>
<span class="c1">--------------+---------------------+-----------+----------+------------</span>
<span class="w">        </span><span class="mi">10001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">107</span>
<span class="w">        </span><span class="mi">10005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">10000</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">102</span>
<span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<h2 id="zh-getting-started-quick_start-grafana-">Grafana 上的连接器指标 - 可选<a class="headerlink" href="#zh-getting-started-quick_start-grafana-" title="Permanent link">&para;</a></h2>
<p><img alt="img" src="/images/grafana-home.jpg" /></p>
<p>如果您选择使用 <code>ezdeploy.sh</code> 部署监控，并在启动连接器之前调用了可选的 <code>synchdb_add_jmx_exporter_conninfo()</code>，则连接器指标将在 Grafana 上可用。</p>
<ul>
<li><strong>访问 Grafana:</strong> <a href="http://localhost:3000/">http://localhost:3000/</a></li>
<li><strong>默认登录名:</strong> admin/admin (首次登录时需要更改密码)</li>
</ul>
<p><strong>导航到仪表板菜单：</strong>
<img alt="img" src="/images/grafana-dashboards.jpg" /></p>
<p><strong>选择所需模板：</strong></p>
<ul>
<li>Java 虚拟机 - JVM 资源信息</li>
<li>SynchDB MySQL 仪表板 - MySQL 连接器信息</li>
<li>SynchDB SQLServer 仪表板 - SQLServer 连接器信息</li>
<li>SynchDB Oracle 仪表板 - Oracle 连接器信息</li>
</ul>
<p><strong>选择所需实例：</strong>
每个启用 JMX 导出器的连接器都绑定到一个专用端口号，以便 Prometheus 可以从中获取数据。使用实例下拉菜单按端口号选择连接器。</p>
<p><img alt="img" src="/images/grafana-instance.jpg" /></p>
<p><strong>Java 虚拟机仪表板：</strong>
<img alt="img" src="/images/grafana-jvm.jpg" /></p>
<p><strong>MySQL 仪表板：</strong>
<img alt="img" src="/images/grafana-mysql.jpg" /></p>
<p><strong>SQLServer 仪表板：</strong>
<img alt="img" src="/images/grafana-sqlserver.jpg" /></p>
<p><strong>Oracle 仪表板：</strong>
<img alt="img" src="/images/grafana-oracle.jpg" /></p>
<h2 id="zh-getting-started-quick_start-_8"><strong>停止并移除连接器</strong><a class="headerlink" href="#zh-getting-started-quick_start-_8" title="Permanent link">&para;</a></h2>
<p><strong>MySQL:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_stop_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_del_conninfo</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Sqlserver:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_stop_engine_bgw</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_del_conninfo</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Oracle23ai:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_stop_engine_bgw</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_del_conninfo</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Oracle19c:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_stop_engine_bgw</span><span class="p">(</span><span class="s1">&#39;ora19cconn&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_del_conninfo</span><span class="p">(</span><span class="s1">&#39;ora19cconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>OLR(Oracle19c):</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_stop_engine_bgw</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_del_conninfo</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">);</span>
</code></pre></div></p></section></section>
                    <section class='print-page md-section' id='section-4' heading-number='4'>
                        <h1>监控<a class='headerlink' href='#section-4' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="zh-monitoring-stats_view" heading-number="4.1"><h1 id="zh-monitoring-stats_view-_1">連接器統計訊息<a class="headerlink" href="#zh-monitoring-stats_view-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-monitoring-stats_view-_2"><strong>檢查連接器運行統計信息</strong><a class="headerlink" href="#zh-monitoring-stats_view-_2" title="Permanent link">&para;</a></h2>
<p>SynchDB 會記錄每個連接器的統計信息。這些統計信息與 Debezium 或 JVM 基於 JMX 的統計不同，儘管它們可能具有相似或重疊的參數。</p>
<p>統計信息分為三類：</p>
<ul>
<li>常規統計信息</li>
<li>快照統計訊息</li>
<li>CDC 統計信息</li>
</ul>
<p>請注意，這些統計信息不是持久化的，在 PostgreSQL 重新啟動後會遺失/重置。</p>
<h2 id="zh-monitoring-stats_view-_3"><strong>常規統計信息</strong><a class="headerlink" href="#zh-monitoring-stats_view-_3" title="Permanent link">&para;</a></h2>
<p>透過 synchdb_genstats 視圖取得：
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_genstats</span><span class="p">;</span>

<span class="w">  </span><span class="n">name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">bad_events</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">total_events</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">batches_done</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">average_batch_size</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">first_src_ts</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="n">first_pg_ts</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="n">last_src_ts</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="n">last_pg_ts</span>
<span class="c1">---------+------------+--------------+--------------+--------------------+---------------+---------------+---------------+---------------</span>
<span class="w"> </span><span class="n">olrconn</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">191</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">453</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">14</span><span class="w"> </span><span class="o">|</span><span class="w">                 </span><span class="mi">32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1761170446000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1761170450120</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1761170448000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1761170450120</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div></p>
<p>列詳情：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>名稱</td>
<td>由 <code>synchdb_add_conninfo()</code> 建立的關聯連接器資訊名稱</td>
</tr>
<tr>
<td>bad_events</td>
<td>忽略的錯誤事件數量（例如空事件、不支援的 DDL 事件等）</td>
</tr>
<tr>
<td>total_events</td>
<td>已處理的事件總數（包括 bad_events）</td>
</tr>
<tr>
<td>batches_done</td>
<td>已完成的批次數</td>
</tr>
<tr>
<td>average_batch_size</td>
<td>平均批次大小 (total_events / batches_done)</td>
</tr>
<tr>
<td>first_src_ts</td>
<td>最後一個批次的第一個事件在外部資料庫產生的時間戳記（以毫秒為單位）</td>
</tr>
<tr>
<td>first_pg_ts</td>
<td>最後一個批次的第一個事件應用到 PostgreSQL 的時間戳（以毫秒為單位）</td>
</tr>
<tr>
<td>last_src_ts</td>
<td>最後一個批次的最後一個事件在外部資料庫產生的時間戳記（以毫秒為單位）</td>
</tr>
<tr>
<td>last_pg_ts</td>
<td>最後一個批次的最後一個事件應用到 PostgreSQL 的時間戳（以毫秒為單位）</td>
</tr>
</tbody>
</table>
<h2 id="zh-monitoring-stats_view-_4"><strong>快照統計信息</strong><a class="headerlink" href="#zh-monitoring-stats_view-_4" title="Permanent link">&para;</a></h2>
<p>透過 synchdb_snapstats 視圖取得：
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_snapstats</span><span class="p">;</span>

<span class="w">  </span><span class="n">name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="k">rows</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">snapshot_begin_ts</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">snapshot_end_ts</span>
<span class="c1">---------+--------+--------+-------------------+-----------------</span>
<span class="w"> </span><span class="n">olrconn</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">100032</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1761160017191</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1761160033250</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div></p>
<p>列詳情：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>名稱</td>
<td>由 <code>synchdb_add_conninfo()</code> 建立的關聯連接器資訊名稱</td>
</tr>
<tr>
<td>表</td>
<td>快照過程中遷移的表格模式數量</td>
</tr>
<tr>
<td>行</td>
<td>快照過程中遷移的行數</td>
</tr>
<tr>
<td>快照開始時間</td>
<td>快照開始時間的時間戳記（以毫秒為單位）</td>
</tr>
<tr>
<td>快照結束時間</td>
<td>快照結束時間的時間戳記（以毫秒為單位）</td>
</tr>
</tbody>
</table>
<h2 id="zh-monitoring-stats_view-cdc"><strong>CDC 統計信息</strong><a class="headerlink" href="#zh-monitoring-stats_view-cdc" title="Permanent link">&para;</a></h2>
<p>透過 synchdb_cdcstats 視圖取得：
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_cdcstats</span><span class="p">;</span>

<span class="w">  </span><span class="n">name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">ddls</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dmls</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">creates</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">updates</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">deletes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">txs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">truncates</span>
<span class="c1">---------+------+------+---------+---------+---------+-----+-----------</span>
<span class="w"> </span><span class="n">olrconn</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">161</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">124</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">47</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">67</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">562</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">0</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div></p>
<p>列詳情：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>由 <code>synchdb_add_conninfo()</code> 建立的關聯連接器資訊名稱</td>
</tr>
<tr>
<td>ddls</td>
<td>已完成的 DDL 運算元</td>
</tr>
<tr>
<td>dmls</td>
<td>已完成的 DML 運算元</td>
</tr>
<tr>
<td>creates</td>
<td>CDC 階段完成的 CREATES 事件數</td>
</tr>
<tr>
<td>updates</td>
<td>CDC 階段完成的 UPDATES 事件數</td>
</tr>
<tr>
<td>deletes</td>
<td>CDC 階段完成的 DELETES 事件數</td>
</tr>
<tr>
<td>txs</td>
<td>處理的事務事件數，例如 begin 和 commit</td>
</tr>
<tr>
<td>truncates</td>
<td>處理的 truncate 事件數</td>
</tr>
</tbody>
</table>
<h2 id="zh-monitoring-stats_view-synchdb_reset_stats"><strong>synchdb_reset_stats</strong><a class="headerlink" href="#zh-monitoring-stats_view-synchdb_reset_stats" title="Permanent link">&para;</a></h2>
<p><strong>用途</strong>：重置指定連接器名稱的所有統計信息</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_reset_stats</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">);</span>
</code></pre></div></section><section class="print-page" id="zh-monitoring-state_view" heading-number="4.2"><h1 id="zh-monitoring-state_view-_1">连接器运行状态<a class="headerlink" href="#zh-monitoring-state_view-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-monitoring-state_view-_2">检查连接器运行状态<a class="headerlink" href="#zh-monitoring-state_view-_2" title="Permanent link">&para;</a></h2>
<p>使用 <code>synchdb_state_view()</code> 检查所有连接器的运行状态。</p>
<p>请参阅以下示例输出：
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>
<span class="w">     </span><span class="n">name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="n">stage</span><span class="w">        </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span><span class="w">                                           </span><span class="n">last_dbz_offset</span>
<span class="c1">---------------+----------------+--------+---------------------+---------+----------+------------------------------------------------------------------------------------------------------</span>
<span class="w"> </span><span class="n">sqlserverconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sqlserver</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">579820</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">capture</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;commit_lsn&quot;</span><span class="p">:</span><span class="ss">&quot;0000006a:00006608:0003&quot;</span><span class="p">,</span><span class="ss">&quot;snapshot&quot;</span><span class="p">:</span><span class="k">true</span><span class="p">,</span><span class="ss">&quot;snapshot_completed&quot;</span><span class="p">:</span><span class="k">false</span><span class="err">}</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">579845</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">capture</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;ts_sec&quot;</span><span class="p">:</span><span class="mi">1741301103</span><span class="p">,</span><span class="ss">&quot;file&quot;</span><span class="p">:</span><span class="ss">&quot;mysql-bin.000009&quot;</span><span class="p">,</span><span class="ss">&quot;pos&quot;</span><span class="p">:</span><span class="mi">574318212</span><span class="p">,</span><span class="ss">&quot;row&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="ss">&quot;server_id&quot;</span><span class="p">:</span><span class="mi">223344</span><span class="p">,</span><span class="ss">&quot;event&quot;</span><span class="p">:</span><span class="mi">2</span><span class="err">}</span>
<span class="w"> </span><span class="n">oracleconn</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">oracle</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">580053</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">capture</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">flushed</span><span class="w"> </span><span class="n">yet</span>
<span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div></p>
<p>列详情：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>由 <code>synchdb_add_conninfo()</code> 创建的关联连接器信息名称</td>
</tr>
<tr>
<td>connector_type</td>
<td>连接器类型（mysql、oracle、sqlserver 等）</td>
</tr>
<tr>
<td>pid</td>
<td>连接器工作进程的 PID</td>
</tr>
<tr>
<td>stage</td>
<td>连接器的阶段。见下文。</td>
</tr>
<tr>
<td>state</td>
<td>连接器的状态。见下文。</td>
</tr>
<tr>
<td>err</td>
<td>工作进程遇到的最后一个可能导致其退出的错误消息。此错误可能源于 PostgreSQL 处理更改时，也可能源于 Debezium 运行引擎访问异构数据库数据时。</td>
</tr>
<tr>
<td>last_dbz_offset</td>
<td>synchdb 捕获的最后一个 Debezium 偏移量。请注意，这可能无法反映连接器引擎的当前实时偏移量值。相反，它显示为一个检查点，我们可以根据需要从此偏移量点重新启动。</td>
</tr>
</tbody>
</table>
<p><strong>可能的状态</strong>：</p>
<ul>
<li>🔴 <code>stopped</code> - 非活动</li>
<li>🟡 <code>initializing</code> - 正在启动</li>
<li>🟠 <code>paused</code> - 暂时停止</li>
<li>🟢 <code>syncing</code> - 正在主动轮询</li>
<li>🔵 <code>parsing</code> - 正在处理事件</li>
<li>🟣 <code>converting</code> - 正在转换数据</li>
<li>⚪ <code>executing</code> - 正在应用更改</li>
<li>🟤 <code>updating offset</code> - 正在更新检查点</li>
<li>🟨 <code>restarting</code> - 正在重新初始化</li>
<li>⚪ <code>dumping memory</code> - JVM 正在准备将内存信息转储到日志文件</li>
<li>⚫ <code>unknown</code> - 不确定状态</li>
</ul>
<p><strong>可能的状态</strong>：</p>
<ul>
<li><code>initial snapping</code> - 连接器正在执行初始快照（构建表结构以及可选的初始数据）</li>
<li><code>change data capture</code> - 连接器正在流式传输后续表更改 (CDC)</li>
<li><code>schema sync</code> - 连接器仅复制表架构（无数据）</li>
</ul></section><section class="print-page" id="zh-monitoring-attr_view" heading-number="4.3"><h1 id="zh-monitoring-attr_view-_1">属性视图<a class="headerlink" href="#zh-monitoring-attr_view-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-monitoring-attr_view-_2"><strong>查看连接器管理的属性</strong><a class="headerlink" href="#zh-monitoring-attr_view-_2" title="Permanent link">&para;</a></h2>
<p>连接器完成初始表快照后，源表、列和数据类型将根据<a href="https://docs.synchdb.com/zh/user-guide/object_mapping_rules/">对象映射规则</a>在 PostgreSQL 端进行转换和创建。SynchDB 提供了一个视图，可并排显示连接器的数据类型、名称映射以及源表和目标表之间的转换规则关系。</p>
<p>此视图仅供参考，旨在向用户显示连接器当前正在跟踪的表的列表以及每个表/列使用的映射/转换规则。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">synchdb_att_view</span><span class="p">();</span>
</code></pre></div>
<p><strong>返回字段</strong>：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>描述</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>连接器标识符</td>
<td>文本</td>
</tr>
<tr>
<td><code>attnum</code></td>
<td>属性编号</td>
<td>整数</td>
</tr>
<tr>
<td><code>ext_tbname</code></td>
<td>远程显示的表名</td>
<td>文本</td>
</tr>
<tr>
<td><code>pg_tbname</code></td>
<td>PostgreSQL 中的映射表名</td>
<td>文本</td>
</tr>
<tr>
<td><code>ext_attname</code></td>
<td>远程显示的列名</td>
<td>文本</td>
</tr>
<tr>
<td><code>pg_attname</code></td>
<td>PostgreSQL 中映射的列名</td>
<td>文本</td>
</tr>
<tr>
<td><code>ext_atttypename</code></td>
<td>远程显示的数据类型</td>
<td>文本</td>
</tr>
<tr>
<td><code>pg_atttypename</code></td>
<td>PostgreSQL 中映射的数据类型</td>
<td>文本</td>
</tr>
<tr>
<td><code>transform</code></td>
<td>转换表达式</td>
<td>文本</td>
</tr>
</tbody>
</table>
<p><strong>示例输出</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_att_view</span><span class="p">;</span>
<span class="w">   </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">attnum</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">ext_tbname</span><span class="w">         </span><span class="o">|</span><span class="w">         </span><span class="n">pg_tbname</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">ext_attname</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">pg_attname</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">ext_atttypename</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">pg_atttypename</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">transform</span>
<span class="c1">-----------+-------+--------+----------------------------+----------------------------+-------------+-------------+-----------------+----------------+----------------------------</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">street</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">street</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">state</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">state</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">zip</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">zip</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">ENUM</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">first_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">first_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">last_name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">family_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">email</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">contact</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">g</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">g</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">geometry</span><span class="w">       </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">h</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">h</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">stuff</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">stuff</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;%d&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&lt;&lt;&lt;&lt;&lt;&#39;</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">stuff</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">stuff</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nb">FLOAT</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">float4</span><span class="w">         </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nb">int8</span><span class="w">           </span><span class="o">|</span>
</code></pre></div></section><section class="print-page" id="zh-monitoring-jvm_mem" heading-number="4.4"><h1 id="zh-monitoring-jvm_mem-jvm">JVM 内存使用情况<a class="headerlink" href="#zh-monitoring-jvm_mem-jvm" title="Permanent link">&para;</a></h1>
<h2 id="zh-monitoring-jvm_mem-jvm_1"><strong>转储 JVM 内存使用情况</strong><a class="headerlink" href="#zh-monitoring-jvm_mem-jvm_1" title="Permanent link">&para;</a></h2>
<p>我们可以使用实用函数 <code>synchdb_log_jvm_meminfo</code> 将当前 JVM 的堆内存和非堆内存使用情况转储到日志文件中。这纯粹是提供信息，旨在让用户了解不同工作负载的内存使用情况，这对于为连接器的 JVM 配置合适的最大堆内存值可能很重要。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_log_jvm_meminfo</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>检查 PostgreSQL 日志文件：
<div class="highlight"><pre><span></span><code>2024-12-09 14:34:21.910 PST [25491] LOG:  Requesting memdump for mysqlconn connector
2024-12-09 14:34:21 WARN  DebeziumRunner:297 - Heap Memory:
2024-12-09 14:34:21 WARN  DebeziumRunner:298 -   Used: 19272600 bytes
2024-12-09 14:34:21 WARN  DebeziumRunner:299 -   Committed: 67108864 bytes
2024-12-09 14:34:21 WARN  DebeziumRunner:300 -   Max: 2147483648 bytes
2024-12-09 14:34:21 WARN  DebeziumRunner:302 - Non-Heap Memory:
2024-12-09 14:34:21 WARN  DebeziumRunner:303 -   Used: 42198864 bytes
2024-12-09 14:34:21 WARN  DebeziumRunner:304 -   Committed: 45023232 bytes
2024-12-09 14:34:21 WARN  DebeziumRunner:305 -   Max: -1 bytes
</code></pre></div></p></section><section class="print-page" id="zh-monitoring-jmx_monitor" heading-number="4.5"><h1 id="zh-monitoring-jmx_monitor-jmx-mbean">JMX MBEAN 监控<a class="headerlink" href="#zh-monitoring-jmx_monitor-jmx-mbean" title="Permanent link">&para;</a></h1>
<h2 id="zh-monitoring-jmx_monitor-jmxjava"><strong>JMX（Java 管理扩展）</strong><a class="headerlink" href="#zh-monitoring-jmx_monitor-jmxjava" title="Permanent link">&para;</a></h2>
<p>JMX，即 Java 管理扩展，是一种 Java 技术，提供用于管理和监控应用程序、系统对象、设备和面向服务的网络的工具。它允许开发人员公开应用程序信息，并允许外部工具访问和交互这些信息，以进行监控和管理。</p>
<h2 id="zh-monitoring-jmx_monitor-debezium-jmx-mbean"><strong>Debezium 的 JMX MBean</strong><a class="headerlink" href="#zh-monitoring-jmx_monitor-debezium-jmx-mbean" title="Permanent link">&para;</a></h2>
<p>Debezium 连接器通过连接器的 MBean 名称（MBean 标签等于连接器名称）公开指标。这些指标特定于每个连接器实例，提供有关连接器快照、流式传输和模式历史记录进程行为的数据。</p>
<h2 id="zh-monitoring-jmx_monitor-synchdb_add_jmx_conninfo-jmx-synchdb_del_jmx_conninfo"><strong>使用 synchdb_add_jmx_conninfo() 在连接器上启用 JMX，或使用 synchdb_del_jmx_conninfo() 禁用</strong><a class="headerlink" href="#zh-monitoring-jmx_monitor-synchdb_add_jmx_conninfo-jmx-synchdb_del_jmx_conninfo" title="Permanent link">&para;</a></h2>
<p>synchdb_add_jmx_conninfo() 和 synchdb_del_jmx_conninfo() 函数用于向现有连接器添加或删除 JMX 监控配置。这允许通过 JConsole 等工具进行运行时监控和诊断。</p>
<p><strong>函数签名</strong></p>
<div class="highlight"><pre><span></span><code>synchdb_add_jmx_conninfo(
    name text,
    jmx_listenaddr text,
    jmx_port integer,
    jmx_rmiserveraddr text,
    jmx_rmiport integer,
    jmx_auth boolean,
    jmx_auth_passwdfile text,
    jmx_auth_accessfile text,
    jmx_ssl boolean,
    jmx_ssl_keystore text,
    jmx_ssl_keystore_pass text,
    jmx_ssl_truststore text,
    jmx_ssl_truststore_pass text
)

synchdb_del_jmx_conninfo(
    name text
)
</code></pre></div>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>name</code></strong></td>
<td><em>(文本)</em><br>要添加 JMX 配置的现有连接器的名称。必须已存在于 <code>synchdb_conninfo</code> 中。</td>
</tr>
<tr>
<td><strong><code>jmx_listenaddr</code></strong></td>
<td><em>(文本)</em><br>JVM 将在其上侦听 JMX 连接的 IP 地址。使用 <code>'0.0.0.0'</code> 侦听所有网络接口，或指定特定 IP。</td>
</tr>
<tr>
<td><strong><code>jmx_port</code></strong></td>
<td><em>(整数)</em><br>JMX 通信的本地端口（用于客户端发现）。必须处于打开状态且未使用。</td>
</tr>
<tr>
<td><strong><code>jmx_rmiserveraddr</code></strong></td>
<td><em>(文本)</em><br>远程 JMX 客户端（例如 JConsole）用于连接 JVM 的公共/外部 IP 地址。通常设置为主机的外部 IP。</td>
</tr>
<tr>
<td><strong><code>jmx_rmiport</code></strong></td>
<td><em>(整数)</em><br>用于实际 JMX 对象通信的 RMI 服务器端口。此端口也必须在防火墙和网络设置中打开。通常与 <code>jmx_port</code> 相同。</td>
</tr>
<tr>
<td><strong><code>jmx_auth</code></strong></td>
<td><em>(布尔值)</em><br>是否启用 JMX 身份验证？如果为 <code>true</code>，客户端必须提供存储在以下文件中的用户名/密码。</td>
</tr>
<tr>
<td><strong><code>jmx_auth_passwdfile</code></strong></td>
<td><em>(文本)</em><br>用于 JMX 身份验证的密码文件的路径。如果不使用身份验证，请传递 <code>'null'</code>。</td>
</tr>
<tr>
<td><strong><code>jmx_auth_accessfile</code></strong></td>
<td><em>(text)</em><br>定义角色（例如 <code>monitor</code>、<code>control</code>）的访问控制文件的路径。仅在启用身份验证时才需要。如果不使用身份验证，请传递 <code>'null'</code></td>
</tr>
<tr>
<td><strong><code>jmx_ssl</code></strong></td>
<td><em>(boolean)</em><br>是否为 JMX 连接启用 SSL 加密？设置为 <code>true</code> 以确保通信安全。</td>
</tr>
<tr>
<td><strong><code>jmx_ssl_keystore</code></strong></td>
<td><em>(text)</em><br>包含服务器私钥和证书的密钥库文件（JKS 格式）的路径。如果 <code>jmx_ssl = true</code>，则为必填项。</td>
</tr>
<tr>
<td><strong><code>jmx_ssl_keystore_pass</code></strong></td>
<td><em>(text)</em><br>密钥库文件的密码。</td>
</tr>
<tr>
<td><strong><code>jmx_ssl_truststore</code></strong></td>
<td><em>(text)</em><br>保存受信任 CA 证书的信任库 (JKS) 的路径。如果配置了双向 TLS，则用于验证客户端身份。</td>
</tr>
<tr>
<td><strong><code>jmx_ssl_truststore_pass</code></strong></td>
<td><em>(文本)</em><br>信任库文件的密码。</td>
</tr>
</tbody>
</table>
<h2 id="zh-monitoring-jmx_monitor-jmx"><strong>JMX 身份验证的密码和访问文件</strong><a class="headerlink" href="#zh-monitoring-jmx_monitor-jmx" title="Permanent link">&para;</a></h2>
<p>在 JVM 配置中启用 JMX 身份验证（即设置 jmx_auth = true）时，您必须提供两个文件：</p>
<h3 id="zh-monitoring-jmx_monitor-_1"><strong>密码文件</strong>：<a class="headerlink" href="#zh-monitoring-jmx_monitor-_1" title="Permanent link">&para;</a></h3>
<p>此文件存储有效的 JMX 用户名及其对应的密码。</p>
<p><strong>格式：</strong></p>
<div class="highlight"><pre><span></span><code># Format: username password
&lt;username&gt; &lt;password&gt;
</code></pre></div>
<p><strong>例子：</strong></p>
<div class="highlight"><pre><span></span><code>monitorRole mySecretPassword
controlRole anotherSecretPassword
</code></pre></div>
<h3 id="zh-monitoring-jmx_monitor-_2"><strong>访问文件</strong>：<a class="headerlink" href="#zh-monitoring-jmx_monitor-_2" title="Permanent link">&para;</a></h3>
<p>此文件定义了每个用户可以通过 JMX 执行的操作。可能的访问级别：</p>
<ul>
<li>readonly – 可以查看 MBean，但不能修改。</li>
<li>readwrite – 可以查看和修改 MBean。</li>
</ul>
<p>格式：
<div class="highlight"><pre><span></span><code># 格式：用户名 访问级别
&lt;用户名&gt; &lt;访问权限&gt;
</code></pre></div></p>
<p>示例：
<div class="highlight"><pre><span></span><code>monitorRole readonly
controlRole readwrite
</code></pre></div></p>
<h3 id="zh-monitoring-jmx_monitor-_3"><strong>文件权限</strong>：<a class="headerlink" href="#zh-monitoring-jmx_monitor-_3" title="Permanent link">&para;</a></h3>
<p>确保两个文件均归运行 JVM 的用户所有，且具有受限的权限：</p>
<div class="highlight"><pre><span></span><code>chmod 600 jmxpwd.file jmxacc.file
chown youruser:youruser jmxpwd.file jmxacc.file
</code></pre></div>
<h2 id="zh-monitoring-jmx_monitor-synchdb_add_jmx_conninfo"><strong>synchdb_add_jmx_conninfo 示例</strong><a class="headerlink" href="#zh-monitoring-jmx_monitor-synchdb_add_jmx_conninfo" title="Permanent link">&para;</a></h2>
<p><strong>启用无需身份验证和 SSL 的 JMX MBean：</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w">    </span><span class="c1">-- existing connector name</span>
<span class="w">    </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w">      </span><span class="c1">-- JMX listen address</span>
<span class="w">    </span><span class="mi">9010</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX listen port</span>
<span class="w">    </span><span class="s1">&#39;10.55.13.17&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- JMX RMI server address - for remote client connect</span>
<span class="w">    </span><span class="mi">9010</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX RMI server port - for remoet client connect</span>
<span class="w">    </span><span class="k">false</span><span class="p">,</span><span class="w">          </span><span class="c1">-- use authentication?</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- password file for authentication</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- access file for authentication</span>
<span class="w">    </span><span class="k">false</span><span class="p">,</span><span class="w">          </span><span class="c1">-- use SSL?</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL keystore path</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL keystore password</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL trust store</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">);</span><span class="w">        </span><span class="c1">-- SSL trust store password</span>
</code></pre></div>
<p><strong>启用带有身份验证的 JMX MBean</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w">    </span><span class="c1">-- existing connector name</span>
<span class="w">    </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w">      </span><span class="c1">-- JMX listen address</span>
<span class="w">    </span><span class="mi">9010</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX listen port</span>
<span class="w">    </span><span class="s1">&#39;10.55.13.17&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- JMX RMI server address - for remote client connect</span>
<span class="w">    </span><span class="mi">9010</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX RMI server port - for remoet client connect</span>
<span class="w">    </span><span class="k">true</span><span class="p">,</span><span class="w">           </span><span class="c1">-- use authentication?</span>
<span class="w">    </span><span class="s1">&#39;/path/to/passwd.file&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- password file for authentication</span>
<span class="w">    </span><span class="s1">&#39;/path/to/access.file&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- access file for authentication</span>
<span class="w">    </span><span class="k">false</span><span class="p">,</span><span class="w">          </span><span class="c1">-- use SSL?</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL keystore path</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL keystore password</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL trust store</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">);</span><span class="w">        </span><span class="c1">-- SSL trust store password</span>
</code></pre></div>
<p><strong>启用带有身份验证和 SSL 的 JMX MBean，无需 SSL 客户端验证</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w">    </span><span class="c1">-- existing connector name</span>
<span class="w">    </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w">      </span><span class="c1">-- JMX listen address</span>
<span class="w">    </span><span class="mi">9010</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX listen port</span>
<span class="w">    </span><span class="s1">&#39;10.55.13.17&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- JMX RMI server address - for remote client connect</span>
<span class="w">    </span><span class="mi">9010</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX RMI server port - for remoet client connect</span>
<span class="w">    </span><span class="k">true</span><span class="p">,</span><span class="w">           </span><span class="c1">-- use authentication?</span>
<span class="w">    </span><span class="s1">&#39;/path/to/passwd.file&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- password file for authentication</span>
<span class="w">    </span><span class="s1">&#39;/path/to/access.file&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- access file for authentication</span>
<span class="w">    </span><span class="k">true</span><span class="p">,</span><span class="w">           </span><span class="c1">-- use SSL?</span>
<span class="w">    </span><span class="s1">&#39;/path/to/keystore&#39;</span><span class="p">,</span><span class="w">            </span><span class="c1">-- SSL keystore path</span>
<span class="w">    </span><span class="s1">&#39;keystorepass&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL keystore password</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL trust store</span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">);</span><span class="w">        </span><span class="c1">-- SSL trust store password</span>
</code></pre></div>
<p><strong>启用具有身份验证和 SSL + SSL 客户端验证的 JMX MBean</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w">    </span><span class="c1">-- existing connector name</span>
<span class="w">    </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w">      </span><span class="c1">-- JMX listen address</span>
<span class="w">    </span><span class="mi">9010</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX listen port</span>
<span class="w">    </span><span class="s1">&#39;10.55.13.17&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- JMX RMI server address - for remote client connect</span>
<span class="w">    </span><span class="mi">9010</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX RMI server port - for remoet client connect</span>
<span class="w">    </span><span class="k">true</span><span class="p">,</span><span class="w">           </span><span class="c1">-- use authentication?</span>
<span class="w">    </span><span class="s1">&#39;/path/to/passwd.file&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- password file for authentication</span>
<span class="w">    </span><span class="s1">&#39;/path/to/access.file&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- access file for authentication</span>
<span class="w">    </span><span class="k">true</span><span class="p">,</span><span class="w">           </span><span class="c1">-- use SSL?</span>
<span class="w">    </span><span class="s1">&#39;/path/to/keystore&#39;</span><span class="p">,</span><span class="w">            </span><span class="c1">-- SSL keystore path</span>
<span class="w">    </span><span class="s1">&#39;keystorepass&#39;</span><span class="p">,</span><span class="w">         </span><span class="c1">-- SSL keystore password</span>
<span class="w">    </span><span class="s1">&#39;/path/to/truststore&#39;</span><span class="p">,</span><span class="w">          </span><span class="c1">-- SSL trust store</span>
<span class="w">    </span><span class="s1">&#39;truststorepass&#39;</span><span class="p">);</span><span class="w">      </span><span class="c1">-- SSL trust store password</span>
</code></pre></div>
<h2 id="zh-monitoring-jmx_monitor-jconsole-jmx"><strong>使用 jconsole 可视化 JMX 指标</strong><a class="headerlink" href="#zh-monitoring-jmx_monitor-jconsole-jmx" title="Permanent link">&para;</a></h2>
<p>当启动一个配置了 JMX 的连接器时，JMX 服务将在指定的端口号上运行。我们可以使用 Java 发行版自带的 jconsole 连接到 JMX 服务器。可以通过 JVM（连接器工作进程）PID 或 IP 地址和端口号进行本地连接。如果启用了身份验证，则还需要用户名和密码。如果不使用身份验证，则这些可以留空。</p>
<p><img alt="img" src="/images/jmx.jpg" /></p>
<p>连接成功后，我们可以查看 JVM 运行指标的所有详细信息，例如 CPU、内存、类利用率、线程数等。</p>
<p><img alt="img" src="/images/jmx2.jpg" />
<img alt="img" src="/images/jmx3.jpg" />
<img alt="img" src="/images/jmx4.jpg" /></p>
<h2 id="zh-monitoring-jmx_monitor-debezium-jmx-mbean_1"><strong>可视化 Debezium JMX MBean</strong><a class="headerlink" href="#zh-monitoring-jmx_monitor-debezium-jmx-mbean_1" title="Permanent link">&para;</a></h2>
<p>最后一个选项卡是 MBean，其中包含 Debezium 针对架构历史记录、快照和流式传输阶段的特定指标。</p>
<p><img alt="img" src="/images/jmx5.jpg" />
<img alt="img" src="/images/jmx6.jpg" />
<img alt="img" src="/images/jmx7.jpg" /></p>
<p>根据连接器类型，MBean 指标可能会有所不同。有关捕获指标列表，请参阅 Debezium 连接器文档：</p>
<ul>
<li><a href="https://debezium.io/documentation/reference/stable/connectors/mysql.html#mysql-snapshot-metrics">MySQL 的 MBean</a></li>
<li><a href="https://debezium.io/documentation/reference/stable/connectors/sqlserver.html#sqlserver-snapshot-metrics">SQL Server 的 MBean</a></li>
<li><a href="https://debezium.io/documentation/reference/stable/connectors/oracle.html#oracle-snapshot-metrics">Oracle 的 MBean</a></li>
</ul></section><section class="print-page" id="zh-monitoring-jmx_exporter" heading-number="4.6"><h1 id="zh-monitoring-jmx_exporter-jmx-exporter">JMX Exporter<a class="headerlink" href="#zh-monitoring-jmx_exporter-jmx-exporter" title="Permanent link">&para;</a></h1>
<h2 id="zh-monitoring-jmx_exporter-jmx-exporter_1">什么是 JMX Exporter<a class="headerlink" href="#zh-monitoring-jmx_exporter-jmx-exporter_1" title="Permanent link">&para;</a></h2>
<p>JMX Exporter（也称为 JMX Prometheus Java Agent）是一个 Java 代理，它以 Prometheus 可以抓取和监控的格式公开 Java 应用程序的 JMX 指标。它是由 Prometheus 社区创建的一款工具，支持以下功能：</p>
<ul>
<li>访问 JVM 内部指标（例如内存使用情况、线程数、GC 统计信息等）</li>
<li>通过 MBean 公开自定义应用程序指标</li>
<li>通过 HTTP 端点导出这些指标（例如 <a href="http://localhost:9404/metrics">http://localhost:9404/metrics</a>）</li>
<li>将 Java 应用程序（例如 Kafka、Cassandra 或您自己的应用程序）集成到 Prometheus 监控设置中</li>
</ul>
<p>此工具可解锁基于 Prometheus + Graphana 的 SynchDB 连接器监控功能</p>
<p><img alt="img" src="/images/prom.png" /></p>
<h2 id="zh-monitoring-jmx_exporter-jmx">获取 JMX 导出器<a class="headerlink" href="#zh-monitoring-jmx_exporter-jmx" title="Permanent link">&para;</a></h2>
<p>预编译的 JMX 导出器 (.jar) 可在官方 <a href="https://github.com/prometheus/jmx_exporter/releases">JMX 导出器发布页面</a> 获取。我们感兴趣的是“jmx_prometheus_javaagent”工具，例如：</p>
<div class="highlight"><pre><span></span><code>jmx_prometheus_javaagent-1.3.0.jar
</code></pre></div>
<p>请将其下载到运行 SynchDB 连接器的同一台机器上。</p>
<h2 id="zh-monitoring-jmx_exporter-jmx_1">编写 JMX 导出器配置文件<a class="headerlink" href="#zh-monitoring-jmx_exporter-jmx_1" title="Permanent link">&para;</a></h2>
<p>JMX 导出器需要一个配置文件来定义暴露指标的行为。以下是一个基本的配置模板，可帮助您入门。</p>
<div class="highlight"><pre><span></span><code>startDelaySeconds: 0
ssl: false
lowercaseOutputName: true
lowercaseOutputLabelNames: true

rules:
  - pattern: &quot;.*&quot;
</code></pre></div>
<p>有关更多高级配置参数及其使用方法，请参阅<a href="https://prometheus.github.io/jmx_exporter/1.3.0/http-mode/rules/">官方 prometheus 文档</a>。</p>
<h2 id="zh-monitoring-jmx_exporter-jmx-synchdb">将 JMX 导出器配置到 SynchDB 连接器<a class="headerlink" href="#zh-monitoring-jmx_exporter-jmx-synchdb" title="Permanent link">&para;</a></h2>
<p>synchdb_add_jmx_exporter_conninfo() 和 synchdb_del_jmx_exporter_conninfo() 函数用于向现有连接器添加或删除 JMX 导出器配置。这支持通过 Prometheus 和 Graphana 等工具进行运行时监控和诊断。</p>
<p><strong>函数签名</strong></p>
<div class="highlight"><pre><span></span><code>synchdb_add_jmx_exporter_conninfo(
    name TEXT,
    exporter_jar_path TEXT,
    exporter_port INTEGER,
    config_file_path TEXT
);

synchdb_del_jmx_exporter_conninfo(
    name text
)
</code></pre></div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>connector_name</code></td>
<td><code>TEXT</code></td>
<td>Name of the existing connector you want to attach the JMX Exporter to.</td>
</tr>
<tr>
<td><code>exporter_jar_path</code></td>
<td><code>TEXT</code></td>
<td>Absolute path to the <code>jmx_prometheus_javaagent.jar</code> file.</td>
</tr>
<tr>
<td><code>exporter_port</code></td>
<td><code>INT</code></td>
<td>Port on which the JMX Exporter HTTP server will expose metrics (e.g. 9404).</td>
</tr>
<tr>
<td><code>config_file_path</code></td>
<td><code>TEXT</code></td>
<td>Path to the JMX Exporter's YAML configuration file we defined above.</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_jmx_exporter_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w">    </span><span class="c1">-- existing connector name</span>
<span class="w">    </span><span class="s1">&#39;/path/to/jmx_exporter/jar&#39;</span><span class="p">,</span><span class="w">        </span><span class="c1">-- path to JMX exporter java agent jar</span>
<span class="w">    </span><span class="mi">9404</span><span class="p">,</span><span class="w">           </span><span class="c1">-- JMX exporter running port</span>
<span class="w">    </span><span class="s1">&#39;/path/to/jmx/conf&#39;</span><span class="p">);</span><span class="w">       </span><span class="c1">-- path to JMX exporter conf file</span>
</code></pre></div>
<h2 id="zh-monitoring-jmx_exporter-http">通过 HTTP 获取指标<a class="headerlink" href="#zh-monitoring-jmx_exporter-http" title="Permanent link">&para;</a></h2>
<p>当连接器使用 JMX 导出器设置启动时，它将在以下位置公开指标：</p>
<div class="highlight"><pre><span></span><code>http://&lt;host&gt;:9404/metrics
</code></pre></div>
<p>我们可以通过以下方式测试：
<div class="highlight"><pre><span></span><code>curl http://&lt;host&gt;:9404/metrics

# HELP debezium_mysql_connector_metrics_binlogposition debezium.mysql:name=null,type=connector-metrics,attribute=BinlogPosition
# TYPE debezium_mysql_connector_metrics_binlogposition untyped
debezium_mysql_connector_metrics_binlogposition{context=&quot;streaming&quot;,server=&quot;synchdb-connector&quot;} 1500.0
# HELP debezium_mysql_connector_metrics_changesapplied debezium.mysql:name=null,type=connector-metrics,attribute=ChangesApplied
# TYPE debezium_mysql_connector_metrics_changesapplied untyped
debezium_mysql_connector_metrics_changesapplied{context=&quot;schema-history&quot;,server=&quot;synchdb-connector&quot;} 39.0
# HELP debezium_mysql_connector_metrics_changesrecovered debezium.mysql:name=null,type=connector-metrics,attribute=ChangesRecovered
# TYPE debezium_mysql_connector_metrics_changesrecovered untyped
debezium_mysql_connector_metrics_changesrecovered{context=&quot;schema-history&quot;,server=&quot;synchdb-connector&quot;} 26.0
# HELP debezium_mysql_connector_metrics_connected debezium.mysql:name=null,type=connector-metrics,attribute=Connected
# TYPE debezium_mysql_connector_metrics_connected untyped
debezium_mysql_connector_metrics_connected{context=&quot;streaming&quot;,server=&quot;synchdb-connector&quot;} 1.0

...
...
...
</code></pre></div></p>
<h2 id="zh-monitoring-jmx_exporter-prometheus-graphana">Prometheus 和 Graphana<a class="headerlink" href="#zh-monitoring-jmx_exporter-prometheus-graphana" title="Permanent link">&para;</a></h2>
<p>一旦我们确认可以通过 HTTP 获取指标，就可以将此端点配置到 Prometheus 系统，并让其“抓取”所有指标。然后，我们可以在 graphana 中创建一个 Prometheus 数据源，并使用它创建一个仪表板。请参阅 Prometheus 和 graphana <a href="https://grafana.com/docs/grafana/latest/getting-started/get-started-grafana-prometheus/">教程</a> 了解如何操作。</p>
<p>为了快速测试，您还可以使用 <code>ezdeploy</code> 工具快速部署 prometheus 和 grafana，并使用 Synchdb 内置的仪表板模板。有关模式详细信息，请参阅 <a href="#zh-monitoring-jmx_exporter-getting-started-quick_start">快速入门指南</a>。</p></section></section>
                    <section class='print-page md-section' id='section-5' heading-number='5'>
                        <h1>教程<a class='headerlink' href='#section-5' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="zh-tutorial-mysql_cdc_to_postgresql" heading-number="5.1"><h1 id="zh-tutorial-mysql_cdc_to_postgresql-mysql-cdc-postgresql">MySQL CDC 到 PostgreSQL<a class="headerlink" href="#zh-tutorial-mysql_cdc_to_postgresql-mysql-cdc-postgresql" title="Permanent link">&para;</a></h1>
<h2 id="zh-tutorial-mysql_cdc_to_postgresql-synchdb-mysql">为 SynchDB 准备 MySQL 数据库<a class="headerlink" href="#zh-tutorial-mysql_cdc_to_postgresql-synchdb-mysql" title="Permanent link">&para;</a></h2>
<p>在使用 SynchDB 从 MySQL 复制之前，需要按照<a href="https://docs.synchdb.com/zh/getting-started/remote_database_setups/">此处</a> 概述的步骤配置 MySQL</p>
<h2 id="zh-tutorial-mysql_cdc_to_postgresql-mysql">创建 MySQL 连接器<a class="headerlink" href="#zh-tutorial-mysql_cdc_to_postgresql-mysql" title="Permanent link">&para;</a></h2>
<p>创建一个连接器，该连接器指向 MySQL 中 <code>inventory</code> 数据库下的所有表。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3306</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mysqluser&#39;</span><span class="p">,</span>
<span class="s1">&#39;mysqlpwd&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-tutorial-mysql_cdc_to_postgresql-cdc">初始快照 + CDC<a class="headerlink" href="#zh-tutorial-mysql_cdc_to_postgresql-cdc" title="Permanent link">&para;</a></h2>
<p>使用 <code>initial</code> 模式启动连接器将对所有指定表（在本例中为所有表）执行初始快照。完成后，变更数据捕获 (CDC) 进程将开始流式传输新的变更。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial&#39;</span><span class="p">);</span>

<span class="err">或</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div>
<p>The stage of this connector should be in <code>initial snapshot</code> the first time it runs:
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>
<span class="w">    </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">stage</span><span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span><span class="w">                      </span><span class="n">last_dbz_offs</span>
<span class="n">et</span>
<span class="c1">------------+----------------+--------+------------------+---------+----------+-----------------------------------</span>
<span class="c1">-------------------------</span>
<span class="w"> </span><span class="n">mysqlconn2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">522195</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;ts_sec&quot;</span><span class="p">:</span><span class="mi">1750375008</span><span class="p">,</span><span class="ss">&quot;file&quot;</span><span class="p">:</span><span class="ss">&quot;mysql</span>
<span class="ss">-bin.000003&quot;</span><span class="p">,</span><span class="ss">&quot;pos&quot;</span><span class="p">:</span><span class="mi">1500</span><span class="err">}</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div></p>
<p>A new schema called <code>inventory</code> will be created and all tables streamed by the connector will be replicated under that schema.
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">search_path</span><span class="o">=</span><span class="k">public</span><span class="p">,</span><span class="n">inventory</span><span class="p">;</span>
<span class="k">SET</span>
<span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="err">\</span><span class="n">d</span>
<span class="w">                    </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w">  </span><span class="k">Schema</span><span class="w">   </span><span class="o">|</span><span class="w">          </span><span class="n">Name</span><span class="w">           </span><span class="o">|</span><span class="w">   </span><span class="k">Type</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">-----------+-------------------------+----------+--------</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">addresses</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">addresses_id_seq</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customers</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customers_id_seq</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">geom</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">geom_id_seq</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders_order_number_seq</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products_id_seq</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products_on_hand</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_att_view</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_attribute</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_conninfo</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_objmap</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_stats_view</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">17</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div></p>
<p>初始快照完成后，如果至少有一条后续更改被接收并处理，连接器阶段将从“初始快照”切换为“变更数据捕获”。
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>
<span class="w">    </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="n">stage</span><span class="w">        </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span><span class="w">                      </span><span class="n">last_dbz_o</span>
<span class="n">ffset</span>
<span class="c1">------------+----------------+--------+---------------------+---------+----------+--------------------------------</span>
<span class="c1">----------------------------</span>
<span class="w"> </span><span class="n">mysqlconn2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">522195</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">capture</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;ts_sec&quot;</span><span class="p">:</span><span class="mi">1750375008</span><span class="p">,</span><span class="ss">&quot;file&quot;</span><span class="p">:</span><span class="ss">&quot;my</span>
<span class="ss">sql-bin.000003&quot;</span><span class="p">,</span><span class="ss">&quot;pos&quot;</span><span class="p">:</span><span class="mi">1500</span><span class="err">}</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div></p>
<p>这意味着连接器现在正在流式传输指定表的新更改。以“初始”模式重新启动连接器将从上次成功点开始继续复制，并且不会重新运行初始快照。</p>
<h2 id="zh-tutorial-mysql_cdc_to_postgresql-cdc_1">仅初始快照，无 CDC<a class="headerlink" href="#zh-tutorial-mysql_cdc_to_postgresql-cdc_1" title="Permanent link">&para;</a></h2>
<p>使用 <code>initial_only</code> 模式启动连接器将仅对所有指定表（在本例中为全部）执行初始快照，之后将不再执行 CDC。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial_only&#39;</span><span class="p">);</span>
</code></pre></div>
<p>连接器似乎仍在“轮询”其他连接器，但不会捕获任何更改，因为 Debzium 内部已停止 CDC。您可以选择关闭它。在 <code>initial_only</code> 模式下重新启动连接器不会重建表，因为它们已经构建好了。</p>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>
<span class="w">    </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">stage</span><span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span><span class="w">       </span><span class="n">last_dbz_offset</span>
<span class="c1">------------+----------------+--------+------------------+---------+----------+-----------------------------</span>
<span class="w"> </span><span class="n">mysqlconn2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">522330</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">flushed</span><span class="w"> </span><span class="n">yet</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div>
<h2 id="zh-tutorial-mysql_cdc_to_postgresql-cdc_2">仅捕获表模式 + CDC<a class="headerlink" href="#zh-tutorial-mysql_cdc_to_postgresql-cdc_2" title="Permanent link">&para;</a></h2>
<p>使用 <code>no_data</code> 模式启动连接器将仅执行模式捕获，在 PostgreSQL 中构建相应的表，并且不会复制现有表数据（跳过初始快照）。模式捕获完成后，连接器将进入 CDC 模式，并开始捕获对表的后续更改。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;no_data&#39;</span><span class="p">);</span>
</code></pre></div>
<p>在 <code>no_data</code> 模式下重新启动连接器将不会再次重建模式，并且它将从上次成功点恢复 CDC。</p>
<h2 id="zh-tutorial-mysql_cdc_to_postgresql-cdc_3">仅 CDC<a class="headerlink" href="#zh-tutorial-mysql_cdc_to_postgresql-cdc_3" title="Permanent link">&para;</a></h2>
<p>使用 <code>never</code> 模式启动连接器将完全跳过模式捕获和初始快照，并进入 CDC 模式以捕获后续更改。请注意，连接器要求在以 <code>never</code> 模式启动之前，所有捕获表都已在 PostgreSQL 中创建。如果表不存在，连接器在尝试将 CDC 更改应用于不存在的表时将遇到错误。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;never&#39;</span><span class="p">);</span>
</code></pre></div>
<p>以“never”模式重启连接器将从上次成功点开始恢复 CDC。</p>
<h2 id="zh-tutorial-mysql_cdc_to_postgresql-cdc_4">始终执行初始快照 + CDC<a class="headerlink" href="#zh-tutorial-mysql_cdc_to_postgresql-cdc_4" title="Permanent link">&para;</a></h2>
<p>使用 <code>always</code> 模式启动连接器将始终捕获捕获表的模式，始终重做初始快照，然后转到 CDC。这类似于重置按钮，因为使用此模式将重建所有内容。请谨慎使用，尤其是在捕获大量表时，这可能需要很长时间才能完成。重建后，CDC 将恢复正常。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div>
<p>但是，可以使用连接器的 <code>snapshottable</code> 选项选择部分表来重做初始快照。符合 <code>snapshottable</code> 中条件的表将重做初始快照，否则将跳过其初始快照。如果 <code>snapshottable</code> 为 null 或为空，默认情况下，连接器 <code>table</code> 选项中指定的所有表都将在 <code>always</code> 模式下重做初始快照。</p>
<p>此示例使连接器仅重做 <code>inventory.customers</code> 表的初始快照。所有其他表的快照将被跳过。
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">synchdb_conninfo</span>
<span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonb_set</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{snapshottable}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;inventory.customers&quot;&#39;</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">;</span>
</code></pre></div></p>
<p>初始快照完成后，CDC 将开始。在 <code>always</code> 模式下重新启动连接器将重复上述过程。</p></section><section class="print-page" id="zh-tutorial-sqlserver_cdc_to_postgresql" heading-number="5.2"><h1 id="zh-tutorial-sqlserver_cdc_to_postgresql-sql-server-cdc-postgresql">SQL Server CDC 到 PostgreSQL<a class="headerlink" href="#zh-tutorial-sqlserver_cdc_to_postgresql-sql-server-cdc-postgresql" title="Permanent link">&para;</a></h1>
<h2 id="zh-tutorial-sqlserver_cdc_to_postgresql-synchdb-sql-server">为 SynchDB 准备 SQL Server 数据库<a class="headerlink" href="#zh-tutorial-sqlserver_cdc_to_postgresql-synchdb-sql-server" title="Permanent link">&para;</a></h2>
<p>在使用 SynchDB 从 SQL Server 进行复制之前，需要按照<a href="https://docs.synchdb.com/zh/getting-started/remote_database_setups/">此处</a> 概述的步骤配置 SQL Server。</p>
<p>请确保所需的表已在 SQL Server 中启用为 CDC 表。您可以在 SQL Server 客户端上运行以下命令，为“dbo.customer”、“dbo.district”和“dbo.history”启用 CDC。您将根据需要继续添加新表。</p>
<div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="n">MyDB</span>
<span class="k">GO</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;customer&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">role_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;district&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">role_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span><span class="w"> </span><span class="o">@</span><span class="n">source_schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">source_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;history&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">role_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">supports_net_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">GO</span>
</code></pre></div>
<h2 id="zh-tutorial-sqlserver_cdc_to_postgresql-sql-server">创建 SQL Server 连接器<a class="headerlink" href="#zh-tutorial-sqlserver_cdc_to_postgresql-sql-server" title="Permanent link">&para;</a></h2>
<p>创建一个连接器，该连接器指向 SQL Server 中 <code>testDB</code> 数据库下的所有表。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1433</span><span class="p">,</span>
<span class="s1">&#39;sa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Password!&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;testDB&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sqlserver&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-tutorial-sqlserver_cdc_to_postgresql-cdc">初始快照 + 变更数据捕获 (CDC)<a class="headerlink" href="#zh-tutorial-sqlserver_cdc_to_postgresql-cdc" title="Permanent link">&para;</a></h2>
<p>使用 <code>initial</code> 模式启动连接器将对所有指定的表（在本例中为所有表）执行初始快照。完成后，变更数据捕获 (CDC) 过程将开始流式传输新的变更。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial&#39;</span><span class="p">);</span>

<span class="err">或</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">);</span>
</code></pre></div>
<p>此连接器首次运行时，其阶段应处于“初始快照”状态：
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">;</span>
<span class="w">     </span><span class="n">name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">stage</span><span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span><span class="w">       </span><span class="n">last_dbz_offset</span>
<span class="c1">---------------+----------------+--------+------------------+---------+----------+-----------------------------</span>
<span class="w"> </span><span class="n">sqlserverconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sqlserver</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">526003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">flushed</span><span class="w"> </span><span class="n">yet</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div></p>
<p>将创建一个名为“testdb”的新模式，并且连接器流式传输的所有表都将在该模式下复制。
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">search_path</span><span class="o">=</span><span class="k">public</span><span class="p">,</span><span class="n">testdb</span><span class="p">;</span>
<span class="k">SET</span>
<span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="err">\</span><span class="n">d</span>
<span class="w">                  </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w"> </span><span class="k">Schema</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">Name</span><span class="w">           </span><span class="o">|</span><span class="w">   </span><span class="k">Type</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">--------+-------------------------+----------+--------</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_att_view</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_attribute</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_conninfo</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_objmap</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_stats_view</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customers</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customers_id_seq</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders_order_number_seq</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products_id_seq</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">testdb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products_on_hand</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">13</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div></p>
<p>初始快照完成后，如果至少接收并处理了一个后续更改，则连接器阶段应从“初始快照”更改为“更改数据捕获”。
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">;</span>
<span class="w">     </span><span class="n">name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="n">stage</span><span class="w">        </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span>
<span class="w">             </span><span class="n">last_dbz_offset</span>
<span class="c1">---------------+----------------+--------+---------------------+---------+----------+-----------------------------</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="w"> </span><span class="n">sqlserverconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sqlserver</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">526290</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">capture</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;event_serial_no&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="ss">&quot;commit</span>
<span class="ss">_lsn&quot;</span><span class="p">:</span><span class="ss">&quot;0000002b:000004d8:0004&quot;</span><span class="p">,</span><span class="ss">&quot;change_lsn&quot;</span><span class="p">:</span><span class="ss">&quot;0000002b:000004d8:0003&quot;</span><span class="err">}</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span>
</code></pre></div>
这意味着连接器现在正在流式传输指定表的新更改。以“initial”模式重启连接器将从上次成功点开始继续复制，并且不会重新运行初始快照。</p>
<h2 id="zh-tutorial-sqlserver_cdc_to_postgresql-cdc_1">仅初始快照，无CDC<a class="headerlink" href="#zh-tutorial-sqlserver_cdc_to_postgresql-cdc_1" title="Permanent link">&para;</a></h2>
<p>使用“initial_only”模式启动连接器将仅对所有指定表（在本例中为所有表）执行初始快照，之后将不再执行CDC。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial_only&#39;</span><span class="p">);</span>
</code></pre></div>
<p>连接器仍然会显示正在“轮询”，但由于Debzium内部已停止CDC，因此不会捕获任何更改。您可以选择关闭它。以“initial_only”模式重启连接器不会重建表，因为它们已经构建好了。</p>
<h2 id="zh-tutorial-sqlserver_cdc_to_postgresql-cdc_2">仅捕获表模式 + CDC<a class="headerlink" href="#zh-tutorial-sqlserver_cdc_to_postgresql-cdc_2" title="Permanent link">&para;</a></h2>
<p>使用 <code>no_data</code> 模式启动连接器将仅执行模式捕获，在 PostgreSQL 中构建相应的表，并且不会复制现有表数据（跳过初始快照）。模式捕获完成后，连接器将进入 CDC 模式，并开始捕获对表的后续更改。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;no_data&#39;</span><span class="p">);</span>
</code></pre></div>
<p>在 <code>no_data</code> 模式下重新启动连接器将不会再次重建模式，并且它将从上次成功点恢复 CDC。</p>
<h2 id="zh-tutorial-sqlserver_cdc_to_postgresql-cdc_3">仅 CDC<a class="headerlink" href="#zh-tutorial-sqlserver_cdc_to_postgresql-cdc_3" title="Permanent link">&para;</a></h2>
<p>使用 <code>never</code> 模式启动连接器将完全跳过模式捕获和初始快照，并进入 CDC 模式以捕获后续更改。请注意，连接器要求在以 <code>never</code> 模式启动之前，所有捕获表都已在 PostgreSQL 中创建。如果表不存在，连接器在尝试将 CDC 更改应用于不存在的表时将遇到错误。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;never&#39;</span><span class="p">);</span>
</code></pre></div>
<p>以 <code>never</code> 模式重启连接器将从上次成功点开始恢复 CDC。</p>
<h2 id="zh-tutorial-sqlserver_cdc_to_postgresql-cdc_4">始终执行初始快照 + CDC<a class="headerlink" href="#zh-tutorial-sqlserver_cdc_to_postgresql-cdc_4" title="Permanent link">&para;</a></h2>
<p>使用 <code>always</code> 模式启动连接器将始终捕获捕获表的模式，始终重做初始快照，然后转到 CDC。这类似于重置按钮，因为使用此模式将重建所有内容。请谨慎使用此模式，尤其是在捕获大量表时，这可能需要很长时间才能完成。重建后，CDC 将恢复正常。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div>
<p>但是，可以使用连接器的 <code>snapshottable</code> 选项选择部分表来重做初始快照。符合 <code>snapshottable</code> 中条件的表将重做初始快照，否则将跳过其初始快照。如果 <code>snapshottable</code> 为 null 或为空，默认情况下，连接器的 <code>table</code> 选项中指定的所有表将在 <code>always</code> 模式下重做初始快照。</p>
<p>此示例使连接器仅重做 <code>inventory.customers</code> 表的初始快照。所有其他表的快照将被跳过。
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">synchdb_conninfo</span>
<span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonb_set</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{snapshottable}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;inventory.customers&quot;&#39;</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">;</span>
</code></pre></div></p>
<p>初始快照完成后，CDC 将开始。在 <code>always</code> 模式下重新启动连接器将重复上述过程。</p></section><section class="print-page" id="zh-tutorial-oracle_cdc_to_postgresql" heading-number="5.3"><h1 id="zh-tutorial-oracle_cdc_to_postgresql-oracle-cdc-postgresql">Oracle CDC 到 PostgreSQL<a class="headerlink" href="#zh-tutorial-oracle_cdc_to_postgresql-oracle-cdc-postgresql" title="Permanent link">&para;</a></h1>
<h2 id="zh-tutorial-oracle_cdc_to_postgresql-synchdb-oracle">为 SynchDB 准备 Oracle 数据库<a class="headerlink" href="#zh-tutorial-oracle_cdc_to_postgresql-synchdb-oracle" title="Permanent link">&para;</a></h2>
<p>在使用 SynchDB 从 Oracle 复制之前，需要按照<a href="https://docs.synchdb.com/zh/getting-started/remote_database_setups/">此处</a> 概述的步骤配置 Oracle。</p>
<p>请确保 SynchDB 需要复制的每个表的所有列都启用了补充日志数据。这是 SynchDB 正确处理更新和删除操作所必需的。</p>
<p>例如，以下命令为“customer”和“products”表的所有列启用了补充日志数据。请根据需要添加更多表。</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">SUPPLEMENTAL</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="p">(</span><span class="k">ALL</span><span class="p">)</span><span class="w"> </span><span class="n">COLUMNS</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">SUPPLEMENTAL</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="p">(</span><span class="k">ALL</span><span class="p">)</span><span class="w"> </span><span class="n">COLUMNS</span><span class="p">;</span>
<span class="p">...</span><span class="w"> </span><span class="n">etc</span>
</code></pre></div>
<h2 id="zh-tutorial-oracle_cdc_to_postgresql-oracle">创建 Oracle 连接器<a class="headerlink" href="#zh-tutorial-oracle_cdc_to_postgresql-oracle" title="Permanent link">&para;</a></h2>
<p>创建一个连接器，指向 Oracle 中 <code>FREE</code> 数据库下的所有表。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="mi">1521</span><span class="p">,</span>
<span class="s1">&#39;c##dbzuser&#39;</span><span class="p">,</span><span class="s1">&#39;dbz&#39;</span><span class="p">,</span><span class="s1">&#39;FREE&#39;</span><span class="p">,</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="s1">&#39;oracle&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-tutorial-oracle_cdc_to_postgresql-cdc">初始快照 + CDC<a class="headerlink" href="#zh-tutorial-oracle_cdc_to_postgresql-cdc" title="Permanent link">&para;</a></h2>
<p>使用 <code>initial</code> 模式启动连接器将对所有指定表（在本例中为全部）执行初始快照。完成后，变更数据捕获 (CDC) 进程将开始流式传输新的变更。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial&#39;</span><span class="p">);</span>

<span class="err">或</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">);</span>
</code></pre></div>
<p>此连接器首次运行时，其阶段应处于 <code>initial snapper</code> 状态：
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="n">stage</span><span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span><span class="w">       </span><span class="n">last_dbz_offset</span>
<span class="c1">------------+----------------+--------+------------------+---------+----------+-----------------------------</span>
<span class="w"> </span><span class="n">oracleconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">oracle</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">528146</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">flushed</span><span class="w"> </span><span class="n">yet</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div></p>
<p>将创建一个名为“inventory”的新模式，并且连接器流式传输的所有表都将在该模式下复制。
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">search_path</span><span class="o">=</span><span class="k">public</span><span class="p">,</span><span class="k">free</span><span class="p">;</span>
<span class="k">SET</span>
<span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="err">\</span><span class="n">d</span>
<span class="w">              </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w"> </span><span class="k">Schema</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="n">Name</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">--------+--------------------+-------+--------</span>
<span class="w"> </span><span class="k">free</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_att_view</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_attribute</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_conninfo</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_objmap</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_stats_view</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
初始快照完成后，如果至少接收并处理了一个后续更改，则连接器阶段应从“初始快照”更改为“更改数据捕获”。
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="n">stage</span><span class="w">        </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span><span class="w">    </span><span class="o">|</span>
<span class="w">    </span><span class="n">last_dbz_offset</span>
<span class="c1">------------+----------------+--------+---------------------+---------+----------+-------------------------------</span>
<span class="c1">-------------------------------------------------------</span>
<span class="w"> </span><span class="n">oracleconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">oracle</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">528414</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">capture</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;commit_scn&quot;</span><span class="p">:</span><span class="ss">&quot;3118146:1:02001</span>
<span class="ss">f00c0020000&quot;</span><span class="p">,</span><span class="ss">&quot;snapshot_scn&quot;</span><span class="p">:</span><span class="ss">&quot;3081987&quot;</span><span class="p">,</span><span class="ss">&quot;scn&quot;</span><span class="p">:</span><span class="ss">&quot;3118125&quot;</span><span class="err">}</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div>
这意味着连接器现在正在流式传输指定表的新更改。以“initial”模式重启连接器将从上次成功点开始继续复制，并且不会重新运行初始快照。</p>
<h2 id="zh-tutorial-oracle_cdc_to_postgresql-cdc_1">仅初始快照，无CDC<a class="headerlink" href="#zh-tutorial-oracle_cdc_to_postgresql-cdc_1" title="Permanent link">&para;</a></h2>
<p>使用“initial_only”模式启动连接器将仅对所有指定表（在本例中为所有表）执行初始快照，之后将不再执行CDC。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial_only&#39;</span><span class="p">);</span>
</code></pre></div>
<p>连接器仍然会显示正在“轮询”，但由于Debzium内部已停止CDC，因此不会捕获任何更改。您可以选择关闭它。以“initial_only”模式重启连接器不会重建表，因为它们已经构建好了。</p>
<h2 id="zh-tutorial-oracle_cdc_to_postgresql-cdc_2">仅捕获表模式 + CDC<a class="headerlink" href="#zh-tutorial-oracle_cdc_to_postgresql-cdc_2" title="Permanent link">&para;</a></h2>
<p>使用 <code>no_data</code> 模式启动连接器将仅执行模式捕获，在 PostgreSQL 中构建相应的表，并且不会复制现有表数据（跳过初始快照）。模式捕获完成后，连接器将进入 CDC 模式，并开始捕获对表的后续更改。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;no_data&#39;</span><span class="p">);</span>
</code></pre></div>
<p>在 <code>no_data</code> 模式下重新启动连接器将不会再次重建模式，并且它将从上次成功点恢复 CDC。</p>
<h2 id="zh-tutorial-oracle_cdc_to_postgresql-cdc_3">仅 CDC<a class="headerlink" href="#zh-tutorial-oracle_cdc_to_postgresql-cdc_3" title="Permanent link">&para;</a></h2>
<p>使用 <code>never</code> 模式启动连接器将完全跳过模式捕获和初始快照，并进入 CDC 模式以捕获后续更改。请注意，连接器要求在以 <code>never</code> 模式启动之前，所有捕获表都已在 PostgreSQL 中创建。如果表不存在，连接器在尝试将 CDC 更改应用于不存在的表时将遇到错误。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;never&#39;</span><span class="p">);</span>
</code></pre></div>
<p>以 <code>never</code> 模式重启连接器将从上次成功点开始恢复 CDC。</p>
<h2 id="zh-tutorial-oracle_cdc_to_postgresql-cdc_4">始终执行初始快照 + CDC<a class="headerlink" href="#zh-tutorial-oracle_cdc_to_postgresql-cdc_4" title="Permanent link">&para;</a></h2>
<p>使用 <code>always</code> 模式启动连接器将始终捕获捕获表的模式，始终重做初始快照，然后转到 CDC。这类似于重置按钮，因为使用此模式将重建所有内容。请谨慎使用此模式，尤其是在捕获大量表时，这可能需要很长时间才能完成。重建后，CDC 将恢复正常。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div>
<p>但是，可以使用连接器的 <code>snapshottable</code> 选项选择部分表来重做初始快照。符合 <code>snapshottable</code> 中条件的表将重做初始快照，否则将跳过其初始快照。如果 <code>snapshottable</code> 为 null 或为空，默认情况下，连接器的 <code>table</code> 选项中指定的所有表将在 <code>always</code> 模式下重做初始快照。</p>
<p>此示例使连接器仅重做 <code>inventory.customers</code> 表的初始快照。所有其他表的快照将被跳过。
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">synchdb_conninfo</span>
<span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonb_set</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{snapshottable}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;free.customers&quot;&#39;</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;oracleconn&#39;</span><span class="p">;</span>
</code></pre></div></p>
<p>初始快照完成后，持续数据捕获 (CDC) 将开始。在 <code>always</code> 模式下重新启动连接器将重复上述过程。</p></section><section class="print-page" id="zh-tutorial-selective_table_sync" heading-number="5.4"><h1 id="zh-tutorial-selective_table_sync-_1">选择性表同步<a class="headerlink" href="#zh-tutorial-selective_table_sync-_1" title="Permanent link">&para;</a></h1>
<p>可以从远程异构数据库中仅选择特定表进行同步，从而避免将资源浪费在复制不需要的表上。</p>
<h2 id="zh-tutorial-selective_table_sync-_2"><strong>选择所需表并首次启动</strong><a class="headerlink" href="#zh-tutorial-selective_table_sync-_2" title="Permanent link">&para;</a></h2>
<p>表的选择是在连接器创建阶段通过 <code>synchdb_add_conninfo()</code> 完成的，我们指定一个要从中复制的表列表（以 FQN 表示，以逗号分隔）。</p>
<p>例如，以下命令创建一个连接器，该连接器仅从远程 MySQL 数据库的 <code>inventory.orders</code> 和 <code>inventory.products</code> 表复制更改。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;192.168.1.86&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="mi">3306</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;mysqluser&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;mysqlpwd&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;inventory.orders,inventory.products&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span>
<span class="w">    </span><span class="s1">&#39;mysql&#39;</span>
<span class="p">);</span>
</code></pre></div></p>
<p>首次启动此连接器将触发执行初始快照，并将复制选定的 2 个表的模式和数据。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div>
<h3 id="zh-tutorial-selective_table_sync-_3"><strong>验证连接器状态和表</strong><a class="headerlink" href="#zh-tutorial-selective_table_sync-_3" title="Permanent link">&para;</a></h3>
<p>检查连接器状态和新表：
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">Select</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">state</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>
<span class="w">     </span><span class="n">name</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="k">state</span><span class="w">  </span><span class="o">|</span><span class="w">   </span><span class="n">err</span>
<span class="c1">---------------+---------+----------</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">error</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>

<span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">inventory</span><span class="p">;</span>
<span class="k">SET</span>
<span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="err">\</span><span class="n">d</span>
<span class="w">                 </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w">  </span><span class="k">Schema</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="n">Name</span><span class="w">        </span><span class="o">|</span><span class="w">   </span><span class="k">Type</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">-----------+--------------------+----------+--------</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products_id_seq</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders_ididid_seq</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_conninfo</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>

<span class="n">postgres</span><span class="o">=#</span>
</code></pre></div></p>
<p>快照完成后，<code>mysqlconn</code> 连接器将继续捕获 <code>inventory.orders</code> 和 <code>inventory.products</code> 表的后续更改。</p>
<h2 id="zh-tutorial-selective_table_sync-_4"><strong>在运行时添加更多要复制的表</strong><a class="headerlink" href="#zh-tutorial-selective_table_sync-_4" title="Permanent link">&para;</a></h2>
<p>上一节中的 <code>mysqlconn</code> 已经完成了初始快照，并获取了所选表的表结构。如果我们想要添加更多要复制的表，则需要将更新的表部分通知给 Debezium 引擎，并再次执行初始快照。操作方法如下：</p>
<ol>
<li>更新 <code>synchdb_conninfo</code> 表以包含其他表。</li>
<li>在此示例中，我们将 <code>inventory.customers</code> 表添加到同步列表：
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">synchdb_conninfo</span>
<span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonb_set</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{table}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;inventory.orders,inventory.products,inventory.customers&quot;&#39;</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">;</span>
</code></pre></div></li>
<li>配置快照表参数，使其仅包含新表 <code>inventory.customers</code>，这样 SynchDB 就不会尝试重建已完成快照的两张表。
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">synchdb_conninfo</span>
<span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonb_set</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{snapshottable}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;inventory.customers&quot;&#39;</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">;</span>
</code></pre></div></li>
<li>重启连接器，并将快照模式设置为 <code>always</code>，以执行另一次初始快照：
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_restart_connector</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div>
这将强制 Debezium 仅对新表 <code>inventory.customers</code> 重新创建快照，同时保留旧表 <code>inventory.orders</code> 和 <code>inventory.products</code> 不变。快照完成后，所有表的 CDC 将恢复。</li>
</ol>
<h3 id="zh-tutorial-selective_table_sync-_5"><strong>验证更新后的表</strong><a class="headerlink" href="#zh-tutorial-selective_table_sync-_5" title="Permanent link">&para;</a></h3>
<p>现在，我们可以再次检查这些表：
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">inventory</span><span class="p">;</span>
<span class="k">SET</span>
<span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="err">\</span><span class="n">d</span>
<span class="w">                 </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">relations</span>
<span class="w">  </span><span class="k">Schema</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="n">Name</span><span class="w">        </span><span class="o">|</span><span class="w">   </span><span class="k">Type</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Owner</span>
<span class="c1">-----------+--------------------+----------+--------</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">products_id_seq</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">orders_ididid_seq</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customers</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customers_id_seq</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_conninfo</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="w"> </span><span class="k">public</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ubuntu</span>
<span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>

<span class="n">postgres</span><span class="o">=#</span>
</code></pre></div></p>
<h2 id="zh-tutorial-selective_table_sync-_6"><strong>快照模式</strong><a class="headerlink" href="#zh-tutorial-selective_table_sync-_6" title="Permanent link">&para;</a></h2>
<p>SynchDB 提供不同的快照模式，具体取决于您的复制需求：</p>
<table>
<thead>
<tr>
<th style="text-align: center;"><strong>设置</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">always</td>
<td>连接器每次启动时都会执行快照。快照包含已捕获表的结构和数据。快照完成后，连接器开始流式传输后续数据库更改的事件记录。</td>
</tr>
<tr>
<td style="text-align: center;">initial（默认）</td>
<td>如果尚未执行，连接器将执行数据库快照。快照完成后，连接器开始流式传输后续数据库更改的事件记录。</td>
</tr>
<tr>
<td style="text-align: center;">initial_only</td>
<td>连接器执行数据库快照。快照完成后，连接器将停止，并且不会流式传输后续数据库更改的事件记录。</td>
</tr>
<tr>
<td style="text-align: center;">no_data</td>
<td>连接器捕获所有相关表的结构，但不捕获它们包含的数据。</td>
</tr>
<tr>
<td style="text-align: center;">never</td>
<td>连接器启动时，它会立即开始流式传输后续数据库更改的事件记录，而不是执行快照。</td>
</tr>
<tr>
<td style="text-align: center;">recovery</td>
<td>设置此选项可恢复丢失或损坏的数据库架构历史记录。重启后，连接器将运行快照，从源表重建主题</td>
</tr>
<tr>
<td style="text-align: center;">when_needed</td>
<td>连接器启动后，仅当检测到以下情况之一时才执行快照：<br><ul><li>无法检测到任何主题偏移量</li><li>先前记录的偏移量指定的日志位置在服务器上不可用</li></ul></td>
</tr>
</tbody>
</table></section><section class="print-page" id="zh-tutorial-table_snapshot_resnapshot" heading-number="5.5"><h1 id="zh-tutorial-table_snapshot_resnapshot-_1">表快照和重新快照<a class="headerlink" href="#zh-tutorial-table_snapshot_resnapshot-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-tutorial-table_snapshot_resnapshot-_2">初始快照<a class="headerlink" href="#zh-tutorial-table_snapshot_resnapshot-_2" title="Permanent link">&para;</a></h2>
<p>SynchDB 中的“初始快照”（或表快照）是指复制所有指定表的表结构和初始数据。这类似于 PostgreSQL 逻辑复制中的“表同步”。当使用默认“initial”模式启动连接器时，它将在进入变更数据捕获 (CDC) 阶段之前自动执行初始快照。可以使用“never”模式完全省略此操作，或使用“no_data”模式部分省略此操作。有关所有快照选项，请参阅<a href="https://docs.synchdb.com/zh/user-guide/start_stop_connector/">此处</a>。</p>
<p>初始快照完成后，连接器在后续重启时将不再执行此操作，而是从上次未完成的偏移量开始继续执行 CDC。此行为由 Debezium 引擎管理的元数据文件控制。有关元数据文件的更多信息，请参阅<a href="https://docs.synchdb.com/zh/architecture/metadata_files/">此处</a>。</p>
<h2 id="zh-tutorial-table_snapshot_resnapshot-_3">重新快照<a class="headerlink" href="#zh-tutorial-table_snapshot_resnapshot-_3" title="Permanent link">&para;</a></h2>
<p>如果出于任何原因，用户需要再次执行初始快照以重建“所有指定的表”和所有初始数据，我们需要使用“始终”快照模式，这会导致连接器在启动时再次获取架构和初始数据。您可能需要删除所有指定的表或清除其中的所有数据，然后 SynchDB 才会尝试重新创建表并填充初始数据（这些数据可能已经存在）。</p>
<p>请谨慎操作，因为在您的设置中执行此操作可能过于激进。更好的替代方案是使用选择性快照，在“始终”快照模式下，仅对选定的表进行重新快照。请参见下文。</p>
<h2 id="zh-tutorial-table_snapshot_resnapshot-_4">选择性快照<a class="headerlink" href="#zh-tutorial-table_snapshot_resnapshot-_4" title="Permanent link">&para;</a></h2>
<p>可以在运行时创建或更改连接器时配置选择性快照。这可以通过在“快照表”参数中指定要执行快照的表列表来实现。例如：</p>
<p><strong>创建期间：</strong>
此示例创建一个连接器，该连接器对 <code>inventory.orders</code>、<code>inventory.customers</code> 和 <code>invnetory.produts</code> 表执行 CDC，但如果连接器以 <code>always</code> 快照模式启动，则只会对 <code>inventory.products</code> 再次执行初始快照。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="mi">3306</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;mysqluser&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;mysqlpwd&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;inventory.orders,inventory.customers,invnetory.produts&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;inventory.products&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div>
<p><strong>修改现有连接器：</strong>
此示例将 <code>inventory.products</code> 设置为快照表字段。以 <code>always</code> 模式启动时，只有 <code>inventory.products</code> 表会重新创建快照。</p>
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">synchdb_conninfo</span>
<span class="w">    </span><span class="k">SET</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonb_set</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{snapshottable}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;inventory.products&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div></section><section class="print-page" id="zh-tutorial-object_mapping_workflow" heading-number="5.6"><h1 id="zh-tutorial-object_mapping_workflow-_1">对象映射工作流程<a class="headerlink" href="#zh-tutorial-object_mapping_workflow-_1" title="Permanent link">&para;</a></h1>
<p>SynchDB 具有默认名称和数据类型映射规则来处理传入的更改事件。在大多数情况下，默认规则都可以正常工作。但是，如果您有特定的转换要求，或者默认规则不适合您，则可以将自己的对象映射规则配置到特定连接器。请按照以下工作流程查看和调整任何特定的对象映射规则。</p>
<h2 id="zh-tutorial-object_mapping_workflow-schemasync"><strong>创建连接器并以 <code>schemasync</code> 模式启动它</strong><a class="headerlink" href="#zh-tutorial-object_mapping_workflow-schemasync" title="Permanent link">&para;</a></h2>
<p><code>schemasync</code> 是一种特殊模式，它使连接器连接到远程数据库并尝试仅同步指定表的架构。完成此操作后，连接器将处于 <code>暂停</code> 状态，用户可以查看使用默认规则创建的所有表和数据类型，并在需要时进行更改。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="mi">3306</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;mysqluser&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;mysqlpwd&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;schemasync&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-tutorial-object_mapping_workflow-_2"><strong>确保连接器处于暂停状态</strong><a class="headerlink" href="#zh-tutorial-object_mapping_workflow-_2" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">connector_type</span><span class="p">,</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">stage</span><span class="p">,</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>
<span class="w">     </span><span class="n">name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">connector_type</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">pid</span><span class="w">   </span><span class="o">|</span><span class="w">    </span><span class="n">stage</span><span class="w">    </span><span class="o">|</span><span class="w">  </span><span class="k">state</span>
<span class="c1">---------------+----------------+--------+-------------+---------</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">579845</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="n">sync</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">polling</span>
</code></pre></div>
<h2 id="zh-tutorial-object_mapping_workflow-_3"><strong>查看默认创建的表的映射规则</strong><a class="headerlink" href="#zh-tutorial-object_mapping_workflow-_3" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_att_view</span><span class="p">;</span>
<span class="w">   </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">attnum</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">ext_tbname</span><span class="w">         </span><span class="o">|</span><span class="w">         </span><span class="n">pg_tbname</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">ext_attname</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">pg_attname</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">ext_atttypename</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">pg_atttypename</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">transform</span>
<span class="c1">-----------+-------+--------+----------------------------+----------------------------+-------------+-------------+-----------------+----------------+-----------</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">street</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">street</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">state</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">state</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">zip</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">zip</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">ENUM</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">first_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">first_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">last_name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">last_name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">email</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">email</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">g</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">g</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">h</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">h</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nb">FLOAT</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">float4</span><span class="w">         </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="p">(</span><span class="mi">20</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<h2 id="zh-tutorial-object_mapping_workflow-_4"><strong>定义自定义映射规则</strong><a class="headerlink" href="#zh-tutorial-object_mapping_workflow-_4" title="Permanent link">&para;</a></h2>
<p>用户可以使用<code>synchdb_add_objmap</code>函数创建自定义映射规则。它可用于映射表名、列名、数据类型并定义数据转换表达式规则</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;table&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.products&#39;</span><span class="p">,</span><span class="s1">&#39;stuff&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;table&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.customers&#39;</span><span class="p">,</span><span class="s1">&#39;schema1.people&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;column&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.customers.last_name&#39;</span><span class="p">,</span><span class="s1">&#39;family_name&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;column&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.customers.email&#39;</span><span class="p">,</span><span class="s1">&#39;contact&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;datatype&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.geom.g&#39;</span><span class="p">,</span><span class="s1">&#39;geometry|0&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;datatype&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.orders.quantity&#39;</span><span class="p">,</span><span class="s1">&#39;bigint|0&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.products.name&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;&#39;&gt;&gt;&gt;&gt;&gt;&#39;&#39; || &#39;&#39;%d&#39;&#39; || &#39;&#39;&lt;&lt;&lt;&lt;&lt;&#39;&#39;&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-tutorial-object_mapping_workflow-_5"><strong>审查迄今为止创建的所有对象映射规则</strong><a class="headerlink" href="#zh-tutorial-object_mapping_workflow-_5" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_objmap</span><span class="p">;</span>
<span class="w">   </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w">  </span><span class="n">objtype</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="n">srcobj</span><span class="w">             </span><span class="o">|</span><span class="w">           </span><span class="n">dstobj</span>
<span class="c1">-----------+-----------+---------+-------------------------------+----------------------------</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">stuff</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">column</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="p">.</span><span class="n">last_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">family_name</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">column</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="p">.</span><span class="n">email</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">contact</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">transform</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="p">.</span><span class="n">name</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;%d&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&lt;&lt;&lt;&lt;&lt;&#39;</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">datatype</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="p">.</span><span class="k">g</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">geometry</span><span class="o">|</span><span class="mi">0</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">datatype</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">orders</span><span class="p">.</span><span class="n">quantity</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nb">bigint</span><span class="o">|</span><span class="mi">0</span>
<span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
</code></pre></div>
<h2 id="zh-tutorial-object_mapping_workflow-_6"><strong>重新加载对象映射规则</strong><a class="headerlink" href="#zh-tutorial-object_mapping_workflow-_6" title="Permanent link">&para;</a></h2>
<p>一旦定义了所有自定义规则，我们就需要向连接器发出信号来加载它们。这将导致连接器读取并应用对象映射规则。如果它发现当前 PostgreSQL 值与对象映射值之间存在差异，它将尝试更正映射。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_reload_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-tutorial-object_mapping_workflow-synchdb_att_view"><strong>再次检查 <code>synchdb_att_view</code> 是否有变化</strong><a class="headerlink" href="#zh-tutorial-object_mapping_workflow-synchdb_att_view" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_att_view</span><span class="p">;</span>
<span class="w">   </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">attnum</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">ext_tbname</span><span class="w">         </span><span class="o">|</span><span class="w">         </span><span class="n">pg_tbname</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">ext_attname</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">pg_attname</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">ext_atttypename</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">pg_atttypename</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="k">transform</span>
<span class="c1">-----------+-------+--------+----------------------------+----------------------------+-------------+-------------+-----------------+----------------+----------------------------</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">street</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">street</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">city</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">state</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">state</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">zip</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">zip</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">addresses</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">ENUM</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">first_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">first_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">last_name</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">family_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">customers</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">schema1</span><span class="p">.</span><span class="n">people</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">email</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">contact</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">g</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">g</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">geometry</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">geom</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">h</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">h</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">stuff</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">stuff</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;%d&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&lt;&lt;&lt;&lt;&lt;&#39;</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">stuff</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">varchar</span><span class="w">        </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">public</span><span class="p">.</span><span class="n">stuff</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nb">FLOAT</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">float4</span><span class="w">         </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">product_id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">int4</span><span class="w">           </span><span class="o">|</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">inventory</span><span class="p">.</span><span class="n">products_on_hand</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">quantity</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nb">INT</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nb">int8</span><span class="w">           </span><span class="o">|</span>
</code></pre></div>
<h2 id="zh-tutorial-object_mapping_workflow-_7"><strong>恢复连接器或重做整个快照</strong><a class="headerlink" href="#zh-tutorial-object_mapping_workflow-_7" title="Permanent link">&para;</a></h2>
<p>一旦确认对象映射正确，我们就可以恢复连接器。请注意，恢复只会继续流式传输新的表更改。不会复制表的现有数据。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_resume_engine</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>要捕获表的现有数据，我们还可以使用新的对象映射规则重做整个快照：
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_restart_connector</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div></p></section></section>
                    <section class='print-page md-section' id='section-6' heading-number='6'>
                        <h1>用户指南<a class='headerlink' href='#section-6' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="zh-user-guide-create_a_connector" heading-number="6.1"><h1 id="zh-user-guide-create_a_connector-_1">创建连接器<a class="headerlink" href="#zh-user-guide-create_a_connector-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-user-guide-create_a_connector-_2"><strong>创建连接器</strong><a class="headerlink" href="#zh-user-guide-create_a_connector-_2" title="Permanent link">&para;</a></h2>
<p>连接器代表与特定源数据库的连接，复制一组表并应用于 PostgreSQL。如果您有多个需要复制的源数据库，则需要多个连接器（每个连接器一个）。也可以创建多个连接到同一源数据库但复制不同表集的连接器。</p>
<p>可以使用实用 SQL 函数 <code>synchdb_add_conninfo()</code> 创建连接器。</p>
<p>synchdb_add_conninfo 接受以下参数：</p>
<table>
<thead>
<tr>
<th>argumet</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>表示此连接器信息的唯一标识符</td>
</tr>
<tr>
<td>hostname</td>
<td>异构数据库的 IP 地址或主机名。</td>
</tr>
<tr>
<td>port</td>
<td>连接到异构数据库的端口号。</td>
</tr>
<tr>
<td>username</td>
<td>用于与异构数据库进行身份验证的用户名。</td>
</tr>
<tr>
<td>password</td>
<td>用于验证用户名的密码</td>
</tr>
<tr>
<td>源数据库</td>
<td>这是我们要从中复制更改的异构数据库中的源数据库的名称。</td>
</tr>
<tr>
<td>目标数据库</td>
<td>（已弃用）始终默认使用与 synchDB 安装位置相同的数据库</td>
</tr>
<tr>
<td>表</td>
<td>（可选）- 以 <code>[database].[table]</code> 或 <code>[database].[schema].[table]</code> 的形式表示，该参数必须存在于异构数据库中，因此引擎将仅复制指定的表。如果留空，则复制所有表。或者，可以使用 <code>file:</code> 前缀指定表列表文件</td>
</tr>
<tr>
<td>快照表</td>
<td>（可选）- 以 <code>[database].[table]</code> 或 <code>[database].[schema].[table]</code> 的形式表示，该参数必须存在于上述 <code>table</code> 设置中，因此引擎仅在快照模式设置为 <code>always</code> 时才会重建这些表的快照。如果留空或为 null，则当快照模式设置为 <code>always</code> 时，将重建上述 <code>table</code> 设置中指定的所有表。或者，可以使用 <code>file:</code> 前缀指定快照表列表文件</td>
</tr>
<tr>
<td>连接器</td>
<td>要使用的连接器类型（如下）。</td>
</tr>
</tbody>
</table>
<p>&lt;&lt;<strong>注意</strong>&gt;&gt; 如果連接器類型為“olr”，SynchDB 仍將使用 Debezium 執行初始快照，初始快照包含“table”和“snapshot table”參數中指定的表和快照表。完成後，SynchDB 將連接到 Openlog Replicator 進行複製，而不會過濾「table」參數中指定的所需表。表過濾是在 Openlog Replicator 的配置中完成的。因此，請確保 Openlog Replicator 和 SynchDB 連接器的「table」過濾參數配置一致，以避免潛在的差異。</p>
<h2 id="zh-user-guide-create_a_connector-_3"><strong>连接器类型</strong><a class="headerlink" href="#zh-user-guide-create_a_connector-_3" title="Permanent link">&para;</a></h2>
<p>SynchDb 支持以下连接器类型：</p>
<ul>
<li>mysql -&gt; MySQL 数据库</li>
<li>sqlserver -&gt; Microsoft SQL Server 数据库</li>
<li>oracle -&gt; Oracle 数据库</li>
<li>olr -&gt; 原生 Openlog Replicator (BETA)</li>
</ul>
<h2 id="zh-user-guide-create_a_connector-_4"><strong>检查已创建的连接器</strong><a class="headerlink" href="#zh-user-guide-create_a_connector-_4" title="Permanent link">&para;</a></h2>
<p>已创建的连接器显示在 <code>synchdb_conninfo</code> 表中。我们可以查看其内容并根据需要进行修改。请注意，用户凭证的密码由 pgcrypto 使用只有 synchdb 知道的密钥加密。因此，请勿直接修改密码字段，因为如果被篡改，可能会被错误解密。以下是示例输出：</p>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="err">\</span><span class="n">x</span>
<span class="n">Expanded</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">on</span><span class="p">.</span>

<span class="n">postgres</span><span class="o">=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_conninfo</span><span class="p">;</span>
<span class="o">-</span><span class="p">[</span><span class="w"> </span><span class="n">RECORD</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="c1">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="n">name</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">sqlserverconn</span>
<span class="n">isactive</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">t</span>
<span class="k">data</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;pwd&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;\\xc30d0407030245ca4a983b6304c079d23a0191c6dabc1683e4f66fc538db65b9ab2788257762438961f8201e6bcefafa60460fbf441e55d844e7f27b31745f04e7251c0123a159540676c4&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1433</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;sa&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;dstdb&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;postgres&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;srcdb&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;testDB&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;null&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.1.86&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;connector&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;sqlserver&quot;</span><span class="err">}</span>
<span class="o">-</span><span class="p">[</span><span class="w"> </span><span class="n">RECORD</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">]</span><span class="c1">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="n">name</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">mysqlconn</span>
<span class="n">isactive</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">t</span>
<span class="k">data</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;pwd&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;\\xc30d04070302986aff858065e96b62d23901b418a1f0bfdf874ea9143ec096cd648a1588090ee840de58fb6ba5a04c6430d8fe7f7d466b70a930597d48b8d31e736e77032cb34c86354e&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3306</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;mysqluser&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;dstdb&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;postgres&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;srcdb&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;inventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;null&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.1.86&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;connector&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;mysql&quot;</span><span class="err">}</span>
<span class="o">-</span><span class="p">[</span><span class="w"> </span><span class="n">RECORD</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">]</span><span class="c1">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="n">name</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">oracleconn</span>
<span class="n">isactive</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">t</span>
<span class="k">data</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;pwd&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;\\xc30d04070302e3baf1293d0d553066d234014f6fc52e6eea425884b1f65f1955bf504b85062dfe538ca2e22bfd6db9916662406fc45a3a530b7bf43ce4cfaa2b049a1c9af8&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1528</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;c##dbzuser&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;dstdb&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;postgres&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;srcdb&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;FREE&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;null&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.1.86&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;connector&quot;</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;oracle&quot;</span><span class="err">}</span>
</code></pre></div>
<p>&lt;&lt;&lt;<strong>重要</strong>&gt;&gt;&gt; 本机 Openlog Replicator 连接器当前不支持通过“table”和“snapshot table”参数指定白名单表，因此以下部分不适用于本机 Openlog Replicator 连接器。</p>
<h2 id="zh-user-guide-create_a_connector-_5"><strong>使用表列表文件指定表</strong><a class="headerlink" href="#zh-user-guide-create_a_connector-_5" title="Permanent link">&para;</a></h2>
<p>如果要复制大量表，可以使用表列表文件来指定表。该列表必须采用 JSON 格式，如下所示：</p>
<div class="highlight"><pre><span></span><code>{
    &quot;table_list&quot;:
    [
        &quot;mydb.myschema.mytable1&quot;,
        &quot;mydb.myschema.mytable2&quot;,
        ...
        ...
    ],
    &quot;snapshot_table_list&quot;:
    [
        &quot;mydb.myschema.mytable1&quot;,
        &quot;mydb.myschema.mytable2&quot;,
        ...
        ...
    ]
}
</code></pre></div>
<p>SynchDB 通过名称查找以下关键 JSON 数组：
* <code>table_list</code> 是一个 JSON 数组，包含以字符串形式表示的待复制表。当 <code>table</code> 参数以前缀 <code>file:</code> 开头，后跟文件路径时，此参数为必填项。
* <code>snapshot_table_list</code> 也是一个 JSON 数组，包含要执行快照的表。当 <code>snapshot table</code> 参数以前缀 <code>file:</code> 开头，后跟文件路径时，此参数为必填项。</p>
<p>文件路径可以是相对于 PostgreSQL 数据目录的相对路径，也可以是绝对路径。</p>
<h2 id="zh-user-guide-create_a_connector-_6"><strong>何时指定快照表列表？</strong><a class="headerlink" href="#zh-user-guide-create_a_connector-_6" title="Permanent link">&para;</a></h2>
<p>通常，我们可以将 <code>snapshot table list</code> 参数留空或保留为 <code>null</code>，后者默认与 <code>table</code> 参数的值相同。这意味着 SynchDB 将在需要时对 <code>table</code> 参数中指定的所有表执行初始快照（复制架构并复制初始数据）。在某些情况下，我们可能只希望对“表”的子集执行初始快照。如果是这种情况，我们可以设置不同的“快照表列表”，指示 SynchDB 仅重建指定的表快照。</p>
<h2 id="zh-user-guide-create_a_connector-_7"><strong>示例：为每个支持的源数据库创建一个连接器以复制所有表</strong><a class="headerlink" href="#zh-user-guide-create_a_connector-_7" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>创建一个名为“mysqlconn”的 MySQL 连接器，将 MySQL 中“inventory”下的所有表复制到 PostgreSQL 中目标数据库“postgres”：
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3306</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mysqluser&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;mysqlpwd&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
</code></pre></div></p>
</li>
<li>
<p>创建一个名为“sqlserverconn”的SQLServer连接器，将“testDB”下的所有表复制到PostgreSQL中的目标数据库“postgres”：
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">  </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;sqlserverconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1433</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;sa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Password!&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;testDB&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sqlserver&#39;</span><span class="p">);</span>
</code></pre></div></p>
</li>
<li>
<p>创建一个名为“oracleconn”的 Oracle 连接器，将“FREE”下的所有表复制到 PostgreSQL 中的目标数据库“postgres”：
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">  </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1521</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;c##dbzuser&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dbz&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;FREE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;oracle&#39;</span><span class="p">);</span>
</code></pre></div></p>
</li>
</ol>
<h2 id="zh-user-guide-create_a_connector-_8"><strong>示例：创建连接器以复制指定的表</strong><a class="headerlink" href="#zh-user-guide-create_a_connector-_8" title="Permanent link">&para;</a></h2>
<p>请注意，表必须使用完全限定名称（例如“[database].[table]”或“[database].[schema].[table]”）指定，并且必须存在于源数据库中。</p>
<p>创建一个名为“mysqlconn”的 MySQL 连接器，将 MySQL 中“inventory”下的“orders”和“customers”表复制到 PostgreSQL 中的目标数据库“postgres”：
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3306</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mysqluser&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;mysqlpwd&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;inventory.orders,inventory.customers&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;null&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-user-guide-create_a_connector-_9"><strong>示例：创建连接器以使用文件复制指定的表</strong><a class="headerlink" href="#zh-user-guide-create_a_connector-_9" title="Permanent link">&para;</a></h2>
<p>创建一个名为“mysqlconn”的 MySQL 连接器，将 MySQL 中“inventory”下表文件中指定的表复制到 PostgreSQL 中的目标数据库“postgres”：
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3306</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mysqluser&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;mysqlpwd&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;inventory&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;file:/path/to/mytablefile.json&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;file:/path/to/mytablefile.json&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mysql&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>其中 <code>/path/to/mytablefile.json</code> 可以是：
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;table_list&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;inventory.orders&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;inventory.customers&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;snapshot_table_list&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;inventory.orders&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;inventory.customers&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p></section><section class="print-page" id="zh-user-guide-start_stop_connector" heading-number="6.2"><h1 id="zh-user-guide-start_stop_connector-_1">启动/停止连接器<a class="headerlink" href="#zh-user-guide-start_stop_connector-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-user-guide-start_stop_connector-_2"><strong>控制连接器</strong><a class="headerlink" href="#zh-user-guide-start_stop_connector-_2" title="Permanent link">&para;</a></h2>
<p>SynchDB 提供了几个实用函数来控制已创建连接器的行为和生命周期。</p>
<h2 id="zh-user-guide-start_stop_connector-_3"><strong>以默认快照模式启动连接器</strong><a class="headerlink" href="#zh-user-guide-start_stop_connector-_3" title="Permanent link">&para;</a></h2>
<p>synchdb_start_engine_bgw() 可用于以名为“initial”的默认快照模式启动连接器。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-user-guide-start_stop_connector-_4"><strong>以自定义快照模式启动连接器</strong><a class="headerlink" href="#zh-user-guide-start_stop_connector-_4" title="Permanent link">&para;</a></h2>
<p>使用相同的函数 synchdb_start_engine_bgw()，可以包含快照模式来启动连接器，否则将默认使用“initial”模式。</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- 捕获表结构并继续流式传输新的更改</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;no_data&#39;</span><span class="p">);</span>

<span class="c1">-- 始终重建表结构和现有数据，并继续流式传输新的更改</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-user-guide-start_stop_connector-_5"><strong>支持的快照模式</strong><a class="headerlink" href="#zh-user-guide-start_stop_connector-_5" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th style="text-align: center;">模式</th>
<th>描述</th>
<th>用例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>always</code></td>
<td>每次启动时都进行完整快照</td>
<td>完成数据验证</td>
</tr>
<tr>
<td style="text-align: center;"><code>initial</code></td>
<td>仅限首次快照</td>
<td>正常操作</td>
</tr>
<tr>
<td style="text-align: center;"><code>initial_only</code></td>
<td>一次性快照，然后停止</td>
<td>数据迁移</td>
</tr>
<tr>
<td style="text-align: center;"><code>no_data</code></td>
<td>仅结构，无数据</td>
<td>结构同步</td>
</tr>
<tr>
<td style="text-align: center;"><code>never</code></td>
<td>跳过快照，仅流式传输</td>
<td>实时更新</td>
</tr>
<tr>
<td style="text-align: center;"><code>recovery</code></td>
<td>从源重建</td>
<td>灾难恢复</td>
</tr>
<tr>
<td style="text-align: center;"><code>when_needed</code></td>
<td>条件快照</td>
<td>自动恢复</td>
</tr>
<tr>
<td style="text-align: center;"><code>schemasync</code></td>
<td>仅结构，无数据，无 CDC</td>
<td>正常操作</td>
</tr>
</tbody>
</table>
<p><strong>请参阅<a href="https://docs.synchdb.com/zh/tutorial/selective_table_sync/">教程</a>，了解何时使用何种模式</strong></p>
<h2 id="zh-user-guide-start_stop_connector-_6"><strong>暂停和恢复连接器</strong><a class="headerlink" href="#zh-user-guide-start_stop_connector-_6" title="Permanent link">&para;</a></h2>
<p>使用 <code>synchdb_pause_engine</code> 暂停连接器，这会暂时停止正在运行的连接器。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_pause_engine</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>使用 <code>synchdb_resume_engine</code> 恢复已暂停的连接器。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_resume_engine</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-user-guide-start_stop_connector-_7"><strong>停止或重启正在运行的连接器</strong><a class="headerlink" href="#zh-user-guide-start_stop_connector-_7" title="Permanent link">&para;</a></h2>
<p>使用 <code>synchdb_stop_engine_bgw</code> 停止正在运行的连接器。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_stop_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>使用 <code>synchdb_restart_connector</code> 以不同的快照模式重启正在运行的连接器。
<div class="highlight"><pre><span></span><code><span class="c1">-- 使用特定快照模式重启</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_restart_connector</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;initial&#39;</span><span class="p">);</span>

<span class="c1">-- 使用特定快照模式启动</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>
</code></pre></div></p></section><section class="print-page" id="zh-user-guide-connector_auto_launcher" heading-number="6.3"><h1 id="zh-user-guide-connector_auto_launcher-_1">自动启动器<a class="headerlink" href="#zh-user-guide-connector_auto_launcher-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-user-guide-connector_auto_launcher-synchdb"><strong>启用 SynchDB 自动启动器</strong><a class="headerlink" href="#zh-user-guide-connector_auto_launcher-synchdb" title="Permanent link">&para;</a></h2>
<p>当对特定 <code>connector name</code> 执行 <code>synchdb_start_engine_bgw()</code> 时，连接工作进程将具备自动启动资格。同样，当执行 <code>synchdb_stop_engine_bgw()</code> 时，将取消此资格。</p>
<p>启用自动连接器启动器需要：</p>
<ul>
<li>在 postgresql.conf 中将 <code>synchdb</code> 添加到 <code>shared_preload_libraries</code> GUC 选项</li>
<li>在 postgresql.conf 中将新的 GUC 选项 <code>synchdb.synchdb_auto_launcher</code> 设置为 true</li>
<li>重启 PostgreSQL 服务器使更改生效</li>
</ul>
<p>示例：
<div class="highlight"><pre><span></span><code>shared_preload_libraries = &#39;synchdb&#39;
synchdb.synchdb_auto_launcher = true
</code></pre></div></p>
<p>在启动时，SynchDB 扩展将很早被预加载。当 <code>synchdb.synchdb_auto_launcher</code> 设置为 true 时，SynchDB 将产生一个 <code>synchdb_auto_launcher</code> 后台工作进程，该进程将检索 <code>synchdb_conninfo</code> 表中标记为 <code>active</code> 的所有连接信息（<code>isactive</code> 标志设置为 <code>true</code>）。然后，它将以与调用 <code>synchdb_start_engine_bgw()</code> 相同的方式自动启动它们作为单独的后台工作进程。之后 <code>synchdb_auto_launcher</code> 将退出。</p>
<h2 id="zh-user-guide-connector_auto_launcher-_2"><strong>已知问题</strong><a class="headerlink" href="#zh-user-guide-connector_auto_launcher-_2" title="Permanent link">&para;</a></h2>
<p><code>synchdb_auto_launcher</code> 工作进程将登录到默认的 <code>postgres</code> 数据库，并尝试从 <code>synchdb_conninfo</code> 表中查找活动连接器。如果 SynchDB 安装在非默认数据库中，则 <code>synchdb_auto_launcher</code> 将无法找到该表，因此无法自动启动连接器工作进程。将来，我们将使 <code>synchdb_auto_launcher</code> 检查所有数据库，并根据每个数据库的 <code>synchdb_conninfo</code> 表自动启动连接器工作进程。</p>
<p>有关详细信息和更新，请查看<a href="https://github.com/Hornetlabs/synchdb/issues/71">[Issue #71]</a> 。</p></section><section class="print-page" id="zh-user-guide-default_datatype_mapping" heading-number="6.4"><h1 id="zh-user-guide-default_datatype_mapping-_1">默认数据类型映射<a class="headerlink" href="#zh-user-guide-default_datatype_mapping-_1" title="Permanent link">&para;</a></h1>
<p>默认数据类型映射是在SynchDB内部构建的哈希表，包含：
* 键：{数据类型，自动增量}
* 值：{数据类型，大小}</p>
<p>其中：
* 数据类型：数据类型的字符串表示，如INT、TEXT、NUMERIC
* 自动增量：表示数据类型是否具有自动增量属性的标志
* 大小：转换后的大小值。-1：无变化，0：未指定大小</p>
<p>可以通过定义对象映射规则来覆盖默认的数据类型映射关系。更多信息请参见<a href="https://docs.synchdb.com/zh/user-guide/object_mapping_rules/">转换规则文件</a>。</p>
<h2 id="zh-user-guide-default_datatype_mapping-mysql"><strong>MySQL 默认数据类型映射</strong><a class="headerlink" href="#zh-user-guide-default_datatype_mapping-mysql" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">DatatypeHashEntry</span><span class="w"> </span><span class="n">mysql_defaultTypeMappings</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;serial&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigserial&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallserial&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;mediumint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;serial&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;enum&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;set&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bigint unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;numeric unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;dec&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;decimal&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;dec unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;decimal&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;decimal unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;decimal&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;fixed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;decimal&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;fixed unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;decimal&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bit(1)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bit&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;double&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;double precision&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;double precision&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;double precision&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;double precision unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;double precision&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;double unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;double precision&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;real unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;float&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;float unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;int unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;integer&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;integer unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;mediumint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;mediumint unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;year&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;smallint unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;tinyint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;tinyint unsigned&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;datetime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamptz&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;binary&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;varbinary&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;blob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;mediumblob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;longblob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;tinyblob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;long varchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;longtext&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;mediumtext&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;tinytext&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;json&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;jsonb&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;geometry&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;geometrycollection&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;geomcollection&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;linestring&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;multilinestring&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;multipoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;multipolygon&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;point&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;polygon&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="zh-user-guide-default_datatype_mapping-sql-server"><strong>SQL Server 默认数据类型映射</strong><a class="headerlink" href="#zh-user-guide-default_datatype_mapping-sql-server" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">DatatypeHashEntry</span><span class="w"> </span><span class="n">sqlserver_defaultTypeMappings</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;int identity&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;serial&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bigint identity&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigserial&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;smallint identity&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallserial&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;enum&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;tinyint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;decimal&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bit(1)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bit&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bit&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;money&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;money&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;smallmoney&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;money&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;float&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;datetime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;datetime2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;datetimeoffset&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamptz&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;smalldatetime&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;char&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;char&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;varchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;varchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;nchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;char&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;nvarchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;varchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;ntext&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;binary&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;varbinary&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;image&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;uniqueidentifier&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;uuid&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;json&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;jsonb&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;hierarchyid&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;vector&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;geometry&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;geography&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="zh-user-guide-default_datatype_mapping-oracle"><strong>Oracle 默认数据类型映射</strong><a class="headerlink" href="#zh-user-guide-default_datatype_mapping-oracle" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">DatatypeHashEntry</span><span class="w"> </span><span class="n">oracle_defaultTypeMappings</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;binary_double&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;double precision&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;binary_float&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;float&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;real&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(0,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(1,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(2,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(3,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(4,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;smallint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(5,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(6,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(7,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(8,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(9,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(10,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(11,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(12,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(13,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(14,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(15,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(16,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(17,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(18,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bigint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(19,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(20,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(21,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(22,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(23,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(24,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(25,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(26,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(27,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(28,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(29,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(30,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(31,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(32,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(33,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(34,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(35,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(36,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(37,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number(38,0)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;numeric&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;long&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;interval day to second&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;interval day to second&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;interval year to month&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;interval year to month&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;timestamp with local time zone&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamptz&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;timestamp with time zone&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;timestamptz&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;char&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;char&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;nchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;char&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;nvarchar2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;varchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;varchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;varchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;varchar2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;varchar&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;long raw&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;raw&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;decimal&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;decimal&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;rowid&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;urowid&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;xmltype&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;bfile&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;blob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;bytea&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;clob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;nclob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;sdo_geometry&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;sdo_topo_geometry&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;sdo_georaster&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;uritype&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;anytype&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;anydata&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;anydataset&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>
</code></pre></div></section><section class="print-page" id="zh-user-guide-object_mapping_rules" heading-number="6.5"><h1 id="zh-user-guide-object_mapping_rules-_1">配置对象映射和转换规则<a class="headerlink" href="#zh-user-guide-object_mapping_rules-_1" title="Permanent link">&para;</a></h1>
<p>SynchDB 具有默认的名称和数据类型映射规则来处理传入的更改事件。大多数情况下，默认规则即可正常工作。但是，如果您有特定的转换要求，或者默认规则不适合您，则可以为特定连接器配置自己的对象映射规则。</p>
<h2 id="zh-user-guide-object_mapping_rules-synchdb_add_objmap"><strong>synchdb_add_objmap</strong><a class="headerlink" href="#zh-user-guide-object_mapping_rules-synchdb_add_objmap" title="Permanent link">&para;</a></h2>
<p>此实用函数可用于配置表名、列名、数据类型以及转换规则。它需要 4 个参数：</p>
<table>
<thead>
<tr>
<th style="text-align: center;">参数</th>
<th style="text-align: left;">描述</th>
<th style="text-align: center;">必需</th>
<th style="text-align: left;">示例</th>
<th style="text-align: left;">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>name</code></td>
<td style="text-align: left;">此连接器的唯一标识符</td>
<td style="text-align: center;">✓</td>
<td style="text-align: left;"><code>'mysqlconn'</code></td>
<td style="text-align: left;">必须在所有连接器中唯一</td>
</tr>
<tr>
<td style="text-align: center;"><code>object type</code></td>
<td style="text-align: left;">对象映射的类型</td>
<td style="text-align: center;">✓</td>
<td style="text-align: left;"><code>'table'</code></td>
<td style="text-align: left;">可以是 <code>table</code> 来映射表名，<code>column</code> 来映射列名，<code>datatype</code> 来映射数据类型，或 <code>transform</code> 来运行数据转换表达式</td>
</tr>
<tr>
<td style="text-align: center;"><code>source object</code></td>
<td style="text-align: left;">以完全限定名称表示的源对象</td>
<td style="text-align: center;">✓</td>
<td style="text-align: left;"><code>inventory.customers</code></td>
<td style="text-align: left;">远程数据库中的对象名称</td>
</tr>
<tr>
<td style="text-align: center;"><code>destination object</code></td>
<td style="text-align: left;">目标对象名称</td>
<td style="text-align: center;">✓</td>
<td style="text-align: left;"><code>'schema1.people'</code></td>
<td style="text-align: left;">PostgreSQL 端的目标对象名称。可以是完全限定表名、列名、数据类型或转换表达式</td>
</tr>
</tbody>
</table>
<h2 id="zh-user-guide-object_mapping_rules-_2"><strong>配置表名映射</strong><a class="headerlink" href="#zh-user-guide-object_mapping_rules-_2" title="Permanent link">&para;</a></h2>
<ul>
<li><code>source object</code> 表示远程数据库中以完全限定名称表示的表</li>
<li><code>destination object</code> 表示 PostgreSQL 中的表名。它可以只是一个名称（默认为公共架构）或 schema.name 格式。</li>
</ul>
<p>此示例将源数据库中的 <code>inventory.customers</code> 表映射到 PostgreSQL 中的 <code>schema1.people</code>。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;table&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.customers&#39;</span><span class="p">,</span><span class="s1">&#39;schema1.people&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-user-guide-object_mapping_rules-_3"><strong>配置列名映射</strong><a class="headerlink" href="#zh-user-guide-object_mapping_rules-_3" title="Permanent link">&para;</a></h2>
<ul>
<li><code>源对象</code> 表示远程数据库中完全限定名称的列</li>
<li><code>目标对象</code> 表示 PostgreSQL 中的列名。无需将其格式化为完全限定列名。</li>
</ul>
<p>此示例将源表中的 <code>inventory.customers.email</code> 列映射到 PostgreSQL 中的 <code>contact</code>。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;column&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.customers.email&#39;</span><span class="p">,</span><span class="s1">&#39;contact&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-user-guide-object_mapping_rules-_4"><strong>配置数据类型映射</strong><a class="headerlink" href="#zh-user-guide-object_mapping_rules-_4" title="Permanent link">&para;</a></h2>
<ul>
<li><code>源对象</code> 可以表示为以下之一：</li>
<li>完全限定列 (inventory.geom.g)。这意味着数据类型映射仅适用于此特定列。</li>
<li>
<p>通用数据类型字符串 (int)。如果是自增数据类型，请使用竖线 (|) 添加（int|true 表示自增 int），否则使用竖线 (|) 添加（int|false 表示非自增 int）。这意味着数据类型映射适用于所有符合条件的数据类型。</p>
</li>
<li>
<p><code>destination object</code> 应表示为 PostgreSQL 中存在的通用数据类型字符串。使用竖线 (|) 覆盖大小（text|0 将大小覆盖为 0，因为 text 是可变大小）或（varchar|-1 使用 change 事件附带的任何大小）。</p>
</li>
</ul>
<p>此示例将所有非自增 <code>point</code> 数据类型映射到 PostgreSQL 中的 <code>text</code> 数据类型。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;datatype&#39;</span><span class="p">,</span><span class="s1">&#39;point|false&#39;</span><span class="p">,</span><span class="s1">&#39;text|0&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>此示例将表 <code>inventory.geom</code> 的列 <code>g</code> 的数据类型映射到 PostgreSQL 中的 <code>geometry</code>。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;datatype&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.geom.g&#39;</span><span class="p">,</span><span class="s1">&#39;geometry|0&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-user-guide-object_mapping_rules-_5"><strong>配置转换规则</strong><a class="headerlink" href="#zh-user-guide-object_mapping_rules-_5" title="Permanent link">&para;</a></h2>
<ul>
<li><code>源对象</code> 表示要转换的列</li>
<li><code>目标对象</code> 表示在将列数据应用于 PostgreSQL 之前要对其运行的表达式。使用 %d 作为输入列数据的占位符。如果是几何类型，则使用 %w 表示 WKB，%s 表示 SRID。</li>
</ul>
<p>此示例将在 SynchDB 收到的“inventory.products.name”列的值前添加“&gt;&gt;&gt;&gt;&gt;”并在其后添加“&lt;&lt;&lt;&lt;&lt;”。
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.products.name&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;&#39;&gt;&gt;&gt;&gt;&#39;&#39; || &#39;&#39;%d&#39;&#39; || &#39;&#39;&lt;&lt;&lt;&lt;&lt;&#39;&#39;&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>此示例将始终在 SynchDB 收到的“inventory.orders.quantity”列的值后添加 500：
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span><span class="s1">&#39;inventory.orders.quantity&#39;</span><span class="p">,</span><span class="s1">&#39;%d + 500&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-user-guide-object_mapping_rules-_6">** 使用规则**<a class="headerlink" href="#zh-user-guide-object_mapping_rules-_6" title="Permanent link">&para;</a></h2>
<p>如果连接器未运行，规则会在下次启动时通过 <code>synchdb_start_engine_bgw</code> 自动应用。</p>
<p>如果连接器已在运行，规则不会自动应用，我们必须告诉连接器重新加载对象映射规则，并使用实用函数 <code>synchdb_reload_objmap</code> 来应用规则。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_reload_objmap</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></section><section class="print-page" id="zh-user-guide-secured_connection" heading-number="6.6"><h1 id="zh-user-guide-secured_connection-_1">安全连接<a class="headerlink" href="#zh-user-guide-secured_connection-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-user-guide-secured_connection-_2"><strong>配置安全连接</strong><a class="headerlink" href="#zh-user-guide-secured_connection-_2" title="Permanent link">&para;</a></h2>
<p>为了确保与远程数据库的连接安全，我们需要为 <code>synchdb_add_conninfo</code> 创建的连接器配置额外的 SSL 相关参数。SSL 证书和私钥必须打包为 Java 密钥库文件，并附带密码。这些信息随后会通过 synchdb_add_extra_conninfo() 传递给 SynchDB。</p>
<p>&lt;&lt;<strong>重要提示</strong>&gt;&gt; Openlog Replicator 連接器不支援安全連接</p>
<h2 id="zh-user-guide-secured_connection-synchdb_add_extra_conninfo"><strong>synchdb_add_extra_conninfo</strong><a class="headerlink" href="#zh-user-guide-secured_connection-synchdb_add_extra_conninfo" title="Permanent link">&para;</a></h2>
<p><strong>用途</strong>：为 <code>synchdb_add_conninfo</code> 创建的现有连接器配置额外的连接器参数</p>
<table>
<thead>
<tr>
<th style="text-align: center;">参数</th>
<th style="text-align: left;">描述</th>
<th style="text-align: center;">必需</th>
<th style="text-align: left;">示例</th>
<th style="text-align: left;">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>name</code></td>
<td style="text-align: left;">此连接器的唯一标识符</td>
<td style="text-align: center;">✓</td>
<td style="text-align: left;"><code>'mysqlconn'</code></td>
<td style="text-align: left;">必须在所有连接器中唯一</td>
</tr>
<tr>
<td style="text-align: center;"><code>ssl_mode</code></td>
<td style="text-align: left;">SSL 模式</td>
<td style="text-align: center;">☐</td>
<td style="text-align: left;"><code>'verify_ca'</code></td>
<td style="text-align: left;">可以是以下之一：<br><ul><li>“disabled”- 不使用 SSL。</li><li>“preferred”- 如果服务器支持，则使用 SSL。</li><li>“required”- 必须使用 SSL 建立连接。</li><li>“verify_ca”- 连接器与服务器建立 TLS，并将根据配置的信任库验证服务器的 TLS 证书。</li><li>“verify_identity”- 与 verify_ca 行为相同，但它还会检查服务器证书的通用名称以匹配系统的主机名。</td>
</tr>
<tr>
<td style="text-align: center;"><code>ssl_keystore</code></td>
<td style="text-align: left;">密钥库路径</td>
<td style="text-align: center;">☐</td>
<td style="text-align: left;"><code>/path/to/keystore</code></td>
<td style="text-align: left;">密钥库文件的路径</td>
</tr>
<tr>
<td style="text-align: center;"><code>ssl_keystore_pass</code></td>
<td style="text-align: left;">密钥库密码</td>
<td style="text-align: center;">☐</td>
<td style="text-align: left;"><code>'mykeystorepass'</code></td>
<td style="text-align: left;">访问密钥库文件的密码</td>
</tr>
<tr>
<td style="text-align: center;"><code>ssl_truststore</code></td>
<td style="text-align: left;">信任库路径</td>
<td style="text-align: center;">☐</td>
<td style="text-align: left;"><code>'/path/to/truststore'</code></td>
<td style="text-align: left;">信任库文件路径</td>
</tr>
<tr>
<td style="text-align: center;"><code>ssl_truststore_pass</code></td>
<td style="text-align: left;">信任库密码</td>
<td style="text-align: center;">☐</td>
<td style="text-align: left;"><code>'mytruststorepass'</code></td>
<td style="text-align: left;">访问信任库文件的密码</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_extra_conninfo</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;verify_ca&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/path/to/keystore&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mykeystorepass&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/path/to/truststore&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mytruststorepass&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-user-guide-secured_connection-synchdb_del_extra_conninfo"><strong>synchdb_del_extra_conninfo</strong><a class="headerlink" href="#zh-user-guide-secured_connection-synchdb_del_extra_conninfo" title="Permanent link">&para;</a></h2>
<p><strong>用途</strong>：删除由 <code>synchdb_add_extra_conninfo</code> 创建的额外连接器参数
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_del_extra_conninfo</span><span class="p">(</span><span class="s1">&#39;mysqlconn&#39;</span><span class="p">);</span>
</code></pre></div></p></section><section class="print-page" id="zh-user-guide-configure_error_strategies" heading-number="6.7"><h1 id="zh-user-guide-configure_error_strategies-_1">配置错误处理策略<a class="headerlink" href="#zh-user-guide-configure_error_strategies-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-user-guide-configure_error_strategies-_2"><strong>配置错误处理策略</strong><a class="headerlink" href="#zh-user-guide-configure_error_strategies-_2" title="Permanent link">&para;</a></h2>
<p>在初始快照或 CDC 期间，可能会发生诸如主键冲突、数据无效等错误，SynchDB 需要知道如何处理这些错误。对于 Synchdb 处理过程中或应用到 PostgreSQL 过程中发生的错误，可以通过配置参数“synchdb.error_handling_strategy”使用多种策略来处理它们。</p>
<p>请注意，以下提到的错误策略仅在错误源自或检测到 C 端变更事件处理过程中时才会执行。如果错误源自 Java 端的 Debezium Runner，例如连接问题或与远程数据库的连接问题，则上述策略将不会执行。在这种情况下，Debezium Runner 的错误消息将传播到 C 端的 SynchDB，并显示在 <code>synchdb_state_view()</code> 中，连接器将退出。</p>
<h3 id="zh-user-guide-configure_error_strategies-exit"><strong>exit (默认)</strong><a class="headerlink" href="#zh-user-guide-configure_error_strategies-exit" title="Permanent link">&para;</a></h3>
<p>这是默认的错误策略，当发生错误时，连接器工作器会退出。当前正在处理的导致错误的批次将不会被标记为已完成，并且不会提交同一批次中已成功完成的更改事件。用户应检查“synchdb_state_view()”或日志文件中返回的错误消息以解决错误。当连接器工作器重新启动时，连接器将自动重试之前失败的同一批。</p>
<h3 id="zh-user-guide-configure_error_strategies-retry"><strong>retry</strong><a class="headerlink" href="#zh-user-guide-configure_error_strategies-retry" title="Permanent link">&para;</a></h3>
<p>此策略为连接器工作器添加了 5 秒的“restart_time”，这会导致 PostgreSQL 的 bgworker 引擎在工作器退出时每 5 秒自动启动一次工作器。这意味着当发生错误时，连接器工作器仍将退出，但与上面的 <code>exit</code> 策略不同，它将由 bgworker 引擎自动重新启动，后者将在失败的同一批次上重试。它将继续退出并重新启动，直到错误得到解决。</p>
<h3 id="zh-user-guide-configure_error_strategies-skip"><strong>skip</strong><a class="headerlink" href="#zh-user-guide-configure_error_strategies-skip" title="Permanent link">&para;</a></h3>
<p>顾名思义，当处于 <code>skip</code> 错误策略中时，连接器工作器遇到的任何错误都不会导致工作器退出，但是错误消息仍将写入日志或 <code>synchdb_state_view()</code>，但连接器本身将忽略错误并继续处理下一个更改事件甚至下一个批次。</p>
<h2 id="zh-user-guide-configure_error_strategies-_3"><strong>查看连接器的最后一个错误消息</strong><a class="headerlink" href="#zh-user-guide-configure_error_strategies-_3" title="Permanent link">&para;</a></h2>
<p>如上所述，源自 Java 端的 Debezium Runner 或 C 端的 SynchDB 的错误将会传播并显示在 <code>synchdb_state_view()</code> 中。例如：</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">synchdb_state_view</span><span class="p">;</span>

<span class="w">   </span><span class="n">name</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="o">|</span><span class="w">                                                                                                          </span><span class="n">err</span>
<span class="c1">-----------+-----+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="w"> </span><span class="n">mysqlconn</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Connector</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">valid</span><span class="p">.</span><span class="w"> </span><span class="n">Unable</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">connect</span><span class="p">:</span><span class="w"> </span><span class="n">Communications</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">failure</span><span class="w">  </span><span class="n">The</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">sent</span><span class="w"> </span><span class="n">successfully</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">milliseconds</span><span class="w"> </span><span class="n">ago</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">driver</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">received</span><span class="w"> </span><span class="k">any</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">.</span>
<span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span>
</code></pre></div>
<p>如果在处理 JSON 事件时发生错误，并且 GUC 参数 <code>synchdb.log_change_on_error</code> 设置为 true，SynchDB 还会在 PostgreSQL 日志文件中输出导致错误的 JSON 变化事件，以便进行故障排除。</p></section><section class="print-page" id="zh-user-guide-set_offset" heading-number="6.8"><h1 id="zh-user-guide-set_offset-_1">自定义起始偏移量值<a class="headerlink" href="#zh-user-guide-set_offset-_1" title="Permanent link">&para;</a></h1>
<p>起始偏移量值代表开始复制的点，类似于 PostgreSQL 的恢复 LSN。当 Debezium 运行引擎启动时，它将从这个偏移量值开始复制。将此偏移量值设置为较早的值将导致 Debezium 运行引擎从较早的记录开始复制，可能会复制重复的数据记录。在设置 Debezium 的起始偏移量值时，我们应该格外谨慎。</p>
<h2 id="zh-user-guide-set_offset-_2"><strong>记录可设置的偏移量值</strong><a class="headerlink" href="#zh-user-guide-set_offset-_2" title="Permanent link">&para;</a></h2>
<p>在操作过程中，Debezium 运行引擎将生成新的偏移量并将其刷新到磁盘。最后刷新的偏移量可以通过 <code>synchdb_state_view()</code> 实用命令检索：
<div class="highlight"><pre><span></span><code>postgres=# select name, last_dbz_offset from synchdb_state_view;
     name      |                                           last_dbz_offset
---------------+------------------------------------------------------------------------------------------------------
 sqlserverconn | {&quot;commit_lsn&quot;:&quot;0000006a:00006608:0003&quot;,&quot;snapshot&quot;:true,&quot;snapshot_completed&quot;:false}
 mysqlconn     | {&quot;ts_sec&quot;:1741301103,&quot;file&quot;:&quot;mysql-bin.000009&quot;,&quot;pos&quot;:574318212,&quot;row&quot;:1,&quot;server_id&quot;:223344,&quot;event&quot;:2}
 oracleconn    | {&quot;commit_scn&quot;:&quot;2311579&quot;,&quot;snapshot_scn&quot;:&quot;2311578&quot;,&quot;scn&quot;:&quot;2311578&quot;}
(3 rows)
</code></pre></div></p>
<p>根据连接器类型的不同，这个偏移量值也不同。从上面的示例中，<code>mysql</code> 连接器的最后刷新偏移量是 <code>{"ts_sec":1741301103,"file":"mysql-bin.000009","pos":574318212,"row":1,"server_id":223344,"event":2}</code>，而 <code>sqlserver</code> 的最后刷新偏移量是 <code>{"commit_lsn":"0000006a:00006608:0003","snapshot":true,"snapshot_completed":false}</code>。</p>
<p>我们应该定期保存这些值，这样如果遇到问题，我们就知道过去可以设置的偏移量位置，以恢复复制操作。</p>
<h2 id="zh-user-guide-set_offset-_3"><strong>暂停连接器</strong><a class="headerlink" href="#zh-user-guide-set_offset-_3" title="Permanent link">&para;</a></h2>
<p>在设置新的偏移量值之前，连接器必须处于 <code>paused</code>（暂停）状态。</p>
<p>使用 <code>synchdb_pause_engine()</code> SQL 函数暂停正在运行的连接器。这将停止 Debezium 运行引擎从异构数据库复制。当暂停时，可以使用 <code>synchdb_set_offset()</code> SQL 例程更改 Debezium 连接器的偏移量值，以从过去的特定点开始复制。它以 <code>conninfo_name</code> 作为参数，可以从 <code>synchdb_get_state()</code> 视图的输出中找到。</p>
<p>例如：
<div class="highlight"><pre><span></span><code>SELECT synchdb_pause_engine(&#39;mysqlconn&#39;);
</code></pre></div></p>
<h2 id="zh-user-guide-set_offset-_4"><strong>设置新的偏移量</strong><a class="headerlink" href="#zh-user-guide-set_offset-_4" title="Permanent link">&para;</a></h2>
<p>使用 <code>synchdb_set_offset()</code> SQL 函数更改连接器工作进程的起始偏移量。只有当连接器处于 <code>paused</code> 状态时才能执行此操作。该函数接受两个参数，<code>conninfo_name</code> 和 <code>有效的偏移量字符串</code>，这两个参数都可以从 <code>synchdb_get_state()</code> 视图的输出中找到。</p>
<p>例如：
<div class="highlight"><pre><span></span><code>SELECT synchdb_set_offset(&#39;mysqlconn&#39;, &#39;{&quot;ts_sec&quot;:1741301103,&quot;file&quot;:&quot;mysql-bin.000009&quot;,&quot;pos&quot;:574318212,&quot;row&quot;:1,&quot;server_id&quot;:223344,&quot;event&quot;:2}&#39;);
</code></pre></div></p>
<h2 id="zh-user-guide-set_offset-_5"><strong>恢复连接器</strong><a class="headerlink" href="#zh-user-guide-set_offset-_5" title="Permanent link">&para;</a></h2>
<p>使用 <code>synchdb_resume_engine()</code> SQL 函数从暂停状态恢复 Debezium 操作。此函数以 <code>连接器名称</code> 作为其唯一参数，可以从 <code>synchdb_get_state()</code> 视图的输出中找到。恢复的 Debezium 运行引擎将从新设置的偏移量值开始复制。</p>
<p>例如：
<div class="highlight"><pre><span></span><code>SELECT synchdb_resume_engine(&#39;mysqlconn&#39;);
</code></pre></div></p></section><section class="print-page" id="zh-user-guide-configure_olr" heading-number="6.9"><h1 id="zh-user-guide-configure_olr-oracle-openlog-replicator">为 Oracle 配置 Openlog Replicator<a class="headerlink" href="#zh-user-guide-configure_olr-oracle-openlog-replicator" title="Permanent link">&para;</a></h1>
<h2 id="zh-user-guide-configure_olr-_1"><strong>概述</strong><a class="headerlink" href="#zh-user-guide-configure_olr-_1" title="Permanent link">&para;</a></h2>
<p>除了基于 LogMiner 的 Oracle 复制功能外，<strong>SynchDB</strong> 还支持使用 <strong>Openlog Replicator (OLR)</strong> 从 Oracle 数据库进行流式传输。SynchDB 支持两种类型的 Openlog Replicator：</p>
<ol>
<li>基于 Debezium 的 Openlog Replicator</li>
<li>原生 Openlog Replicator（不通过 Debezium）- BETA 版</li>
</ol>
<p>这两种 Openlog Replicator 都需要根据以下设置示例进行配置，并在 SynchDB 进行流式传输之前连接到 Oracle。</p>
<h2 id="zh-user-guide-configure_olr-_2"><strong>要求</strong><a class="headerlink" href="#zh-user-guide-configure_olr-_2" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Openlog Replicator 版本</strong>：<code>1.3.0</code>（已验证与 Debezium 2.7.x 的兼容性）</li>
<li>具有可供 OLR 访问的重做日志的 Oracle 实例</li>
<li>必须为 OLR 授予额外权限。有关具体的权限要求，请参阅<a href="https://docs.synchdb.com/zh/getting-started/remote_database_setups/">此处</a>。</li>
<li>Openlog Replicator 必须已配置并正在运行</li>
<li>SynchDB 中现有的 Oracle 连接器（使用 <code>synchdb_add_conninfo()</code> 创建）</li>
</ul>
<p>有关通过 Docker 部署 Openlog Replicator 的详细信息，请参阅此<a href="https://highgo.atlassian.net/wiki/external/OTUzY2Q2OWFkNzUzNGVkM2EyZGIyMDE1YzVhMDdkNWE">外部指南</a>。</p>
<h2 id="zh-user-guide-configure_olr-openlog-replicator"><strong>Openlog Replicator 配置示例</strong><a class="headerlink" href="#zh-user-guide-configure_olr-openlog-replicator" title="Permanent link">&para;</a></h2>
<p>SynchDB 的 OLR 支持基于以下配置示例构建。</p>
<p><strong>Version 1.3.0</strong>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.3.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;alias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SOURCE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ORACLE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;reader&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;online&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DBZUSER&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dbz&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;//ora19c:1521/FREE&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;column&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;db&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;interval-dts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;interval-ytm&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;rid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;timestamp-all&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;scn-all&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;memory&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;min-mb&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;max-mb&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1024</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DBZUSER&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;.*&quot;</span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;flags&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;alias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SYNCHDB&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SOURCE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;writer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;network&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.0.0.0:7070&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Version 1.8.5</strong>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.8.5&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;alias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SOURCE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ORACLE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;reader&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;online&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DBZUSER&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dbz&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;//ora19c:1521/FREE&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;column&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;db&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;interval-dts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;interval-ytm&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;rid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;timestamp-all&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;scn-type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;memory&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;min-mb&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;max-mb&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;swap-path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/opt/OpenLogReplicator/olrswap&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DBZUSER&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;.*&quot;</span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;flags&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;alias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DEBEZIUM&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SOURCE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;writer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;network&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.0.0.0:7070&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p>请注意以下几点：</p>
<ul>
<li>"source"."name": "ORACLE" -&gt; 通过 <code>synchdb_add_olr_conninfo()</code> 定义 OLR 参数时，此字段应与 <code>olr_source</code> 值匹配（见下文）</li>
<li>"source"."reader"."user" -&gt; 通过 <code>synchdb_add_conninfo()</code> 创建连接器时，此字段应与 <code>username</code> 值匹配</li>
<li>"source"."reader"."password" -&gt; 通过 <code>synchdb_add_conninfo()</code> 创建连接器时，此字段应与 <code>password</code> 值匹配</li>
<li>"source"."reader"."server" -&gt; 通过 <code>synchdb_add_conninfo()</code> 创建连接器时，此字段应包含 <code>hostname</code>、<code>port</code> 和 <code>source database</code> 的值</li>
<li>"source"."filter"."table":[] -&gt; 这会过滤 Openlog Replicator 捕获的变更事件。&lt;&lt;&lt;<strong>重要</strong>&gt;&gt;&gt;：这是目前从 Oracle 过滤变更事件的唯一方法，因为 SynchDB 中的 OLR 实现目前不进行任何过滤。（通过 <code>synchdb_add_conninfo()</code> 创建连接器时，<code>table</code> 和 <code>snapshot table</code> 的值会被忽略。）</li>
<li>"format":{} -&gt; 基于 Debezium 或原生 Openlog Replicator 连接器提取的特定 Paylod 格式。请按照指定的方式使用这些值。</li>
<li>“memory”.“swap-path” -&gt; 这告诉 OLR 在内存不足的情况下将交换文件写入哪里。</li>
<li>"target".[0].."writer"."type": -&gt; 必须指定 <code>network</code>，因为 Debezium 和原生 Openlog Replicator 连接器都通过网络与 Openlog Replicator 通信。</li>
<li>"target".[0].."writer"."uri": -&gt; 这是 Openlog Replicator 监听的绑定主机和端口，SynchDB 应该能够在通过 <code>synchdb_add_olr_conninfo()</code> 定义 OLR 参数时通过 <code>olr_host</code> 和 <code>olr_port</code> 访问该主机和端口。</li>
</ul>
<h2 id="zh-user-guide-configure_olr-synchdb_add_conninfo"><strong><code>synchdb_add_conninfo()</code></strong><a class="headerlink" href="#zh-user-guide-configure_olr-synchdb_add_conninfo" title="Permanent link">&para;</a></h2>
<p>要创建<strong>原生</strong> OLR 连接器（使用 <code>type</code> = 'olr'）：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;ora19c&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">1521</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;DBZUSER&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;dbz&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;FREE&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;oracle&#39;</span><span class="p">);</span>
</code></pre></div>
<p>要创建<strong>基于 Debezium 的</strong> OLR 连接器（使用 <code>type</code> = 'oracle'）：</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_conninfo</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;ora19c&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="mi">1521</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;DBZUSER&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;dbz&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;FREE&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;null&#39;</span><span class="p">,</span>
<span class="w">                            </span><span class="s1">&#39;olr&#39;</span><span class="p">);</span>
</code></pre></div>
<p>&lt;&lt;&lt;<strong>重要</strong>&gt;&gt;&gt; <strong>SynchDB 必须使用标志 (WITH_OLR=1) 进行编译和构建，以支持本机 openlog 复制器连接器。</strong></p>
<p>更多关于创建连接器的信息，请访问<a href="https://docs.synchdb.com/user-guide/create_a_connector/">此处</a></p>
<h2 id="zh-user-guide-configure_olr-synchdb_add_olr_conninfo"><strong><code>synchdb_add_olr_conninfo()</code></strong><a class="headerlink" href="#zh-user-guide-configure_olr-synchdb_add_olr_conninfo" title="Permanent link">&para;</a></h2>
<p>创建连接器后，用户可以为现有的 Oracle 连接器注册一个 Openlog Replicator 端点。 </p>
<p><strong>签名：</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">synchdb_add_olr_conninfo</span><span class="p">(</span>
<span class="w">    </span><span class="n">conn_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="c1">-- 连接器名称</span>
<span class="w">    </span><span class="n">olr_host</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="c1">-- OLR 实例的主机名或 IP</span>
<span class="w">    </span><span class="n">olr_port</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="c1">-- OLR 公开的端口号（通常为 7070）</span>
<span class="w">    </span><span class="n">olr_source</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="c1">-- OLR 中配置的 Oracle 源名称</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>示例：</strong></p>
<p>这将指示 SynchDB 使用 Oracle 源标识符 ORACLE，从运行于 olrhost:7070 的 Openlog Replicator 实例流式传输连接器 <code>olrconn</code> 的变更。调用 <code>synchdb_start_engine_bgw</code> 启动此连接器。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_olr_conninfo</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;olrhost&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">7070</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ORACLE&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-user-guide-configure_olr-synchdb_del_olr_conninfo"><strong>synchdb_del_olr_conninfo</strong><a class="headerlink" href="#zh-user-guide-configure_olr-synchdb_del_olr_conninfo" title="Permanent link">&para;</a></h2>
<p>删除特定连接器的 OLR 配置，将其恢复为使用 LogMiner。</p>
<p><strong>签名：</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">synchdb_del_olr_conninfo</span><span class="p">(</span><span class="n">conn_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">)</span>
</code></pre></div>
<p><strong>示例：</strong></p>
<p>此命令禁用 oracleconn 的 OLR 使用。使用 <code>synchdb_start_engine_bgw</code> 启动连接器将回退到默认的日志挖掘策略（基于 Debezium 的 OLR 连接器）。如果使用原生 Openlog Replicator 连接器，缺少 OLR 配置将导致连接器启动时出错。</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_del_olr_conninfo</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-user-guide-configure_olr-debezium-openlog-replicator"><strong>基于 Debezium 的 Openlog Replicator 连接器的行为说明</strong><a class="headerlink" href="#zh-user-guide-configure_olr-debezium-openlog-replicator" title="Permanent link">&para;</a></h2>
<ul>
<li>当 LogMiner 和 OLR 配置都存在时，SynchDB 默认使用 Openlog Replicator 进行变更捕获。</li>
<li>如果 OLR 配置缺失，SynchDB 将使用日志挖掘策略来流式传输变更。</li>
<li>修改 OLR 配置后，需要重新启动连接器。</li>
</ul>
<h2 id="zh-user-guide-configure_olr-openlog-replicator_1"><strong>原生的 Openlog Replicator 连接器的行为说明</strong><a class="headerlink" href="#zh-user-guide-configure_olr-openlog-replicator_1" title="Permanent link">&para;</a></h2>
<ul>
<li>目前为 BETA 版本。</li>
<li>SynchDB 管理与 Openlog Replicator 的连接，并在不使用 Debezium 的情况下流式传输变更。</li>
<li>需要 OLR 配置，否则连接器启动时会出错。</li>
<li>依赖 Debezium 的 Oracle 连接器完成初始快照，并在完成后关闭，后续的 CDC 由 SynchDB 内部针对 Openlog Replicator 原生完成。</li>
<li>依赖 IvorySQL 的 Oracle 解析器来处理 DDL 事件。在使用原生 openlog replicator 连接器之前，必须先编译并安装它。</li>
<li>访问<a href="https://github.com/bersler/OpenLogReplicator">此处</a> 了解有关 Openlog Replicator 的更多信息。</li>
</ul></section><section class="print-page" id="zh-user-guide-configure_infinispan" heading-number="6.10"><h1 id="zh-user-guide-configure_infinispan-infinispan-oracle">配置 Infinispan 的 Oracle 连接器<a class="headerlink" href="#zh-user-guide-configure_infinispan-infinispan-oracle" title="Permanent link">&para;</a></h1>
<h2 id="zh-user-guide-configure_infinispan-_1"><strong>概述</strong><a class="headerlink" href="#zh-user-guide-configure_infinispan-_1" title="Permanent link">&para;</a></h2>
<p>默认情况下，Debezium 的 Oracle 连接器使用 JVM 堆缓存传入的变更事件，然后再将它们传递给 SynchDB 进行处理。最大堆大小通过 <code>synchdb.jvm_max_heap_size</code> GUC 控制。当 JVM 堆内存不足时（尤其是在处理大型事务或包含大量列的模式时），连接器可能会出现 OutOfMemoryError 错误，这使得堆大小调整成为一项关键的调优挑战。</p>
<p>作为替代方案，Debezium 可以配置使用 Infinispan 作为其缓存层。Infinispan 支持 JVM 堆和堆外（直接内存）的内存存储，从而提供更大的灵活性。此外，它还支持钝化功能，允许在达到内存限制时将多余的数据溢出到磁盘。这使得它在高负载下更具弹性，并确保能够优雅地处理大型事务或模式变更，而不会耗尽内存。</p>
<h2 id="zh-user-guide-configure_infinispan-synchdb_add_infinispan"><strong><code>synchdb_add_infinispan()</code></strong><a class="headerlink" href="#zh-user-guide-configure_infinispan-synchdb_add_infinispan" title="Permanent link">&para;</a></h2>
<p><strong>签名：</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">synchdb_add_infinispan</span><span class="p">(</span>
<span class="w">    </span><span class="n">connectorName</span><span class="w"> </span><span class="n">NAME</span><span class="p">,</span><span class="w">         </span><span class="c1">-- 连接器名称</span>
<span class="w">    </span><span class="n">memoryType</span><span class="w"> </span><span class="n">NAME</span><span class="p">,</span><span class="w">            </span><span class="c1">-- 内存类型，可以是“堆”或“非堆”</span>
<span class="w">    </span><span class="n">memorySize</span><span class="w"> </span><span class="nb">INT</span><span class="w">              </span><span class="c1">-- 预留为缓存的内存大小（以 MB 为单位）</span>
<span class="p">)</span>
</code></pre></div>
<p>为给定的连接器注册一个由 Infinispan 支持的缓存配置。这允许连接器使用 Infinispan 缓冲更改事件，并支持基于堆和堆外内存分配以及溢出到磁盘（钝化）。</p>
<p><strong>注意：</strong></p>
<ul>
<li>如果在当前正在运行的连接器上调用，则该设置将在下次重启时生效。</li>
<li>如果连接器已存在 Infinispan 缓存，它将被替换。</li>
<li>memoryType='off_heap' 使用本机（直接）内存，不受 JVM 堆限制，但应谨慎调整大小。</li>
<li>当内存填满时，缓存将自动支持钝化到磁盘。</li>
</ul>
<p><strong>示例：</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_add_infinispan</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;off_heap&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-user-guide-configure_infinispan-synchdb_del_infinispan"><strong><code>synchdb_del_infinispan()</code></strong><a class="headerlink" href="#zh-user-guide-configure_infinispan-synchdb_del_infinispan" title="Permanent link">&para;</a></h2>
<p><strong>签名：</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">synchdb_add_infinispan</span><span class="p">(</span>
<span class="w">    </span><span class="n">connectorName</span><span class="w"> </span><span class="n">NAME</span><span class="w">          </span><span class="c1">-- 连接器名称</span>
<span class="p">)</span>
</code></pre></div>
<p>删除指定连接器的 Infinispan 缓存配置及其相关的磁盘元数据。此操作将删除：</p>
<ul>
<li>所有缓存文件</li>
<li>所有钝化（溢出到磁盘）状态</li>
<li>相关的 Infinispan 配置</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li>此函数只能在连接器停止时执行。</li>
<li>在连接器处于活动状态时尝试运行此函数将导致错误。</li>
<li>永久禁用或重新配置连接器的缓存后端后，使用此命令进行清理。</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_del_infinispan</span><span class="p">(</span><span class="s1">&#39;oracleconn&#39;</span><span class="p">);</span>
</code></pre></div></p>
<h2 id="zh-user-guide-configure_infinispan-_2"><strong><code>钝化</code></strong><a class="headerlink" href="#zh-user-guide-configure_infinispan-_2" title="Permanent link">&para;</a></h2>
<p>钝化简单来说就是，如果缓存已满，infinispan 会弹出并将数据写入磁盘。只要内存中有足够的空间来保存更改事件，就不会发生磁盘写入。数据将写入 <code>$PGDATA/pg_synchdb/ispn_[连接器名称]_[目标数据库名称]</code></p>
<h2 id="zh-user-guide-configure_infinispan-infinispan-oracle-sql"><strong>用于测试 Infinispan 大型事务的 Oracle SQL 示例</strong><a class="headerlink" href="#zh-user-guide-configure_infinispan-infinispan-oracle-sql" title="Permanent link">&para;</a></h2>
<p><strong>在 Oracle 中创建测试表：</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">big_tx_test</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w">       </span><span class="nb">NUMBER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">payload</span><span class="w">  </span><span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">4000</span><span class="p">),</span>
<span class="w">    </span><span class="n">created</span><span class="w">  </span><span class="nb">DATE</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">SYSDATE</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>创建一个相对较大的交易：</strong>
<div class="highlight"><pre><span></span><code><span class="k">BEGIN</span>
<span class="w">  </span><span class="k">FOR</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="mi">1</span><span class="p">..</span><span class="mi">100000</span><span class="w"> </span><span class="n">LOOP</span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">big_tx_test</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">)</span>
<span class="w">    </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">RPAD</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">));</span>
<span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="n">LOOP</span><span class="p">;</span>
<span class="w">  </span><span class="k">COMMIT</span><span class="p">;</span>
<span class="k">END</span><span class="p">;</span>
<span class="o">/</span>
</code></pre></div></p>
<p><strong>大事务下的行为</strong></p>
<p>未设置 infinispan + 低 JVM heap size (128)</p>
<ul>
<li>&rarr; 将发生 OutOfMemory 错误</li>
</ul>
<p>低 JVM heap size (128) + 高 infinispan heap size (2048)</p>
<ul>
<li>&rarr; 大型事务成功处理</li>
</ul>
<p>低 JVM heap size (128) + 低 infinispan heap size (128)</p>
<ul>
<li>&rarr; 将发生钝化</li>
<li>&rarr; <code>ispn_[连接器名称]_[目标数据库名称]</code> 大小在处理过程中会增加，大型事务处理完成后会减小</li>
<li>&rarr; 大型事务已成功处理，但速度较慢。</li>
</ul>
<p>低 JVM heap size (128) + 高 infinispan heap size (2048)</p>
<ul>
<li>&rarr; 将发生 OutOfMemory 错误</li>
<li>&rarr; 请勿将 infinispan 配置 heap size 超过 JVM 最大 heap 内存</li>
</ul>
<p>较低的 JVM heap size (128) + 较低的 infinispan heap size (64)</p>
<ul>
<li>&rarr; 将发生钝化</li>
<li>&rarr; <code>ispn_[连接器名称]_[目标数据库名称]</code> 的大小将在处理过程中增加，并在大型事务处理完成后减小。</li>
<li>&rarr; 不建议使用，因为 infinispan 可能会占用一半的 JVM heap，而剩余空间可能不足以用于其他 Debezium 操作。</li>
</ul>
<p>低 JVM heap size (128) + 相同的 infinispan heap size (128)</p>
<ul>
<li>&rarr; 不建议使用，因为 infinispan 可能会占用所有 JVM 堆空间，最终导致 OutOfMemory 错误。</li>
</ul>
<p>高 JVM heap size (2048) + 低 infinispan heap size (128)</p>
<ul>
<li>&rarr; 将发生钝化。</li>
<li>&rarr; <code>ispn_[连接器名称]_[目标数据库名称]</code> 的大小在处理过程中会增加，并在大型事务处理完成后减小。</li>
<li>&rarr; 大型事务处理成功。</li>
<li>&rarr; 效率低下 - 因为只有一小部分 JVM heap 空间用作缓存 + 不必要的钝化。</li>
</ul></section><section class="print-page" id="zh-user-guide-configure_snapshot_engine" heading-number="6.11"><h1 id="zh-user-guide-configure_snapshot_engine-_1">設定快照引擎<a class="headerlink" href="#zh-user-guide-configure_snapshot_engine-_1" title="Permanent link">&para;</a></h1>
<h2 id="zh-user-guide-configure_snapshot_engine-cdc"><strong>初始快照與變更資料擷取 (CDC)</strong><a class="headerlink" href="#zh-user-guide-configure_snapshot_engine-cdc" title="Permanent link">&para;</a></h2>
<p>初始快照是指將表格結構和初始資料從遠端資料庫遷移到 SynchDB 的過程。對於大多數連接器類型，此操作僅在首次啟動連接器時透過嵌入式 Debezium 運行器執行一次，因為只有 Debezium 引擎才能執行初始快照。初始快照完成後，變更資料擷取將開始將即時變更串流傳輸到 SynchDB。 「快照模式」可以進一步控制初始快照和 CDC 的行為。更多信息，請參閱<a href="https://docs.synchdb.com/zh/user-guide/start_stop_connector/">此處</a>。</p>
<p>除了基於 Debezium 的初始快照（當表數量眾多時可能會很慢）之外，SynchdB 還提供了另一個基於 FDW 的原生初始快照引擎。目前，只有原生 Openlog Replicator (OLR) 連接器支援基於 FDW 的快照。所有其他連接器仍然依賴 Debezium 來執行快照。</p>
<h2 id="zh-user-guide-configure_snapshot_engine-fdw"><strong>基於 FDW 的初始快照</strong><a class="headerlink" href="#zh-user-guide-configure_snapshot_engine-fdw" title="Permanent link">&para;</a></h2>
<ul>
<li>在 <code>postgresql.conf</code> 中將 "synchdb.olr_snapshot_engine" 設為 "fdw" 即可啟用。</li>
<li>啟動需要快照的 OLR 連接器，並設定為快照模式。例如：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;no_data&#39;</span><span class="p">);</span>

<span class="c1">-- 或</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;always&#39;</span><span class="p">);</span>

<span class="c1">-- 或</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">synchdb_start_engine_bgw</span><span class="p">(</span><span class="s1">&#39;olrconn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;schemasync&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="zh-user-guide-configure_snapshot_engine-oracle_fdw"><strong>编译並安裝 oracle_fdw</strong><a class="headerlink" href="#zh-user-guide-configure_snapshot_engine-oracle_fdw" title="Permanent link">&para;</a></h2>
<p>如果選擇 "fdw" 作為快照引擎，您需要確保相應的外部資料包裝器已安裝或可用於 synchdb。以下是從原始碼建置並安裝 oracle_fdw 的簡要步驟供您參考。</p>
<h3 id="zh-user-guide-configure_snapshot_engine-oci"><strong>安裝 OCI</strong><a class="headerlink" href="#zh-user-guide-configure_snapshot_engine-oci" title="Permanent link">&para;</a></h3>
<p>建置和運行 oracle_fdw 需要 OCI。在此範例中，我使用的是 23.9.0 版本：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 取得預編譯軟體包：</span>
wget<span class="w"> </span>https://download.oracle.com/otn_software/linux/instantclient/2390000/instantclient-basic-linux.x64-23.9.0.25.07.zip
wget<span class="w"> </span>https://download.oracle.com/otn_software/linux/instantclient/2390000/instantclient-sdk-linux.x64-23.9.0.25.07.zip

<span class="c1"># 解壓縮：選擇「Y」以覆寫元資料文件</span>
unzip<span class="w"> </span>instantclient-basic-linux.x64-23.9.0.25.07.zip
unzip<span class="w"> </span>instantclient-sdk-linux.x64-23.9.0.25.07.zip
</code></pre></div>
<p>更新環境變量，以便系統知道在哪裡找到 OCI 頭檔和庫。</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">OCI_HOME</span><span class="o">=</span>/home/<span class="nv">$USER</span>/instantclient_23_9
<span class="nb">export</span><span class="w"> </span><span class="nv">OCI_LIB_DIR</span><span class="o">=</span><span class="nv">$OCI_HOME</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OCI_INC_DIR</span><span class="o">=</span><span class="nv">$OCI_HOME</span>/sdk/include
<span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OCI_HOME</span>:<span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$OCI_HOME</span>:<span class="nv">$PATH</span>
</code></pre></div>
<p>您可以將上述命令新增至 <code>~/.bashrc</code> 的末尾，以便每次登入系統時自動設定 PATH。</p>
<p>您也可以將 $OCI_HOME 新增至 <code>/etc/ld.so.conf.d/x86_64-linux-gnu.conf</code>（以 Ubuntu 為例），作為尋找共用程式庫的新路徑。</p>
<p>您應該執行 ldconfig 命令，以便連結器知道在哪裡找到共用程式庫：</p>
<h3 id="zh-user-guide-configure_snapshot_engine-oracle_fdw-280"><strong>建置 oracle_fdw 2.8.0</strong><a class="headerlink" href="#zh-user-guide-configure_snapshot_engine-oracle_fdw-280" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/laurenz/oracle_fdw.git<span class="w"> </span>--branch<span class="w"> </span>ORACLE_FDW_2_8_0
</code></pre></div>
<p>透過調整 Makefile 中的以下兩行，確保 oracle_fdw 的 Makefile 能夠找到 OCI 包含檔案和函式庫：</p>
<div class="highlight"><pre><span></span><code>FIND_INCLUDE<span class="w"> </span>:<span class="o">=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>/usr/include/oracle/*/client64<span class="w"> </span>/usr/include/oracle/*/client<span class="w"> </span>/home/<span class="nv">$USER</span>/instantclient_23_9/sdk/include<span class="k">)</span>
FIND_LIBDIRS<span class="w"> </span>:<span class="o">=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>/usr/lib/oracle/*/client64/lib<span class="w"> </span>/usr/lib/oracle/*/client/lib<span class="w"> </span>/home/<span class="nv">$USER</span>/instantclient_23_9<span class="k">)</span>
</code></pre></div>
<p>建置並安裝 oracle_fdw：</p>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span><span class="nv">PG_CONFIG</span><span class="o">=</span>/usr/local/pgsql/bin/pg_config
sudo<span class="w"> </span>make<span class="w"> </span>install<span class="w"> </span><span class="nv">PG_CONFIG</span><span class="o">=</span>/usr/local/pgsql/bin/pg_config
</code></pre></div>
<p>Oralce_fdw 已準備就緒。</p>
<p><strong>&lt;&lt;重要&gt;&gt;</strong> 在使用基於 FDW 的初始快照之前，您無需執行“CREATE EXTENSION oracle_fdw”，也無需執行“CREATE SERVER”或“CREATE USER MAPPING”。 SynchDB 在執行快照時會處理所有這些操作。</p></section></section><section class="print-page" id="zh-changelog" heading-number="7"><h1 id="zh-changelog-_1">变更日志<a class="headerlink" href="#zh-changelog-_1" title="Permanent link">&para;</a></h1>
<p>本项目的所有重要变更都将记录在此文件中。</p>
<p>本文格式基于 <a href="http://keepachangelog.com/">Keep a Changelog</a>，
且本项目遵循 <a href="http://semver.org/">语义化版本</a>。</p>
<h2 id="zh-changelog-synchdb-13-2025-11-25"><strong><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.3">SynchDB 1.3</a> - 2025-11-25</strong><a class="headerlink" href="#zh-changelog-synchdb-13-2025-11-25" title="Permanent link">&para;</a></h2>
<p>SynchDB 1.3 憑藉全新的基於 FDW 的快照引擎，顯著提升了效能，初始快照速度遠超 Debezium。這項改進使得 OpenLog Replicator (OLR) 連接器成為一個完全原生的快照 + CDC 管線（無需使用 Debezium），從而顯著降低了大型 Oracle 資料集的延遲和開銷。平台支援也得到了擴展。 SynchDB 現在可在 PostgreSQL 18 和 IvorySQL 5 上運行，並針對整個系統進行了一系列效能最佳化和 I/O 改進。</p>
<h3 id="zh-changelog-_2"><strong>新增</strong><a class="headerlink" href="#zh-changelog-_2" title="Permanent link">&para;</a></h3>
<h4 id="zh-changelog-fdw"><a href="https://docs.synchdb.com/architecture/fdw_based_snapshot/">基於 FDW 的快照引擎</a><a class="headerlink" href="#zh-changelog-fdw" title="Permanent link">&para;</a></h4>
<ul>
<li>基於 FDW 的快照引擎比 Debezium 的初始快照流程速度更快。</li>
<li>新增 GUC 參數“synchdb.snapshot_engine”，用於選擇快照引擎，可以是“debezium”或“fdw”。</li>
<li>新增 GUC 參數“synchdb.cdc_start_delay_ms”，用於在初始快照完成後、CDC 啟動前新增毫秒延遲。</li>
<li>新增 GUC 參數“synchdb.fdw_migrate_with_subtx”，用於在基於 FDW 的快照流程中是否使用子交易遷移每個資料表。</li>
<li>僅適用於透過 <a href="https://github.com/laurenz/oracle_fdw">oracle_fdw</a> 2.8.0 連接的 Openlog Replicator 和 Oracle 連接器類型。其他連接器類型可能會在未來的版本中得到支援。</li>
<li>支援重試機制：如果某些表快照失敗，錯誤訊息將保存到 synchdb_fdw_snapshot_errors_xxx 表中，可以透過恢復連接器進行重試。成功快照的表將保留。</li>
<li>如果使用「schemasync」或「nodata」快照模式，FDW 引擎將僅同步表模式。</li>
<li>透過 FDW 引擎建立的表格和資料受「synchdb_objmap」中定義的名稱和表達式轉換規則的約束。</li>
<li>新增函數 synchdb_translate_datatype()，該函數會根據所選連接器類型傳回 SynchDB 的資料類型轉換結果。</li>
</ul>
<h4 id="zh-changelog-_3"><a href="https://docs.synchdb.com/monitoring/stats_view/">改進的統計視圖</a><a class="headerlink" href="#zh-changelog-_3" title="Permanent link">&para;</a></h4>
<ul>
<li>改進了統計視圖，將不同的統計資料分組到適當的類別。</li>
<li>已移除 synchdb_stats_view() 函數。</li>
<li>新增了 synchdb_genstats 視圖，用於記錄已處理事件批次的統計資料。</li>
<li>新增了 synchdb_snapstats 視圖，用於記錄初始快照過程的統計資料。</li>
<li>新增了 synchdb_cdcstats 視圖，用於記錄 CDC 流程的統計資料。</li>
</ul>
<h4 id="zh-changelog-postgresql-18-ivorysql-5">PostgreSQL 18 和 IvorySQL 5 相容性<a class="headerlink" href="#zh-changelog-postgresql-18-ivorysql-5" title="Permanent link">&para;</a></h4>
<ul>
<li>SynchDB 與 PostgreSQL 18 和 IvorySQL 5 相容。</li>
<li>在 IvorySQL 5 下以「oracle」相容模式運行基於 FDW 的快照時，由於 PL/pgSQL 函數是用 PostgreSQL 標準編寫的，因此在快照期間，該模式將切換回「pg」模式。</li>
<li>SynchDB 將在 SynchDB 工作進程中將“ivorysql.identifier_case_switch”設定設為“normal”，以防止字母大小寫被錯誤地反轉。</li>
<li>將 liboracle_parser.so 及其內部的 oracle_raw_parser() 符號重新命名為 libsynchdb_oracle_parser.so 和 synchdb_oracle_raw_parser()，以防止符號名稱與 IvorySQL 衝突。</li>
</ul>
<h3 id="zh-changelog-_4"><strong>变更</strong><a class="headerlink" href="#zh-changelog-_4" title="Permanent link">&para;</a></h3>
<ul>
<li>Openlog Replicator 連接器：增強了 Oracle 解析器，以支援更多約束運算子：enable、disable、novalidate 和 validate。</li>
<li>Openlog Replicator 連接器：增強了 Oracle 解析器，以支援帶有括號和不帶括號的 MODIFY 子句。</li>
<li>Openlog Replicator 連接器：增強了 Oracle 解析器，以支援 DEFAULT ON NULL 子句。</li>
<li>Openlog Replicator 連接器：透過移除一個預掃描循環來提高處理效能。</li>
<li>Openlog Replicator 連接器：最佳化了以 PostgreSQL 文字類型處理非空終止事件的操作，從而減少了一次複製操作。 (PG17+)</li>
<li>Openlog Replicator 連接器：預設讀取緩衝區大小變更為 128MB</li>
<li>Openlog Replicator 連接器：新增 GUC 參數“synchdb.olr_read_timeout_ms”，用於設定讀取逾時時間。</li>
<li>Openlog Replicator 連接器：新增 GUC 參數“synchdb.olr_connect_timeout_ms”，用於設定連線逾時時間。</li>
<li>Openlog Replicator 連接器：將忽略 Debezium 建立的「log_mining_flush」表。</li>
<li>更新了所有連接器類型的預設資料類型映射</li>
<li>更健壯的 JSON 處理：不再因為 JSON 元素查找失敗而崩潰</li>
</ul>
<h3 id="zh-changelog-_5">已修復<a class="headerlink" href="#zh-changelog-_5" title="Permanent link">&para;</a></h3>
<ul>
<li>Openlog Replicator 連接器：修正了在 PostgreSQL 16 下執行時間 Oracle 解析器解析失敗的問題。</li>
<li>Openlog Replicator 連接器：修正了將包含系統擁有者的意外 DDL 語句錯誤地傳遞給 SynchDB 的問題。</li>
<li>Openlog Replicator 連接器：調整了 SCN 和 C_SCN 值，使其恢復 CDC 時使用偏移檔案中儲存的值，而不是加 1，從而避免在復原時跳過先前失敗的變更事件。</li>
<li>SynchDB 現在允許來源表或模式名稱包含空格。</li>
<li>修正了對負十進制值處理不正確的問題。</li>
<li>修正了對大十進制溢出值處理不正確的問題。</li>
<li>修正了 Oracle 預設 NUMBER 資料類型對應中錯誤地省略長度和小數位數的問題。</li>
<li>修正了 MySQL 連接器中帶有自增屬性的缺失預設資料類型映射</li>
</ul>
<h3 id="zh-changelog-_6">已知問題和其他信息<a class="headerlink" href="#zh-changelog-_6" title="Permanent link">&para;</a></h3>
<ul>
<li>SynchDB 在將傳入的表名、模式名和列名套用到 PostgreSQL 之前，總是會將它們規範化為小寫字母。如果來源表支援名稱相同但大小寫不同的對象，則會出現問題。例如，'mytable' 和 'MYTABLE' 在 MySQL 和 Oracle 中被視為不同的表名。問題連結<a href="https://github.com/Hornetlabs/synchdb/issues/194">此處</a></li>
<li>目前尚不支援基於 FDW 的 MySQL 和 SQL Server 快照，我們可能會在未來的版本中新增支援。更多資訊<a href="https://github.com/Hornetlabs/synchdb/issues/190">此處</a></li>
</ul>
<h2 id="zh-changelog-synchdb-12-2025-09-04"><strong><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.2">SynchDB 1.2</a> - 2025-09-04</strong><a class="headerlink" href="#zh-changelog-synchdb-12-2025-09-04" title="Permanent link">&para;</a></h2>
<p>SynchDB 1.2 引入了原生 Openlog Replicator 连接器（测试版）、增强的 JMX 和 Grafana 监控功能，以及用于快速部署和测试的全新 ezdeploy.sh 工具。此外，它还增加了快照表选择功能、性能改进和关键修复，同时解决了连接器隔离和稳定性问题。</p>
<h3 id="zh-changelog-_7"><strong>新增</strong><a class="headerlink" href="#zh-changelog-_7" title="Permanent link">&para;</a></h3>
<h4 id="zh-changelog-openlog-replicator-"><a href="https://docs.synchdb.com/user-guide/configure_olr/">原生 Openlog Replicator 连接器</a> - 测试版<a class="headerlink" href="#zh-changelog-openlog-replicator-" title="Permanent link">&para;</a></h4>
<ul>
<li>新增 <code>synchdb_add_olr_conninfo</code> 和 <code>synchdb_del_olr_conninfo</code>，用于启用或禁用基于 Openlog Replicator 的流式传输。</li>
<li>添加了新的连接器类型“olr”，它是一个原生（非 Debezium）Openlog 复制器客户端，可从外部 Openlog Replicator 服务流式传输 Oracle 数据库更改。</li>
<li>支持的 DML：插入、更新/删除</li>
<li>支持的 DDL：创建表、删除表、修改表、添加/删除列、添加/删除约束、截断</li>
<li>基于 libprotobuf-c 与 Openlog Replicator 和 IvorySQL 的 Oracle 解析器通信，以处理传入的 DDL 查询事件。</li>
<li>支持的快照模式：initial、initial_only、no_data、always、never</li>
<li>与其他基于 Debezium 的连接器一样，支持批处理、模式历史记录和偏移量管理。</li>
<li>除原生连接器外，还支持基于 Debezium 的 Openlog Replicator 连接器。</li>
</ul>
<h4 id="zh-changelog-_8"><a href="https://docs.synchdb.com/monitoring/jmx_monitor/">监控</a><a class="headerlink" href="#zh-changelog-_8" title="Permanent link">&para;</a></h4>
<ul>
<li>新增 <code>synchdb_add_jmx_conninfo</code> 和 <code>synchdb_del_jmx_conninfo</code>，用于启用或禁用基于 JMX 的监控。</li>
<li>新增 <code>synchdb_add_jmx_exporter_conninfo</code> 和 <code>synchdb_del_jmx_exporter_conninfo</code>，用于启用或禁用 Prometheus 和 Grafana 的监控支持。</li>
<li>新增基于 Grafana 的仪表板模板，用于支持基于 Debezium 的连接器（MySQL、SQL Server 和 Oracle）。</li>
</ul>
<h4 id="zh-changelog-ezdeploysh"><a href="https://docs.synchdb.com/getting-started/quick_start/">ezdeploy.sh</a><a class="headerlink" href="#zh-changelog-ezdeploysh" title="Permanent link">&para;</a></h4>
<ul>
<li>新增 <code>ezdeploy.sh</code> 工具，可快速部署预构建的 SynchDB 和所选的源数据库类型，以便快速进行连接器测试。</li>
<li>支持部署：MySQL、SQL Server、Oracle23ai、Oracle19c、Openlog Replicator 1.3.0</li>
<li>支持预加载仪表板的 Prometheus 和 Grafana 部署。</li>
<li>支持预编译的 SynchDB v1.2，以便快速部署和测试。</li>
</ul>
<h3 id="zh-changelog-_9"><strong>变更</strong><a class="headerlink" href="#zh-changelog-_9" title="Permanent link">&para;</a></h3>
<ul>
<li>在 <code>synchdb_add_conninfo</code> 中添加了一个名为 <code>snapshot table</code> 的新参数，允许用户在以 <code>always</code> 快照模式启动时选择要重做初始快照的表。</li>
<li>更新了 pytest 框架，以支持基于 hammerdb 的 Oracle TPC 测试。</li>
<li>通过使用直接缓冲区代替频繁的 JNI 调用，增强了 Debezium 引擎和 SynchDB 之间事件轮询的性能。</li>
<li>当连接器通过 <code>synchdb_resume_engine</code> 恢复时，它将始终以 <code>initial</code> 快照模式恢复，而不是首次启动时的模式。</li>
<li><code>synchdb_state_view</code> 和 <code>synchdb_stats_view</code> 现在仅显示当前 SynchDB 扩展创建的连接器信息。其他 SynchDB 扩展在不同数据库中创建的连接器将不显示。</li>
</ul>
<h3 id="zh-changelog-_10"><strong>已修复</strong><a class="headerlink" href="#zh-changelog-_10" title="Permanent link">&para;</a></h3>
<ul>
<li>修复了 <code>spi_execute_select_one()</code> 函数崩溃的问题，该函数在 SPI 执行成功后会返回一个已被 SPI 内存上下文销毁的引用。</li>
<li>解决了使用 cassert 构建 PostgreSQL 时 SynchDB 的编译问题。</li>
<li>修复了多个 SynchDB 扩展（创建于不同数据库中）创建的同名连接器会相互覆盖共享内存数据的问题。</li>
</ul>
<h3 id="zh-changelog-_11"><strong>已知问题及其他信息</strong><a class="headerlink" href="#zh-changelog-_11" title="Permanent link">&para;</a></h3>
<ul>
<li>原生 Openlog Replicator 连接器目前会流式传输指定数据库下的所有表。表过滤功能需要在 Openlog Replicator 中配置，而不是在 SynchDB 中。</li>
<li>基于 Prometheus 和 Grafana 的监控需要 JMX Exporter，可以从<a href="https://github.com/prometheus/jmx_exporter">此处</a> 下载</li>
</ul>
<h2 id="zh-changelog-synchdb-11-2025-04-17"><strong><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.1">SynchDB 1.1</a> - 2025-04-17</strong><a class="headerlink" href="#zh-changelog-synchdb-11-2025-04-17" title="Permanent link">&para;</a></h2>
<p>SynchDB 1.1 版本引入了 Oracle 连接器支持，增强了数据类型转换能力，并显著改进了核心数据处理引擎。本次更新通过智能缓存和优化的 JSON 解析，提升了性能表现，同时扩展了与 PostgreSQL 16、17 和 IvorySQL 4.4 的兼容性。</p>
<h3 id="zh-changelog-_12"><strong>添加</strong><a class="headerlink" href="#zh-changelog-_12" title="Permanent link">&para;</a></h3>
<h4 id="zh-changelog-_13"><strong>连接器支持</strong><a class="headerlink" href="#zh-changelog-_13" title="Permanent link">&para;</a></h4>
<ul>
<li>新增 Oracle 连接器支持</li>
<li>新增 Oracle 可变大小/精度 NUMBER 数据类型处理支持</li>
<li>支持 PostgreSQL 16、17 和 IvorySQL 4.4</li>
</ul>
<h4 id="zh-changelog-_14"><strong>对象映射与数据转换</strong><a class="headerlink" href="#zh-changelog-_14" title="Permanent link">&para;</a></h4>
<ul>
<li>新增 <code>synchdb_objmap</code> 表存储对象映射条目</li>
<li>新增 <code>synchdb_add_objamp()</code> 函数添加对象映射，支持表名、列名、数据类型和转换表达式</li>
<li>新增 <code>synchdb_reload_objmap()</code> 函数强制连接器重新加载对象映射</li>
<li>新增 <code>synchdb_del_objmap()</code> 函数禁用并删除对象映射条目</li>
<li>归一化所有数据类型映射条目，使用小写字母</li>
</ul>
<h4 id="zh-changelog-_15"><strong>元数据与监控</strong><a class="headerlink" href="#zh-changelog-_15" title="Permanent link">&para;</a></h4>
<ul>
<li>新增 <code>synchdb_attribute</code> 表存储远程表属性信息</li>
<li>新增 <code>synchdb_att_view</code> 视图显示数据类型、表名和列名映射的并排比较</li>
<li>在 <code>synchdb_get_stats</code> 中增加源时间戳、DBZ 时间戳和 PG 时间戳信息</li>
</ul>
<h4 id="zh-changelog-_16"><strong>连接管理</strong><a class="headerlink" href="#zh-changelog-_16" title="Permanent link">&para;</a></h4>
<ul>
<li>新增 <code>synchdb_add_extra_conninfo()</code> 函数配置额外的 SSL 连接参数</li>
<li>新增 <code>synchdb_del_extra_conninfo()</code> 函数删除由 <code>synchdb_add_extra_conninfo()</code> 创建的所有额外参数</li>
<li>新增 <code>synchdb_del_conninfo()</code> 函数删除现有连接器信息</li>
</ul>
<h4 id="zh-changelog-_17"><strong>配置与控制</strong><a class="headerlink" href="#zh-changelog-_17" title="Permanent link">&para;</a></h4>
<ul>
<li>新增 <code>synchdb.error_handling_strategy</code> GUC 参数控制错误处理策略（跳过、退出或重试）</li>
<li>新增 <code>synchdb.dbz_log_level</code> GUC 参数控制 Debezium 运行引擎的日志级别</li>
<li>新增 <code>schemasync</code> 快照模式</li>
</ul>
<h4 id="zh-changelog-_18"><strong>性能优化</strong><a class="headerlink" href="#zh-changelog-_18" title="Permanent link">&para;</a></h4>
<ul>
<li>优化 DML 解析器，使用缓存哈希表而非每次更改事件都访问目录并重建哈希</li>
<li>DML 解析器现使用更高效的 JSONB API 调用提升性能</li>
<li>优化 JNI 调用，使用缓存的 JNI 句柄而非每次更改事件都重新创建</li>
<li>仅标记批次中的第一个和最后一个更改事件，而非所有事件</li>
<li>重新设计数据处理引擎，采用更模块化的设计，以处理更复杂的数据类型映射</li>
</ul>
<h3 id="zh-changelog-_19"><strong>变更</strong><a class="headerlink" href="#zh-changelog-_19" title="Permanent link">&para;</a></h3>
<ul>
<li>处理 ALTER TABLE 更改事件时，仅在表本身没有主键时添加主键</li>
<li>移除在 <code>synchdb_add_conninfo()</code> 中配置连接器连接到安装了 synchdb 以外的目标 PostgreSQL 数据库的功能</li>
<li>在每个 DDL 更改事件处理结束时，更新新的 <code>synchdb_attribute</code> 表</li>
<li>连接器将根据配置的对象映射在启动或重新加载时更正表名、列名和数据类型</li>
<li>规则文件已被 <code>synchdb_add_objmap()</code> 工具替代</li>
<li>所有基于 ID 的 SQL 函数列定义，数据类型从 TEXT 更改为 NAME</li>
<li>从 <code>synchdb_add_conninfo()</code> 中移除 rulefile 参数</li>
<li>非原生数据类型现在基于类别处理，而非全部作为文本处理</li>
</ul>
<h3 id="zh-changelog-_20"><strong>修复</strong><a class="headerlink" href="#zh-changelog-_20" title="Permanent link">&para;</a></h3>
<ul>
<li>修复 SPI 更新或删除可能因仅在 WHERE 子句中包含主键字段而导致更新或删除失败的问题</li>
<li>修复 ALTER TABLE 在尝试添加重复主键时出错的问题</li>
<li>修复 synchdb 偶尔从 JSON 更改事件中错误查找列架构值的问题</li>
<li>修复"跳过错误"模式下因错误堆栈溢出而导致崩溃的问题</li>
<li>修复 ALTER TABLE ADD 和 DROP 列操作中未意识到列名可能在 PostgreSQL 中映射到不同值的问题</li>
</ul>
<h2 id="zh-changelog-synchdb-10-2024-12-24"><strong><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.0">SynchDB 1.0</a> - 2024-12-24</strong><a class="headerlink" href="#zh-changelog-synchdb-10-2024-12-24" title="Permanent link">&para;</a></h2>
<p>此版本侧重于 v1.0 Beta1 版本之后的错误修复和性能增强，使其在中高数据负载下更易于使用。更多与 Debezium 调优相关的参数也已作为 PostgreSQL GUC 公开，允许用户使用不同的参数进行测试。</p>
<h3 id="zh-changelog-_21"><strong>添加</strong><a class="headerlink" href="#zh-changelog-_21" title="Permanent link">&para;</a></h3>
<ul>
<li>在 DML 解析阶段添加了数据缓存，以防止频繁访问 PostgreSQL catalog 以获取表的元组描述符结构。</li>
<li>添加 <code>synchdb_start_engine_bgw(name, mode)</code> 的变体，它接受第二个参数来指示启动连接器时使用的自定义快照模式。<a href="#zh-user-guide-utility_functions">此处</a>有更多详细信息。</li>
<li>添加多个可以调整 Debezium Runner 性能的 GUC。完整列表请参阅<a href="#zh-user-guide-configuration.md">此处</a>。</li>
<li>添加一个调试 SQL 函数 <code>synchdb_log_jvm_meminfo(name)</code>，该函数使指定的连接器在 PostgreSQL 日志文件中输出当前 JVM 堆内存使用情况摘要。</li>
<li>添加一个新视图 <code>synchdb_stats_view</code>，用于打印所有连接器的统计信息。更多详细信息请参阅<a href="#zh-user-guide-utility_functions">此处</a>。</li>
<li>增加了新的SQL函数 <code>synchdb_reset_stats(name)</code> 来清除指定连接器的统计信息。更多详细信息请参阅<a href="#zh-user-guide-utility_functions">此处</a>。</li>
<li>添加一个测试数据创建脚本，用于快速生成 MySQL 数据库类型的测试表和数据。</li>
</ul>
<h3 id="zh-changelog-_22"><strong>变更</strong><a class="headerlink" href="#zh-changelog-_22" title="Permanent link">&para;</a></h3>
<ul>
<li>synchdb_state_view()：添加了一个名为 <code>stage</code> 的新字段，用于标识 connector 的当前阶段（值可以是 <code>Initial Snapshot</code> 或 <code>Change Data Capture</code>）。</li>
<li>synchdb_state_view()：仅显示有效连接器的状态。</li>
<li>删除了在发生错误时向 Debezium Runner 发送 “部分批处理完成” 通知，因为批处理现在由一个 PostgreSQL 事务处理，且不允许部分完成。</li>
<li>现在可以在 <a href="#zh-user-guide-transform_rule_file">规则文件</a> 中指定 connector 所需的 SSL 相关参数。</li>
<li>现在可以通过 GUC 配置分配给运行 Debezium Runner 的 JVM 的最大堆内存。</li>
<li>现在可以配置连接器后台进程的最大数量，而不是硬编码的 30。</li>
</ul>
<h3 id="zh-changelog-_23"><strong>修复</strong><a class="headerlink" href="#zh-changelog-_23" title="Permanent link">&para;</a></h3>
<ul>
<li>在 Debezium runner 内添加节流控制，修复了 Debezium Runner 在数据量大时内存快速积累问题。</li>
<li>解决了 SynchDB 和 Debezium runner 组件中的大部分内存泄漏问题。</li>
<li>更正了 SynchDB 中 memory context 的使用，以便在每次更改事件处理结束时正确释放内存。</li>
<li>通过在单个 PostgreSQL 事务中处理一批改动，显著提高了 SynchDB 的处理速度。</li>
<li>将 SQLServer 的 <code>char</code> 类型的默认数据类型大小映射从 0 更正为 -1。</li>
<li>解决了使用 SPI 进行 DML 处理期间内存使用率过高的问题。</li>
</ul>
<h2 id="zh-changelog-synchdb-10-beta1-2024-10-23"><a href="https://github.com/Hornetlabs/synchdb/releases/tag/v1.0_beta1">SynchDB 1.0 Beta1</a> - 2024-10-23<a class="headerlink" href="#zh-changelog-synchdb-10-beta1-2024-10-23" title="Permanent link">&para;</a></h2>
<p>第一版 SynchDB 软件发布，为从异构数据库到 PostgreSQL 的无缝复制奠定了坚实的基础</p>
<h3 id="zh-changelog-_24"><strong>新增</strong><a class="headerlink" href="#zh-changelog-_24" title="Permanent link">&para;</a></h3>
<ul>
<li>从异构数据库进行逻辑复制：（MySQL 和 SQLServer）。</li>
<li><a href="#zh-user-guide-ddl_replication">DDL 复制</a> (CREATE TABLE、DROP TABLE、ALTER TABLE ADD COLUMN、ALTER TABLE DROP COLUMN、ALTER TABLE ALTER COLUMN)</li>
<li>DML 复制（INSERT、UPDATE、DELETE）。</li>
<li>最多 30 个并发连接器工作器。</li>
<li>PostgreSQL 启动时 <a href="#zh-user-guide-connector_auto_launcher">自动连接器启动器</a>。</li>
<li>全局连接器状态和最后错误消息视图。</li>
<li><a href="#zh-user-guide-selective_table_sync">选择性数据库和表复制</a>。</li>
<li>批量更改事件。</li>
<li>连接器以不同的快照模式重新启动。</li>
<li><a href="#zh-user-guide-set_offset">偏移管理接口</a> 用于选择自定义复制恢复点。</li>
<li>支持的异构数据库的默认数据类型和对象名称转换规则。</li>
<li><a href="#zh-user-guide-transform_rule_file">JSON 规则文件</a> 用于定义自定义：（数据类型、列名、表名和数据表达式转换规则）。</li>
<li>2 种数据应用模式（SPI、HeapAM API）</li>
<li>新增<a href="#zh-user-guide-utility_functions">实用函数</a> 用于执行连接器操作：（启动、停止、暂停、恢复）。</li>
</ul>
<h3 id="zh-changelog-_25"><strong>变更</strong><a class="headerlink" href="#zh-changelog-_25" title="Permanent link">&para;</a></h3>
<h3 id="zh-changelog-_26"><strong>修复</strong><a class="headerlink" href="#zh-changelog-_26" title="Permanent link">&para;</a></h3></section></div><style>.print-site-enumerate-headings #zh > h1:before { content: '1 ' }

                .print-site-enumerate-headings #zh h2:before { content: '1.' counter(counter-zh-2) ' ' }
                .print-site-enumerate-headings #zh h2 {  counter-reset: counter-zh-3 ;  counter-increment: counter-zh-2 }
            
                .print-site-enumerate-headings #zh h3:before { content: '1.' counter(counter-zh-2) '.' counter(counter-zh-3) ' ' }
                .print-site-enumerate-headings #zh h3 {  counter-increment: counter-zh-3 }
            
.print-site-enumerate-headings #section-2 > h1:before { content: '2 ' }
.print-site-enumerate-headings #zh-architecture-architecture > h1:before { content: '2.1 ' }

                .print-site-enumerate-headings #zh-architecture-architecture h2:before { content: '2.1.' counter(counter-zh-architecture-architecture-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-architecture h2 {  counter-increment: counter-zh-architecture-architecture-2 }
            
.print-site-enumerate-headings #zh-architecture-debezium_event_processor > h1:before { content: '2.2 ' }

                .print-site-enumerate-headings #zh-architecture-debezium_event_processor h2:before { content: '2.2.' counter(counter-zh-architecture-debezium_event_processor-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-debezium_event_processor h2 {  counter-increment: counter-zh-architecture-debezium_event_processor-2 }
            
.print-site-enumerate-headings #zh-architecture-debezium_runner_components > h1:before { content: '2.3 ' }

                .print-site-enumerate-headings #zh-architecture-debezium_runner_components h2:before { content: '2.3.' counter(counter-zh-architecture-debezium_runner_components-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-debezium_runner_components h2 {  counter-increment: counter-zh-architecture-debezium_runner_components-2 }
            
.print-site-enumerate-headings #zh-architecture-openlog_replicator_event_processor > h1:before { content: '2.4 ' }

                .print-site-enumerate-headings #zh-architecture-openlog_replicator_event_processor h2:before { content: '2.4.' counter(counter-zh-architecture-openlog_replicator_event_processor-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-openlog_replicator_event_processor h2 {  counter-increment: counter-zh-architecture-openlog_replicator_event_processor-2 }
            
.print-site-enumerate-headings #zh-architecture-batch_change_handling > h1:before { content: '2.5 ' }

                .print-site-enumerate-headings #zh-architecture-batch_change_handling h2:before { content: '2.5.' counter(counter-zh-architecture-batch_change_handling-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-batch_change_handling h2 {  counter-increment: counter-zh-architecture-batch_change_handling-2 }
            
.print-site-enumerate-headings #zh-architecture-non_native_datatype_handling > h1:before { content: '2.6 ' }

                .print-site-enumerate-headings #zh-architecture-non_native_datatype_handling h2:before { content: '2.6.' counter(counter-zh-architecture-non_native_datatype_handling-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-non_native_datatype_handling h2 {  counter-increment: counter-zh-architecture-non_native_datatype_handling-2 }
            
.print-site-enumerate-headings #zh-architecture-native_datatype_handling > h1:before { content: '2.7 ' }

                .print-site-enumerate-headings #zh-architecture-native_datatype_handling h2:before { content: '2.7.' counter(counter-zh-architecture-native_datatype_handling-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-native_datatype_handling h2 {  counter-increment: counter-zh-architecture-native_datatype_handling-2 }
            
.print-site-enumerate-headings #zh-architecture-metadata_files > h1:before { content: '2.8 ' }

                .print-site-enumerate-headings #zh-architecture-metadata_files h2:before { content: '2.8.' counter(counter-zh-architecture-metadata_files-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-metadata_files h2 {  counter-increment: counter-zh-architecture-metadata_files-2 }
            
.print-site-enumerate-headings #zh-architecture-ddl_replication > h1:before { content: '2.9 ' }

                .print-site-enumerate-headings #zh-architecture-ddl_replication h2:before { content: '2.9.' counter(counter-zh-architecture-ddl_replication-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-ddl_replication h2 {  counter-increment: counter-zh-architecture-ddl_replication-2 }
            
.print-site-enumerate-headings #zh-architecture-fdw_based_snapshot > h1:before { content: '2.10 ' }

                .print-site-enumerate-headings #zh-architecture-fdw_based_snapshot h2:before { content: '2.10.' counter(counter-zh-architecture-fdw_based_snapshot-2) ' ' }
                .print-site-enumerate-headings #zh-architecture-fdw_based_snapshot h2 {  counter-increment: counter-zh-architecture-fdw_based_snapshot-2 }
            
.print-site-enumerate-headings #section-3 > h1:before { content: '3 ' }
.print-site-enumerate-headings #zh-getting-started-installation > h1:before { content: '3.1 ' }

                .print-site-enumerate-headings #zh-getting-started-installation h2:before { content: '3.1.' counter(counter-zh-getting-started-installation-2) ' ' }
                .print-site-enumerate-headings #zh-getting-started-installation h2 {  counter-increment: counter-zh-getting-started-installation-2 }
            
.print-site-enumerate-headings #zh-getting-started-remote_database_setups > h1:before { content: '3.2 ' }

                .print-site-enumerate-headings #zh-getting-started-remote_database_setups h2:before { content: '3.2.' counter(counter-zh-getting-started-remote_database_setups-2) ' ' }
                .print-site-enumerate-headings #zh-getting-started-remote_database_setups h2 {  counter-increment: counter-zh-getting-started-remote_database_setups-2 }
            
.print-site-enumerate-headings #zh-getting-started-configuration > h1:before { content: '3.3 ' }

                .print-site-enumerate-headings #zh-getting-started-configuration h2:before { content: '3.3.' counter(counter-zh-getting-started-configuration-2) ' ' }
                .print-site-enumerate-headings #zh-getting-started-configuration h2 {  counter-increment: counter-zh-getting-started-configuration-2 }
            
.print-site-enumerate-headings #zh-getting-started-quick_start > h1:before { content: '3.4 ' }

                .print-site-enumerate-headings #zh-getting-started-quick_start h2:before { content: '3.4.' counter(counter-zh-getting-started-quick_start-2) ' ' }
                .print-site-enumerate-headings #zh-getting-started-quick_start h2 {  counter-increment: counter-zh-getting-started-quick_start-2 }
            
.print-site-enumerate-headings #section-4 > h1:before { content: '4 ' }
.print-site-enumerate-headings #zh-monitoring-stats_view > h1:before { content: '4.1 ' }

                .print-site-enumerate-headings #zh-monitoring-stats_view h2:before { content: '4.1.' counter(counter-zh-monitoring-stats_view-2) ' ' }
                .print-site-enumerate-headings #zh-monitoring-stats_view h2 {  counter-increment: counter-zh-monitoring-stats_view-2 }
            
.print-site-enumerate-headings #zh-monitoring-state_view > h1:before { content: '4.2 ' }

                .print-site-enumerate-headings #zh-monitoring-state_view h2:before { content: '4.2.' counter(counter-zh-monitoring-state_view-2) ' ' }
                .print-site-enumerate-headings #zh-monitoring-state_view h2 {  counter-increment: counter-zh-monitoring-state_view-2 }
            
.print-site-enumerate-headings #zh-monitoring-attr_view > h1:before { content: '4.3 ' }

                .print-site-enumerate-headings #zh-monitoring-attr_view h2:before { content: '4.3.' counter(counter-zh-monitoring-attr_view-2) ' ' }
                .print-site-enumerate-headings #zh-monitoring-attr_view h2 {  counter-increment: counter-zh-monitoring-attr_view-2 }
            
.print-site-enumerate-headings #zh-monitoring-jvm_mem > h1:before { content: '4.4 ' }

                .print-site-enumerate-headings #zh-monitoring-jvm_mem h2:before { content: '4.4.' counter(counter-zh-monitoring-jvm_mem-2) ' ' }
                .print-site-enumerate-headings #zh-monitoring-jvm_mem h2 {  counter-increment: counter-zh-monitoring-jvm_mem-2 }
            
.print-site-enumerate-headings #zh-monitoring-jmx_monitor > h1:before { content: '4.5 ' }

                .print-site-enumerate-headings #zh-monitoring-jmx_monitor h2:before { content: '4.5.' counter(counter-zh-monitoring-jmx_monitor-2) ' ' }
                .print-site-enumerate-headings #zh-monitoring-jmx_monitor h2 {  counter-increment: counter-zh-monitoring-jmx_monitor-2 }
            
.print-site-enumerate-headings #zh-monitoring-jmx_exporter > h1:before { content: '4.6 ' }

                .print-site-enumerate-headings #zh-monitoring-jmx_exporter h2:before { content: '4.6.' counter(counter-zh-monitoring-jmx_exporter-2) ' ' }
                .print-site-enumerate-headings #zh-monitoring-jmx_exporter h2 {  counter-increment: counter-zh-monitoring-jmx_exporter-2 }
            
.print-site-enumerate-headings #section-5 > h1:before { content: '5 ' }
.print-site-enumerate-headings #zh-tutorial-mysql_cdc_to_postgresql > h1:before { content: '5.1 ' }

                .print-site-enumerate-headings #zh-tutorial-mysql_cdc_to_postgresql h2:before { content: '5.1.' counter(counter-zh-tutorial-mysql_cdc_to_postgresql-2) ' ' }
                .print-site-enumerate-headings #zh-tutorial-mysql_cdc_to_postgresql h2 {  counter-increment: counter-zh-tutorial-mysql_cdc_to_postgresql-2 }
            
.print-site-enumerate-headings #zh-tutorial-sqlserver_cdc_to_postgresql > h1:before { content: '5.2 ' }

                .print-site-enumerate-headings #zh-tutorial-sqlserver_cdc_to_postgresql h2:before { content: '5.2.' counter(counter-zh-tutorial-sqlserver_cdc_to_postgresql-2) ' ' }
                .print-site-enumerate-headings #zh-tutorial-sqlserver_cdc_to_postgresql h2 {  counter-increment: counter-zh-tutorial-sqlserver_cdc_to_postgresql-2 }
            
.print-site-enumerate-headings #zh-tutorial-oracle_cdc_to_postgresql > h1:before { content: '5.3 ' }

                .print-site-enumerate-headings #zh-tutorial-oracle_cdc_to_postgresql h2:before { content: '5.3.' counter(counter-zh-tutorial-oracle_cdc_to_postgresql-2) ' ' }
                .print-site-enumerate-headings #zh-tutorial-oracle_cdc_to_postgresql h2 {  counter-increment: counter-zh-tutorial-oracle_cdc_to_postgresql-2 }
            
.print-site-enumerate-headings #zh-tutorial-selective_table_sync > h1:before { content: '5.4 ' }

                .print-site-enumerate-headings #zh-tutorial-selective_table_sync h2:before { content: '5.4.' counter(counter-zh-tutorial-selective_table_sync-2) ' ' }
                .print-site-enumerate-headings #zh-tutorial-selective_table_sync h2 {  counter-increment: counter-zh-tutorial-selective_table_sync-2 }
            
.print-site-enumerate-headings #zh-tutorial-table_snapshot_resnapshot > h1:before { content: '5.5 ' }

                .print-site-enumerate-headings #zh-tutorial-table_snapshot_resnapshot h2:before { content: '5.5.' counter(counter-zh-tutorial-table_snapshot_resnapshot-2) ' ' }
                .print-site-enumerate-headings #zh-tutorial-table_snapshot_resnapshot h2 {  counter-increment: counter-zh-tutorial-table_snapshot_resnapshot-2 }
            
.print-site-enumerate-headings #zh-tutorial-object_mapping_workflow > h1:before { content: '5.6 ' }

                .print-site-enumerate-headings #zh-tutorial-object_mapping_workflow h2:before { content: '5.6.' counter(counter-zh-tutorial-object_mapping_workflow-2) ' ' }
                .print-site-enumerate-headings #zh-tutorial-object_mapping_workflow h2 {  counter-increment: counter-zh-tutorial-object_mapping_workflow-2 }
            
.print-site-enumerate-headings #section-6 > h1:before { content: '6 ' }
.print-site-enumerate-headings #zh-user-guide-create_a_connector > h1:before { content: '6.1 ' }

                .print-site-enumerate-headings #zh-user-guide-create_a_connector h2:before { content: '6.1.' counter(counter-zh-user-guide-create_a_connector-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-create_a_connector h2 {  counter-increment: counter-zh-user-guide-create_a_connector-2 }
            
.print-site-enumerate-headings #zh-user-guide-start_stop_connector > h1:before { content: '6.2 ' }

                .print-site-enumerate-headings #zh-user-guide-start_stop_connector h2:before { content: '6.2.' counter(counter-zh-user-guide-start_stop_connector-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-start_stop_connector h2 {  counter-increment: counter-zh-user-guide-start_stop_connector-2 }
            
.print-site-enumerate-headings #zh-user-guide-connector_auto_launcher > h1:before { content: '6.3 ' }

                .print-site-enumerate-headings #zh-user-guide-connector_auto_launcher h2:before { content: '6.3.' counter(counter-zh-user-guide-connector_auto_launcher-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-connector_auto_launcher h2 {  counter-increment: counter-zh-user-guide-connector_auto_launcher-2 }
            
.print-site-enumerate-headings #zh-user-guide-default_datatype_mapping > h1:before { content: '6.4 ' }

                .print-site-enumerate-headings #zh-user-guide-default_datatype_mapping h2:before { content: '6.4.' counter(counter-zh-user-guide-default_datatype_mapping-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-default_datatype_mapping h2 {  counter-increment: counter-zh-user-guide-default_datatype_mapping-2 }
            
.print-site-enumerate-headings #zh-user-guide-object_mapping_rules > h1:before { content: '6.5 ' }

                .print-site-enumerate-headings #zh-user-guide-object_mapping_rules h2:before { content: '6.5.' counter(counter-zh-user-guide-object_mapping_rules-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-object_mapping_rules h2 {  counter-increment: counter-zh-user-guide-object_mapping_rules-2 }
            
.print-site-enumerate-headings #zh-user-guide-secured_connection > h1:before { content: '6.6 ' }

                .print-site-enumerate-headings #zh-user-guide-secured_connection h2:before { content: '6.6.' counter(counter-zh-user-guide-secured_connection-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-secured_connection h2 {  counter-increment: counter-zh-user-guide-secured_connection-2 }
            
.print-site-enumerate-headings #zh-user-guide-configure_error_strategies > h1:before { content: '6.7 ' }

                .print-site-enumerate-headings #zh-user-guide-configure_error_strategies h2:before { content: '6.7.' counter(counter-zh-user-guide-configure_error_strategies-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-configure_error_strategies h2 {  counter-increment: counter-zh-user-guide-configure_error_strategies-2 }
            
.print-site-enumerate-headings #zh-user-guide-set_offset > h1:before { content: '6.8 ' }

                .print-site-enumerate-headings #zh-user-guide-set_offset h2:before { content: '6.8.' counter(counter-zh-user-guide-set_offset-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-set_offset h2 {  counter-increment: counter-zh-user-guide-set_offset-2 }
            
.print-site-enumerate-headings #zh-user-guide-configure_olr > h1:before { content: '6.9 ' }

                .print-site-enumerate-headings #zh-user-guide-configure_olr h2:before { content: '6.9.' counter(counter-zh-user-guide-configure_olr-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-configure_olr h2 {  counter-increment: counter-zh-user-guide-configure_olr-2 }
            
.print-site-enumerate-headings #zh-user-guide-configure_infinispan > h1:before { content: '6.10 ' }

                .print-site-enumerate-headings #zh-user-guide-configure_infinispan h2:before { content: '6.10.' counter(counter-zh-user-guide-configure_infinispan-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-configure_infinispan h2 {  counter-increment: counter-zh-user-guide-configure_infinispan-2 }
            
.print-site-enumerate-headings #zh-user-guide-configure_snapshot_engine > h1:before { content: '6.11 ' }

                .print-site-enumerate-headings #zh-user-guide-configure_snapshot_engine h2:before { content: '6.11.' counter(counter-zh-user-guide-configure_snapshot_engine-2) ' ' }
                .print-site-enumerate-headings #zh-user-guide-configure_snapshot_engine h2 {  counter-increment: counter-zh-user-guide-configure_snapshot_engine-2 }
            
.print-site-enumerate-headings #zh-changelog > h1:before { content: '7 ' }

                .print-site-enumerate-headings #zh-changelog h2:before { content: '7.' counter(counter-zh-changelog-2) ' ' }
                .print-site-enumerate-headings #zh-changelog h2 {  counter-reset: counter-zh-changelog-3 ;  counter-increment: counter-zh-changelog-2 }
            
                .print-site-enumerate-headings #zh-changelog h3:before { content: '7.' counter(counter-zh-changelog-2) '.' counter(counter-zh-changelog-3) ' ' }
                .print-site-enumerate-headings #zh-changelog h3 {  counter-increment: counter-zh-changelog-3 }
            </style>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Maintained by <a href="https://github.com/hornetlabs">Hornetlabs Technology </a>. <a href="https://www.netlify.com/"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deployed by Netlify" width="114" height="51"></a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "/latest", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/print-site.js"></script>
      
    
  </body>
</html>